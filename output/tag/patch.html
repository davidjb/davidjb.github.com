<!DOCTYPE html>
<html lang="en">
<head>
        <title>DavidJB.com - patch</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://davidjb.com/theme/css/main.css" type="text/css" />
                <link href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="DavidJB.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://davidjb.com/css/ie.css"/>
                <script src="http://davidjb.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://davidjb.com/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://davidjb.com/">DavidJB.com  <strong>Ramblings about Plone, Pyramid, Python, the web, Linux, roses and more.</strong></a></h1>
                <nav><ul>
                                                    <li><a href="http://davidjb.com/about.html">About&nbsp;me</a></li>
                                    <li><a href="http://davidjb.com/blog/index.html">Blog</a></li>
                                    <li><a href="http://davidjb.com/projects.html">Projects</a></li>
                                                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://davidjb.com/blog/2010/07/plone-running-plone-without-copies-of-blobs/">Plone: running Plone without copies of&nbsp;blobs</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2010-07-13T16:30:00">
                Tue 13 July 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plone.html">Plone</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/blob.html">blob</a><a href="http://davidjb.com/tag/blobs.html">blobs</a><a href="http://davidjb.com/tag/files.html">files</a><a href="http://davidjb.com/tag/patch.html">patch</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/problem.html">problem</a><a href="http://davidjb.com/tag/python.html">python</a></p>
</footer><!-- /.post-info --><p>Having a bad day? Just bombed your only copies of some files that you&#8217;d
been storing as blobs together with your Plone database? Maybe you had
the blobs stored incorrectly on your Zeo client, rather than the server,
and then in a hasty effort to free some space (due to an on-going issue
with blobs eating <span class="caps">HDD</span> space), deleted them. Whoops..they&#8217;re gone and
their references are still in your Plone database. Or, in a less
disastrous situation, maybe you just want to be able to run your Plone
database without needing lost blobs? Read on.The suggestion, as
mentioned elsewhere on the Interwebs, is to catch the exception that
gets raised on accessing relevant blobs. The two locations to catch (as
of plone.app.blob 1.0b18)&nbsp;are:</p>
<p><strong>plone/app/blob/mixins.py</strong></p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">getScale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get scale by name or original &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnwrapped</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">IImageScaleHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="n">getScale</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre>
<p><strong>plone/app/blob/field.py</strong></p>
<pre class="code python literal-block">
<span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return the size of the blob &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">openBlob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">fstat</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span><span class="o">.</span><span class="n">st_size</span>
        <span class="n">blob</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">size</span>
</pre>
<p>If you put these try/catch statements in, you&#8217;ll stop your site from
dying when accessing the View and Edit pages for your content. This
means you can safely replace lost blobs with files again, or otherwise
just use your site without the files, like if your client sends you only
the database to save on size. Happy&nbsp;days.</p>
<p>There are <a href="http://davidjb.com/blog/2010/07/plone-running-plone-without-copies-of-blobs/#disqus_thread">comments</a>.</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://davidjb.com/blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/" rel="bookmark"
                           title="Permalink to Plone/Zope: Using LDAPUserFolder withÂ posixGroups">Plone/Zope: Using LDAPUserFolder with&nbsp;posixGroups</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-06-03T16:03:00">
                Thu 03 June 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plone.html">Plone</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/groups.html">groups</a><a href="http://davidjb.com/tag/ldap.html">ldap</a><a href="http://davidjb.com/tag/ldapuserfolder.html">ldapuserfolder</a><a href="http://davidjb.com/tag/openldap.html">openldap</a><a href="http://davidjb.com/tag/patch.html">patch</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/python.html">python</a><a href="http://davidjb.com/tag/zope.html">zope</a></p>
</footer><!-- /.post-info -->                <p>Due to various reasons, the Products.LDAPUserFolder package available
for Plone and Zope doesn&#8217;t support <span class="caps">POSIX</span> groups.&nbsp; The &#8216;official&#8217; (ish)
reason for this is because of the fact that these groups don&#8217;t store
full distinguished names (DNs) for members.&nbsp; It makes some degree of
sense, because a user ...</p>
                <a class="readmore" href="http://davidjb.com/blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/">read more</a>
                <p>There are <a href="http://davidjb.com/blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://planet.plone.org">Planet Plone</a></li>
                                                    <li><a href="http://jcu.me">jcu.me Research Porfolio</a></li>
                                                    <li><a href="http://xckd.com">XKCD</a></li>
                                                    <li><a href="http://appleinsider.com/">Apple Insider</a></li>
                                                    <li><a href="http://git.io/djb">Latest coding activity</a></li>
                                                    <li><a href="http://www.ozbargain.com.au">OzBargain</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://git.io/djb">GitHub</a></li>
                                                    <li><a href="http://twitter.com/davidjb_">Twitter</a></li>
                                                    <li><a href="http://linkedin.com/in/davidbeitey">LinkedIn</a></li>
                                                    <li><a href="http://facebook.com/david.beitey">Facebook</a></li>
                                                    <li><a href="https://plus.google.com/u/0/106527454335411502430">Google+</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24253455-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'davidjb';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>