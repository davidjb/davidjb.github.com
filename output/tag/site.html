<!DOCTYPE html>
<html lang="en">
<head>
        <title>DavidJB.com - site</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://davidjb.com/theme/css/main.css" type="text/css" />
                <link href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="DavidJB.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://davidjb.com/css/ie.css"/>
                <script src="http://davidjb.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://davidjb.com/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://davidjb.com/">DavidJB.com  <strong>Ramblings about Plone, Pyramid, Python, the web, Linux, roses and more.</strong></a></h1>
                <nav><ul>
                                                    <li><a href="http://davidjb.com/about.html">About&nbsp;me</a></li>
                                    <li><a href="http://davidjb.com/blog/index.html">Blog</a></li>
                                    <li><a href="http://davidjb.com/projects.html">Projects</a></li>
                                                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://davidjb.com/blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/">Migrating Plone 2.5 content straight onto Plone&nbsp;4</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2011-01-14T15:07:00">
                Fri 14 January 2011
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plone.html">Plone</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/content.html">content</a><a href="http://davidjb.com/tag/migration.html">migration</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/settings.html">settings</a><a href="http://davidjb.com/tag/site.html">site</a></p>
</footer><!-- /.post-info --><p>It&#8217;s my very last Plone 2.5 site and I&#8217;m very happy to see the back of
it.&nbsp; Using the joy that is <strong>quintagroup.transmogrifier</strong>, I was able
to, without much manual effort, migrate my content from a Plone 2.5 site
(constructed with instancemanager, of all things!) straight into a shiny
new Plone 4 site on&nbsp;Buildout.</p>
<p>My only key need was to port the content and structure, and I was happy
to make big allowances for the sake of certain content and time.&nbsp; So, my
thoughts here mightn&#8217;t (probably won&#8217;t!) suit everyone.My requirements
and allowances were&nbsp;these:</p>
<ul class="simple">
<li>Content and structure only needed to be migrated.&nbsp; Plone settings,
theme, user accounts, and everything else would either come from my
newly-created Plone 4 theme or be manually&nbsp;re-added.</li>
<li>There were/are only a handful of users on the&nbsp;site.</li>
<li>My Plone 2.5 site used a lot of custom content types (IronicWiki,
Wicked, Quills, PloneSoftwareCentre, Poi and more).<ul>
<li>I want to avoid ever going through migrating custom &#8216;document&#8217;
types again.&nbsp; Thankfully, the &#8216;wiki&#8217;-based content types translate
easily to pure Plone&nbsp;documents.</li>
<li>I was happy to jettison content in <span class="caps">PSC</span>, Poi, and Quills
(Weblogs).&nbsp; This is a big issue but it wasn&#8217;t worth my time since
the content was already 5+ years out of date and never&nbsp;used.</li>
</ul>
</li>
<li>Default folder view selections don&#8217;t appear to migrate.&nbsp; I was able
to manually fix things&nbsp;up.</li>
</ul>
<p>That out of the way, here&#8217;s my&nbsp;process.</p>
<div class="section" id="for-plone-2-5">
<h2>For Plone&nbsp;2.5</h2>
<ol class="arabic simple">
<li>Follow Step 1 of <a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone2-3">QuintaGroup&#8217;s instructions</a> for migrating a
Plone 2.1 site to Plone 3.&nbsp; I had a Plone 2.5 site and this worked
well.&nbsp; Essentially, you want to use ZopeSkel (paster) to create
yourself a Plone 2.5 buildout and then checkout the relevant packages
(as per the instructions).&nbsp; I created mine on my local Ubuntu machine
for my sanity as the old server the site was running on was ages out
of&nbsp;date.</li>
<li>Figure out what you need to actually get the Plone 2.5 instance to
start up.&nbsp; Now, my site had a huge amount of 3rd party packages that
caused me grief, and I had to add these into the buildout before the
instance would even start successfully.&nbsp; In my case, it was a matter
of copying out the old product web links from my instancemanager
script and putting them in the <strong>productdistros</strong> section of my Plone
2.5 buildout.<ul>
<li>Note that if your Plone instance was entirely manually managed,
then I&#8217;m guess you either on a hunt, or you could try copying the
files into your relevant&nbsp;directory.</li>
<li>I also had a number of <span class="caps">SVN</span>-based products too so I employed my
fried, mr.developer, to check them out from the right <span class="caps">SVN</span> location
to the buildout src&nbsp;directory.</li>
</ul>
</li>
<li>Once you&#8217;ve got your instance started (in the foreground), then you
should be able to access
<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>/&lt;your_site_name&gt;/&#64;&#64;pipeline-config which is
the configuration for Transmogrifier.<ol class="arabic">
<li>You can modify your configuration to suit you.&nbsp; There&#8217;s a little
learning involved here, but there are a good number of
Transmogrifier resources&nbsp;around.</li>
<li>My configuration looks like this: <a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-export.txt">transmogrifier-export.txt</a>,
where I explicitly ignore a whole bunch of content types (read:
problematic for export/import), and export my content out to a
temporary&nbsp;directory</li>
<li>Make changes to the export configuration and save the&nbsp;result.</li>
</ol>
</li>
<li>Under the <span class="caps">ZMI</span>, head into portal_setup and click the &#8216;Properties&#8217;
tab.&nbsp; Change the active site configuration to be &#8216;Transmogrifier&#8217; and
save&nbsp;this.</li>
<li>Click the &#8216;Export&#8217; tab at the top, and then export the &#8216;Content&#8217; step
you see listed.&nbsp; Watch your console output for progress and anything
that might be a&nbsp;problem.</li>
<li>If successful, then you&#8217;ll get presented with a generic setup .tar.gz
to download.&nbsp; Save this somewhere useful; you&#8217;ll need it shortly.&nbsp; If
you were like me and exported to a directory, then you&#8217;ll get an
&#8216;empty&#8217; .tar.gz download and your content will be in the directory
you&nbsp;specified.</li>
</ol>
</div>
<div class="section" id="manually-modify-content-before-import">
<h2>Manually modify content before&nbsp;import</h2>
<p>The reason I outputted to a directory so was I could hack a few things
around in my content. Transmogrifier is powerful, but a bit complicated.
I couldn&#8217;t find out how to rename a field to another in the pipeline (eg
IronicWiki content use the &#8220;body&#8221; field rather than &#8220;text&#8221; as do normal
Document content), and likewise I couldn&#8217;t successfully translate
content type&nbsp;names.</p>
<p>So, find and replace it is. WickedDocs and IronicWiki are essentially
modern Plone Documents in disguise (as wiki markup is the same), so we
can just translate them over. In addition, I go ahead and rename
anything that&#8217;s called &#8220;index_html&#8221; as this would otherwise be
displayed as the actual page on a given folder automagically (and not
through being selected in the Display drop down&nbsp;menu):</p>
<pre class="code bash literal-block">
<span class="nb">cd</span> /path/to/our/temp/directory
grep -lr -e <span class="s1">'WickedDoc'</span> * | xargs sed -i <span class="s1">'s/WickedDoc/Document/g'</span>
grep -lr -e <span class="s1">'IronicWiki'</span> * | xargs sed -i <span class="s1">'s/name=\&quot;body\&quot;/name=\&quot;text\&quot;/g'</span>
grep -lr -e <span class="s1">'IronicWiki'</span> * | xargs sed -i <span class="s1">'s/IronicWiki/Document/g'</span>
find . -name index_html | xargs rename -v <span class="s1">'s/index_html/main_page/g'</span>
grep -lr -e <span class="s1">'index_html'</span> * | xargs sed -i <span class="s1">'s/index_html/main_page/g'</span>
grep -lr -e <span class="s1">'copy_of_main_page'</span> * | xargs sed -i <span class="s1">'s/copy_of_main_page/copy_of_index_html/g'</span>
</pre>
<p>Once done with this, I copied the &#8216;structure&#8217; directory (inside the temp
directory) into the .tar.gz you have from earlier, ready for upload to
the new&nbsp;site.</p>
</div>
<div class="section" id="for-plone-4">
<h2>For Plone&nbsp;4</h2>
<ol class="arabic simple">
<li>Set up your Plone 4 like normal.&nbsp; You should (are?) using Buildout,
so follow the instructions <a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone3-4#Installationonbuildout">here</a>, again from QuintaGroup, to
install the same quintagroup.transmogrifier product into your Plone 4
instance (eg just add it into your eggs and zcml for your&nbsp;instance).</li>
<li>Create a Plone site if you haven&#8217;t&nbsp;already.</li>
<li>Like before, you can use the configuration page at
<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>/&lt;your_site_name&gt;/&#64;&#64;pipeline-config , except
this time, configure the import options.&nbsp; My config looks like this:
<a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-import.txt">transmogrifier-import.txt</a> - pretty much the same as the&nbsp;default.</li>
<li>When you&#8217;re ready, head into the <span class="caps">ZMI</span> and into &#8216;portal_setup&#8217;, this
time clicking on the &#8216;Import&#8217;&nbsp;tab.</li>
<li>Browse down to the very bottom of the page, and use the file field
(hint: Browse button) to locate your .tar.gz file you&#8217;ve&nbsp;prepared.</li>
<li>Click &#8216;Import uploaded tarball&#8217; and watch your console output for&nbsp;progress.</li>
</ol>
</div>
<div class="section" id="cleaning-up">
<h2>Cleaning&nbsp;up</h2>
<p>This process wasn&#8217;t without manual work, unfortunately.&nbsp; But, it
certainly took care of 95% of the pain of copying content across!
Here&#8217;s an overview of the manual work I had to&nbsp;do:</p>
<ul class="simple">
<li>Set default pages of folders.&nbsp; This could have probably been carried
out by a script but I didn&#8217;t write one because I only had a 20
folders to fix.&nbsp; In Plone 2.5, I believe the default view was when
you set a page to be called &#8216;index_html&#8217; (happy for corrections),
but <span class="caps">AFAIK</span>, there weren&#8217;t options to set a certain page as the&nbsp;view.</li>
<li>Set site settings.&nbsp; This involved going through all control panels to
pick and manually port settings, but because of so many changes from
Plone 2.5 to 4, there&#8217;s probably not an obvious migration path&nbsp;anyway.</li>
<li>Convert legacy portlets.&nbsp; These settings do get copied across, but
you&#8217;ll need to go to the &#8216;Manage portlets&#8217; link on your main homepage
and click the &#8216;Convert&#8217; button.&nbsp; At time of writing (Plone 4.0.2)
this migration is actually broken (ticket logged already!) but you
can just as easily migrate manually &#8212; look in the <span class="caps">ZMI</span> properties at
the site root for your portlet&nbsp;listings.</li>
<li>Fix some workflow states.&nbsp; My old site used a non-default workflow,
so workflow states needed correcting.&nbsp; Thankfully, I was able to push
most content around just using the Types control&nbsp;panel.</li>
</ul>
<p>And the rest of the actions I did were simply boilerplate for setting up
a Plone 4 site (theme installation,&nbsp;etc).</p>
<p>This isn&#8217;t the most straightforward path, but it did work and get my
content across.&nbsp; Hopefully moving to Plone 5 and above won&#8217;t be too much
of a&nbsp;problem.</p>
</div>
<p>There are <a href="http://davidjb.com/blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/#disqus_thread">comments</a>.</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://davidjb.com/blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/" rel="bookmark"
                           title="Permalink to Plone: SiteManager leftovers; not the good kind">Plone: SiteManager leftovers; not the good&nbsp;kind</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-06-28T14:35:00">
                Mon 28 June 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plone.html">Plone</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/egg.html">egg</a><a href="http://davidjb.com/tag/error.html">error</a><a href="http://davidjb.com/tag/install.html">install</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/problem.html">problem</a><a href="http://davidjb.com/tag/site.html">site</a><a href="http://davidjb.com/tag/update.html">update</a><a href="http://davidjb.com/tag/zope.html">zope</a></p>
</footer><!-- /.post-info -->                <div class="note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Update:</strong> You should check out <a class="reference external" href="http://pypi.python.org/pypi/wildcard.fixpersistentutilities">wildcard.fixpersistentutilities</a>
- it&#8217;s a fantastic solution to problems like this. Many thanks to
Nathan Van Gheem, the author of the add on. Check out the link and
see how to install it (temporarily) on your Plone instance that
needs its site manager cleaned ...</p></div>
                <a class="readmore" href="http://davidjb.com/blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/">read more</a>
                <p>There are <a href="http://davidjb.com/blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://davidjb.com/blog/2010/02/wget-a-plone-site-and-make-it-actually-work/" rel="bookmark"
                           title="Permalink to Wget a Plone site (and make it actually work)">Wget a Plone site (and make it actually&nbsp;work)</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-02-25T15:01:00">
                Thu 25 February 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plon.html">Plon</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/cd.html">cd</a><a href="http://davidjb.com/tag/content.html">content</a><a href="http://davidjb.com/tag/download.html">download</a><a href="http://davidjb.com/tag/dvd.html">dvd</a><a href="http://davidjb.com/tag/export.html">export</a><a href="http://davidjb.com/tag/media.html">media</a><a href="http://davidjb.com/tag/offline.html">offline</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/site.html">site</a><a href="http://davidjb.com/tag/static.html">static</a><a href="http://davidjb.com/tag/wget.html">wget</a></p>
</footer><!-- /.post-info -->                <p>There&#8217;s a lot of different resources and posts on the
web about how to export a Plone site to static html content, but no
methodology would actually solve all of my problems. Now, Plone is
inherently a complicated beast, given just how much it does, and that&#8217;s
definitely ...</p>
                <a class="readmore" href="http://davidjb.com/blog/2010/02/wget-a-plone-site-and-make-it-actually-work/">read more</a>
                <p>There are <a href="http://davidjb.com/blog/2010/02/wget-a-plone-site-and-make-it-actually-work/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="http://davidjb.com/blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/" rel="bookmark"
                           title="Permalink to Migrating a Plone site off to another database (Zeo)">Migrating a Plone site off to another database&nbsp;(Zeo)</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2009-09-30T12:25:00">
                Wed 30 September 2009
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://davidjb.com/author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="http://davidjb.com/category/plone.html">Plone</a>. </p>
<p>tags: <a href="http://davidjb.com/tag/database.html">database</a><a href="http://davidjb.com/tag/export.html">export</a><a href="http://davidjb.com/tag/import.html">import</a><a href="http://davidjb.com/tag/migration.html">migration</a><a href="http://davidjb.com/tag/plone.html">plone</a><a href="http://davidjb.com/tag/site.html">site</a><a href="http://davidjb.com/tag/zeo.html">zeo</a><a href="http://davidjb.com/tag/zodb.html">zodb</a></p>
</footer><!-- /.post-info -->                <p>Another of the interesting things in my professional life has been
migrating a Plone site from one database (where it lived as a dev site,
along with many others) onto a nice, clean database of its own.&nbsp; Now,
yes, I&#8217;m aware that the export/import feature of Zope <strong>isn ...</strong></p>
                <a class="readmore" href="http://davidjb.com/blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/">read more</a>
                <p>There are <a href="http://davidjb.com/blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://planet.plone.org">Planet Plone</a></li>
                                                    <li><a href="http://jcu.me">jcu.me Research Porfolio</a></li>
                                                    <li><a href="http://xckd.com">XKCD</a></li>
                                                    <li><a href="http://appleinsider.com/">Apple Insider</a></li>
                                                    <li><a href="http://git.io/djb">Latest coding activity</a></li>
                                                    <li><a href="http://www.ozbargain.com.au">OzBargain</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://git.io/djb">GitHub</a></li>
                                                    <li><a href="http://twitter.com/davidjb_">Twitter</a></li>
                                                    <li><a href="http://linkedin.com/in/davidbeitey">LinkedIn</a></li>
                                                    <li><a href="http://facebook.com/david.beitey">Facebook</a></li>
                                                    <li><a href="https://plus.google.com/u/0/106527454335411502430">Google+</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24253455-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'davidjb';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>