<!DOCTYPE html>
<html lang="en">
<head>
        <title>PloneFormGen (Plone) & Google Calendar Integration</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../../../../theme/css/main.css" type="text/css" />
                <link href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="DavidJB.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie.css"/>
                <script src="../../../../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">DavidJB.com  <strong>Ramblings about Plone, Pyramid, Python, the web, Linux, roses and more.</strong></a></h1>
                <nav><ul>
                                                    <li><a href="../../../../pages/about-me.html">About&nbsp;me</a></li>
                                    <li><a href="../../../../pages/blog.html">Blog</a></li>
                                    <li><a href="../../../../pages/projects.html">Projects</a></li>
                                                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../blog/2009/09/ploneformgen-plone-google-calendar-integration/" rel="bookmark"
           title="Permalink to PloneFormGen (Plone) & Google Calendar Integration">PloneFormGen (Plone) <span class="amp">&amp;</span> Google Calendar&nbsp;Integration</a></h1>
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="davidjb_">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2009-09-22T10:40:00">
                Tue 22 September 2009
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../../../../author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="../../../../category/plone.html">Plone</a>. </p>
<p>tags: <a href="../../../../tag/calendar.html">calendar</a><a href="../../../../tag/form.html">form</a><a href="../../../../tag/gen.html">gen</a><a href="../../../../tag/google.html">google</a><a href="../../../../tag/mash.html">mash</a><a href="../../../../tag/pfg.html">pfg</a><a href="../../../../tag/plone.html">plone</a><a href="../../../../tag/product.html">product</a><a href="../../../../tag/python.html">python</a><a href="../../../../tag/script.html">script</a></p>
</footer><!-- /.post-info -->      <p>It&#8217;s a little bit of a different mash-up, but it&#8217;s still nonetheless
useful to have, given types of booking forms and so forth that could
utilise it.&nbsp; The easiest way I found (to avoid security issues with
Python scripts in Plone) was to create an external method and just
import it within a <span class="caps">PFG</span> Custom&nbsp;Adapter.</p>
<div class="section" id="parts">
<h2>Parts</h2>
<ul>
<li><p class="first">My <a class="reference external" href="../../../../static/files/GoogleCalendar.py">GoogleCalendar.py</a> external method.&nbsp; I&#8217;ve had to add this into a
policy product I have.&nbsp; The function should be generalised enough to
work with any Google account, hosted or not.&nbsp; In&nbsp;short:</p>
<ul class="simple">
<li>It takes in a variety of arguments (email, password,
calendar_url, start_time, end_time, title, location, content).<ul>
<li>Email/password are your auth&nbsp;details</li>
<li>calendar_url is where you&#8217;re putting the&nbsp;event,</li>
<li>and the rest of the args are related to the event&nbsp;itself.</li>
</ul>
</li>
<li>It builds the <span class="caps">XML</span>-based request to create the event.&nbsp; I tried
going for the gdata <span class="caps">API</span>, but it&#8217;s just over the top for a simple
exercise like&nbsp;this.</li>
<li>Send the request to Google (twice, as required), and create the
event in the&nbsp;process.</li>
</ul>
</li>
<li><p class="first">A custom <span class="caps">PFG</span> script adapter like&nbsp;this:</p>
<pre class="code python literal-block">
<span class="kn">from</span> <span class="nn">DateTime</span> <span class="kn">import</span> <span class="n">DateTime</span>
<span class="kn">from</span> <span class="nn">my.theme.Extensions.GoogleCalendar</span> <span class="kn">import</span> <span class="n">createGoogleCalendarEvent</span>
<span class="n">calendar_url</span> <span class="o">=</span> <span class="s">'http://www.google.com/...'</span>
<span class="n">email</span> <span class="o">=</span> <span class="s">'&lt;span class=&quot;mh-email&quot;&gt;myu&lt;a href=&quot;http://www.google.com/recaptcha/mailhide/d?k=01y8BLyDqFl2lR8hms6kYeaw==&amp;c=WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY=&quot; onclick=&quot;window.open('</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">recaptcha</span><span class="o">/</span><span class="n">mailhide</span><span class="o">/</span><span class="n">d</span><span class="err">?</span><span class="n">k</span><span class="o">=</span><span class="mo">01</span><span class="n">y8BLyDqFl2lR8hms6kYeaw</span><span class="o">==&amp;</span><span class="n">c</span><span class="o">=</span><span class="n">WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY</span><span class="o">=</span><span class="s">', '', '</span><span class="n">toolbar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">scrollbars</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">statusbar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">menubar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">resizable</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="s">'); return false;&quot; title=&quot;Reveal this e-mail address&quot;&gt;...&lt;/a&gt;&#64;google.com&lt;/span&gt;'</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">'shhhhhsecret'</span>
<span class="n">startDateTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">'start-date-time'</span><span class="p">])))</span><span class="o">.</span><span class="n"><span class="caps">HTML4</span></span><span class="p">()</span>
<span class="n">endDateTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">'end-date-time'</span><span class="p">])))</span><span class="o">.</span><span class="n"><span class="caps">HTML4</span></span><span class="p">()</span>
<span class="n">eventTitle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">'purpose'</span><span class="p">])</span>
<span class="n">eventLocation</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">'rooms-to-book'</span><span class="p">])</span>
<span class="n">eventContent</span> <span class="o">=</span> <span class="s">'Booked for:  '</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">'booking-name'</span><span class="p">])</span>
<span class="n">createGoogleCalendarEvent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">calendar_url</span><span class="p">,</span> <span class="n">startDateTime</span><span class="p">,</span> <span class="n">endDateTime</span><span class="p">,</span> <span class="n">eventTitle</span><span class="p">,</span> <span class="n">eventLocation</span><span class="p">,</span> <span class="n">eventContent</span><span class="p">)</span>
</pre>
</li>
</ul>
<p>And that should be that.&nbsp; As long as all your URLs, emails, passwords,
and fields in your form are suitable, this should work a treat.&nbsp; Note
that the start-date-time and end-date-time fields are date/time fields
in your Form Folder and converting to <span class="caps">HTML4</span>() makes them into Google&#8217;s
format.&nbsp; Additional info can be added in the eventContent variable, and
that&#8217;ll turn up in the Description in Google&nbsp;Calendar.</p>
</div>
<div class="section" id="for-added-spice">
<h2>For added&nbsp;spice&#8230;</h2>
<p>Just add a web interface to your Google Calendar to your Plone site (eg
in a normal Plone page; watch out for iframe filtering) and let people
book themselves into things.&nbsp; Would be great to see <span class="caps">PFG</span> know when a
Google Calendar event was on (and stop people submitting) but it&#8217;s a bit
much just for&nbsp;now.</p>
</div>

    </div><!-- /.entry-content -->
        <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "blog/2009/09/ploneformgen-plone-google-calendar-integration/";
        var disqus_url = "../../../../blog/2009/09/ploneformgen-plone-google-calendar-integration/";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://davidjb.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
    
  </article>
</section>
        <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://planet.plone.org">Planet Plone</a></li>
                                                    <li><a href=""></a></li>
                                                    <li><a href=""></a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://git.io/djb">GitHub</a></li>
                                                    <li><a href="http://twitter.com/davidjb_">Twitter</a></li>
                                                    <li><a href="http://linkedin.com/in/davidbeitey">LinkedIn</a></li>
                                                    <li><a href="http://facebook.com/david.beitey">Facebook</a></li>
                                                    <li><a href="https://plus.google.com/u/0/106527454335411502430">Google+</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24253455-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'davidjb';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>