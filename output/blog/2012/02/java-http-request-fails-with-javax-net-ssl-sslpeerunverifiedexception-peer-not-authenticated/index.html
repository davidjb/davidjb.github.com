<!DOCTYPE html>
<html lang="en">
<head>
        <title>Java HTTP request fails with "javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated"</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../../../../theme/css/main.css" type="text/css" />
                <link href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="DavidJB.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie.css"/>
                <script src="../../../../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../../../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">DavidJB.com  <strong>Ramblings about Plone, Pyramid, Python, the web, Linux, roses and more.</strong></a></h1>
                <nav><ul>
                                                    <li><a href="../../../../pages/about-me.html">About me</a></li>
                                    <li><a href="../../../../pages/blog.html">Blog</a></li>
                                    <li><a href="../../../../pages/projects.html">Projects</a></li>
                                                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../blog/2012/02/java-http-request-fails-with-javax-net-ssl-sslpeerunverifiedexception-peer-not-authenticated/" rel="bookmark"
           title="Permalink to Java HTTP request fails with "javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated"">Java HTTP request fails with &quot;javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated&quot;</a></h1>
      <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="davidjb_">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2012-02-16T15:16:00">
                Thu 16 February 2012
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../../../../author/davidjb.html">davidjb</a>
        </address>
        <p>In <a href="../../../../category/linux.html">Linux</a>. </p>
<p>tags: <a href="../../../../tag/certificate.html">certificate</a><a href="../../../../tag/java.html">java</a><a href="../../../../tag/key.html">key</a><a href="../../../../tag/linux.html">linux</a><a href="../../../../tag/ssl.html">ssl</a><a href="../../../../tag/store.html">store</a></p>
</footer><!-- /.post-info -->      <p>Searching the above-mentioned stack trace reveals lots and lots of
results, unsurprisingly. &nbsp;Most results are workarounds where you modify
the code, but what about if an application (like Jenkins/Hudson CI, in
my case) throws this error at you? The reason the error is occurring is
because the SSL certificate of the target you're connecting to isn't
considered valid by your Java instance's keystore. This may be because
the certificate itself is invalid, or, in my case, the CA chain couldn't
be validated (my OS is RHEL (Red Hat) 5.7, with OpenJDK 1.6). &nbsp;For
completeness, I should also mention that the issue here arose when I
asked Jenkins CI to use&nbsp;GitHub OAuth. As GitHub's SSL certificate has
been signed by DigiCert, and this isn't included within RHEL 5.7, the
error arises. &nbsp;A solution is, assuming you trust the cert or the CA, to
add the relevant certificates/root certificates to your Java keystore.</p>
<p>To do so, get your relevant certificates/root certificates, locate your
keystore, and add them accordingly:</p>
<pre class="code bash literal-block">
wget https://www.digicert.com/CACerts/DigiCertHighAssuranceEVCA-1.crt
wget https://www.digicert.com/testroot/DigiCertHighAssuranceEVRootCA.crt
keytool -importcert -storepass changeit -keystore /etc/alternatives/java_sdk/jre/lib/security/cacerts -alias digicertevrootca -file DigiCertHighAssuranceEVRootCA.crt
keytool -importcert -storepass changeit -keystore /etc/alternatives/java_sdk/jre/lib/security/cacerts -alias digicertevca1 -file DigiCertHighAssuranceEVCA-1.crt
</pre>
<p>This resolved the issue for me and GitHub OAuth completed successfully.
If you're having issues with just a single certificate, then just import
that one certificate.</p>
<p>For the interested Googlers, here's what the relevant chunk of
stacktrace looked like:</p>
<pre class="code bash literal-block">
javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated
at sun.security.ssl.SSLSessionImpl.getPeerCertificates<span class="o">(</span>SSLSessionImpl.java:371<span class="o">)</span>
at org.apache.http.conn.ssl.AbstractVerifier.verify<span class="o">(</span>AbstractVerifier.java:128<span class="o">)</span>
at org.apache.http.conn.ssl.SSLSocketFactory.connectSocket<span class="o">(</span>SSLSocketFactory.java:390<span class="o">)</span>
at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection<span class="o">(</span>DefaultClientConnectionOperator.java:148<span class="o">)</span>
at org.apache.http.impl.conn.AbstractPoolEntry.open<span class="o">(</span>AbstractPoolEntry.java:149<span class="o">)</span>
at org.apache.http.impl.conn.AbstractPooledConnAdapter.open<span class="o">(</span>AbstractPooledConnAdapter.java:121<span class="o">)</span>
at org.apache.http.impl.client.DefaultRequestDirector.tryConnect<span class="o">(</span>DefaultRequestDirector.java:562<span class="o">)</span>
at org.apache.http.impl.client.DefaultRequestDirector.execute<span class="o">(</span>DefaultRequestDirector.java:415<span class="o">)</span>
at org.apache.http.impl.client.AbstractHttpClient.execute<span class="o">(</span>AbstractHttpClient.java:820<span class="o">)</span>
at org.apache.http.impl.client.AbstractHttpClient.execute<span class="o">(</span>AbstractHttpClient.java:754<span class="o">)</span>
at org.apache.http.impl.client.AbstractHttpClient.execute<span class="o">(</span>AbstractHttpClient.java:732<span class="o">)</span>
at org.jenkinsci.plugins.GithubSecurityRealm.doFinishLogin<span class="o">(</span>GithubSecurityRealm.java:278<span class="o">)</span>
</pre>
<p>This <a class="reference external" href="http://my.opera.com/karmazilla/blog/how-to-grab-the-certificate-from-a-website-and-import-it-with-java-keytool">fantastic post</a> set me on the right track.</p>

    </div><!-- /.entry-content -->
        <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "blog/2012/02/java-http-request-fails-with-javax-net-ssl-sslpeerunverifiedexception-peer-not-authenticated/";
        var disqus_url = "../../../../blog/2012/02/java-http-request-fails-with-javax-net-ssl-sslpeerunverifiedexception-peer-not-authenticated/";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://davidjb.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
    
  </article>
</section>
        <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://planet.plone.org">Planet Plone</a></li>
                                                    <li><a href=""></a></li>
                                                    <li><a href=""></a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://davidjb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://git.io/djb">GitHub</a></li>
                                                    <li><a href="http://twitter.com/davidjb_">Twitter</a></li>
                                                    <li><a href="http://linkedin.com/in/davidbeitey">LinkedIn</a></li>
                                                    <li><a href="http://facebook.com/david.beitey">Facebook</a></li>
                                                    <li><a href="https://plus.google.com/u/0/106527454335411502430">Google+</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24253455-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'davidjb';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>