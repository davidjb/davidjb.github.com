<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>DavidJB.com</title><link href="http://davidjb.com/" rel="alternate"></link><link href="http://davidjb.com/feeds/plone.atom.xml" rel="self"></link><id>http://davidjb.com/</id><updated>2012-06-22T11:20:00+10:00</updated><entry><title>Members can’t add folders to Plone via WebDAV (401 Unauthorized)</title><link href="http://davidjb.com/blog/2012/06/members-cant-add-folders-to-plone-via-webdav-401-unauthorized/" rel="alternate"></link><updated>2012-06-22T11:20:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2012-06-22:blog/2012/06/members-cant-add-folders-to-plone-via-webdav-401-unauthorized/</id><summary type="html">&lt;p&gt;This is a mirror of the (excellent) documentation at
&lt;a class="reference external" href="http://plone.org/documentation/error/unable-to-create-a-folder-through-webdav/"&gt;http://plone.org/documentation/error/unable-to-create-a-folder-through-webdav/&lt;/a&gt;,
but just a short editorial to also highlight that this is still very
applicable to Plone 4.x. Effectively, the symptom is that users will
report seeing a &amp;#8220;401 Unauthorized&amp;#8221; error when trying to create folders
within areas they have access to as an Owner. &amp;nbsp;Without further ado, the&amp;nbsp;documentation:&lt;/p&gt;
&lt;p&gt;Using a&amp;nbsp;WebDAV&amp;nbsp;client on a&amp;nbsp;Plone&amp;nbsp;site, site users are unable to create
newfolders&amp;nbsp;directories where they have Owner&amp;nbsp;role.&lt;/p&gt;
&lt;div class="section" id="problem"&gt;
&lt;h2&gt;Problem:&lt;/h2&gt;
&lt;p&gt;The&amp;nbsp;WebDAV&amp;nbsp;&amp;#8220;make folder&amp;#8221; method, &lt;span class="caps"&gt;MKCOL&lt;/span&gt;, requires the &amp;#8220;Add&amp;nbsp;Folders&amp;#8221;
permission. This is not normally granted to Members or Owners on the&amp;nbsp;site.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="workaround"&gt;
&lt;h2&gt;Workaround:&lt;/h2&gt;
&lt;p&gt;In the Zope Management Interface, under the &amp;#8220;Security&amp;#8221; tab for
the&amp;nbsp;Plone&amp;nbsp;root, check the &amp;#8220;Owners&amp;#8221; box for the &amp;#8220;Add&amp;nbsp;Folders&amp;#8221; permission&amp;nbsp;setting.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="folder"></category><category term="http"></category><category term="plone"></category><category term="upload"></category><category term="webdav"></category></entry><entry><title>User IDs show as comment authors in Plone 4.x after migration from plone.app.discussion</title><link href="http://davidjb.com/blog/2011/11/user-ids-show-as-comment-authors-in-plone-4-x-after-migration-from-plone-app-discussion/" rel="alternate"></link><updated>2011-11-01T13:18:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-11-01:blog/2011/11/user-ids-show-as-comment-authors-in-plone-4-x-after-migration-from-plone-app-discussion/</id><summary type="html">&lt;p&gt;If you&amp;#8217;ve migrated your site from earlier versions of Plone to the
latest ones in the 4.x series, or else have started using
plone.app.discussion earlier than that, you might have come across a
situation where comments on your site show user IDs as authors rather
than a user&amp;#8217;s full name. If you see this anywhere, chances are your
comment&amp;#8217;s migration didn&amp;#8217;t go according to plan, and that the Creator
information didn&amp;#8217;t get recorded correctly on the&amp;nbsp;comment.&lt;/p&gt;
&lt;p&gt;I&amp;#8217;ve just written this on the Collective developer docs:
&lt;a class="reference external" href="http://readthedocs.org/docs/collective-docs/en/latest/misc/upgrade.html#fixing-creator-details-on-existing-comments"&gt;http://readthedocs.org/docs/collective-docs/en/latest/misc/upgrade.html#fixing-creator-details-on-existing-comments&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The script there should help by stepping through all comments on your
site and fixing up the creator details as required. As mentioned in the
comments beneath the script, the mileage you get may vary depending on
the state of your comments. I found half my site&amp;#8217;s comments were fine
and half weren&amp;#8217;t. Some of mine had no author name, email, or user &lt;span class="caps"&gt;ID&lt;/span&gt; in
the relevant fields, and the script there checks for these (and the
actual existence of a user after looking up what&amp;#8217;s in the Creator
property), so that should be enough to sanity-check so it won&amp;#8217;t stomp
over correct&amp;nbsp;comments.&lt;/p&gt;
&lt;p&gt;That said, if for some reason, you happened to have a user with &lt;span class="caps"&gt;ID&lt;/span&gt;
&lt;em&gt;david&lt;/em&gt; and full name of &lt;em&gt;Administrator&lt;/em&gt;, also had a user with the &lt;span class="caps"&gt;ID&lt;/span&gt; of
&lt;em&gt;Administrator&lt;/em&gt;, and had a comment which had an incorrect &lt;em&gt;Creator&lt;/em&gt; but
did have the three fields of &lt;em&gt;author_username&lt;/em&gt;, &lt;em&gt;author_name&lt;/em&gt;, and
&lt;em&gt;author_email&lt;/em&gt;, then it won&amp;#8217;t affect those comments and you might just
have to manually fix them&amp;nbsp;up.&lt;/p&gt;
</summary><category term="collective"></category><category term="comments"></category><category term="discussion"></category><category term="docs"></category><category term="documentation"></category><category term="fix"></category><category term="plone"></category></entry><entry><title>Epic-sized (Really Large) Files with Plone 4.1.2</title><link href="http://davidjb.com/blog/2011/10/epic-sized-files-with-plone-4-1-2/" rel="alternate"></link><updated>2011-10-12T16:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-10-12:blog/2011/10/epic-sized-files-with-plone-4-1-2/</id><summary type="html">&lt;p&gt;In case you were ever curious, it&amp;#8217;s definitely possible to upload
epic-sized files within the Plone &lt;span class="caps"&gt;CMS&lt;/span&gt;. Browser support aside (Firefox
and your 2 &lt;span class="caps"&gt;GB&lt;/span&gt; limits, I&amp;#8217;m looking you), I&amp;#8217;d previously had issues with
being able to upload files larger than 4 &lt;span class="caps"&gt;GB&lt;/span&gt;, if memory serves correctly.
Previously, there was an issue with files causing out-of-memory issues,
and I&amp;#8217;m fairly sure the errors I was getting were related to what was
fixed by &lt;a class="reference external" href="https://dev.plone.org/collective/changeset/244916/Products.CMFEditions/trunk/"&gt;this change&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For today&amp;#8217;s test, Google Chrome was able to upload a 26.3 &lt;span class="caps"&gt;GB&lt;/span&gt;
(28212643840 bytes) .tar file into Plone on my local&amp;nbsp;machine:&lt;/p&gt;
&lt;img alt="|filename|images/2011-10-12-j9bibwU5DR.png" src="http://davidjb.com/static/images/2011-10-12-j9bibwU5DR.png" /&gt;
&lt;p&gt;It took a long while (even with my &lt;span class="caps"&gt;SSD&lt;/span&gt;) but it made it. No tracebacks or
memory leaks with Plone/Zope so kudos to the developers. It&amp;#8217;s
interesting to note that the file upload process seemingly took 2x
(double) the amount of disk space &amp;#8212; half was for a file in the /tmp/
directory, and I didn&amp;#8217;t end up tracking down the other one. Presumably
something like pre-allocated space for the final file,&amp;nbsp;perhaps.&lt;/p&gt;
&lt;p&gt;Anyway, it works! Should you do this? Maybe, if you&amp;#8217;ve got space and
don&amp;#8217;t mind hammering your &lt;span class="caps"&gt;CPU&lt;/span&gt; for your server during the upload
process.&amp;nbsp; I&amp;#8217;ll go for larger next time..only problem is my &lt;span class="caps"&gt;SSD&lt;/span&gt; is only
&lt;span class="caps"&gt;240GB&lt;/span&gt; so something like a &lt;span class="caps"&gt;500GB&lt;/span&gt; file (eg &lt;span class="caps"&gt;1TB&lt;/span&gt; needed at least) will just
have to&amp;nbsp;wait.&lt;/p&gt;
</summary><category term="blob"></category><category term="file"></category><category term="large"></category><category term="plone"></category></entry><entry><title>AttributeError: ‘NoneType’ object has no attribute ‘items’: Can’t upgrade Plone 3 to 4.x</title><link href="http://davidjb.com/blog/2011/09/attributeerror-nonetype-object-has-no-attribute-items-cant-upgrade-plone-3-to-4-x/" rel="alternate"></link><updated>2011-09-14T08:57:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-09-14:blog/2011/09/attributeerror-nonetype-object-has-no-attribute-items-cant-upgrade-plone-3-to-4-x/</id><summary type="html">&lt;p&gt;You may have seen an error like the one below when you&amp;#8217;ve gone to
upgrade your Plone site to something in the Plone 4.x series from Plone&amp;nbsp;3:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2011-09-14 08:43:32 &lt;span class="caps"&gt;ERROR&lt;/span&gt; plone.app.upgrade Upgrade aborted. Error:
&lt;/span&gt;&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/Products.CMFPlone-4.1-py2.6.egg/Products/CMFPlone/MigrationTool.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;175&lt;/span&gt;, in &lt;span class="n"&gt;upgrade&lt;/span&gt;
    &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'step'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;doStep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/Products.GenericSetup-1.6.3-py2.6.egg/Products/GenericSetup/upgrade.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;142&lt;/span&gt;, in &lt;span class="n"&gt;doStep&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tool&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/plone.app.upgrade-1.1-py2.6.egg/plone/app/upgrade/v41/alphas.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;105&lt;/span&gt;, in &lt;span class="n"&gt;add_siteadmin_role&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;permission_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;roles&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;state&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;permission_roles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="gr"&gt;AttributeError&lt;/span&gt;: &lt;span class="n"&gt;'NoneType' object has no attribute 'items'&lt;/span&gt;
&lt;span class="x"&gt;2011-09-14 08:43:32 &lt;span class="caps"&gt;INFO&lt;/span&gt; plone.app.upgrade End of upgrade path, migration has finished
2011-09-14 08:43:32 &lt;span class="caps"&gt;ERROR&lt;/span&gt; plone.app.upgrade The upgrade path did &lt;span class="caps"&gt;NOT&lt;/span&gt; reach current version
2011-09-14 08:43:32 &lt;span class="caps"&gt;ERROR&lt;/span&gt; plone.app.upgrade Migration has failed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;If you&amp;#8217;ve hit this, this means that you have a &lt;strong&gt;workflow state&lt;/strong&gt;
somewhere on your portal that has no specific permissions associated
with it (or otherwise has all permissions set as &lt;tt class="docutils literal"&gt;Acquire&lt;/tt&gt;). An easy way
around this is to go find that workflow state (look in custom
workflows!) in portal_workflow in the &lt;span class="caps"&gt;ZMI&lt;/span&gt; and temporarily change the
state or states so they have a&amp;nbsp;permission.&lt;/p&gt;
&lt;p&gt;Then, go ahead and upgrade your portal to Plone 4.x and you can change
your permission&amp;nbsp;back.&lt;/p&gt;
</summary><category term="4.1"></category><category term="plone"></category><category term="plone 4"></category><category term="traceback"></category><category term="upgrade"></category></entry><entry><title>Watch out: Python 2.4 ZEO client and Python 2.6 ZEO Server</title><link href="http://davidjb.com/blog/2011/07/watch-out-python-2-4-zeo-client-and-python-2-6-zeo-server/" rel="alternate"></link><updated>2011-07-11T16:23:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-07-11:blog/2011/07/watch-out-python-2-4-zeo-client-and-python-2-6-zeo-server/</id><summary type="html">&lt;p&gt;Today was interesting when an issue with saving content on a Plone 3.3.5
site got reported to me. The system was producing undecipherable error
messages about &lt;span class="caps"&gt;ZEO&lt;/span&gt; disconnections and database conflicts whenever
someone would try and create some content within Plone (folders,
particularly). Errors looked&amp;nbsp;like:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Module &lt;span class="caps"&gt;ZEO&lt;/span&gt;.zrpc.connection, line 796, in wait. DisconnectedError&amp;quot; and &amp;quot;raise ReadConflictError().
ReadConflictError: database read conflict error&amp;quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and&amp;nbsp;also:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;&lt;span class="caps"&gt;ERROR&lt;/span&gt; &lt;span class="caps"&gt;ZEO&lt;/span&gt;.zrpc (2515) can't decode message: '(K\x11K\x01U\tserialnos(]((U\x08\x00\x00\x00\x00\x00X\x...'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&amp;#8212; essentially the issue described &lt;a class="reference external" href="https://mail.zope.org/pipermail/zodb-dev/2010-December/013893.html"&gt;here&lt;/a&gt;. My &lt;span class="caps"&gt;ZEO&lt;/span&gt; server was running
&lt;span class="caps"&gt;ZODB3&lt;/span&gt; 3.9.5 with Python 2.6, and my client running &lt;span class="caps"&gt;ZODB3&lt;/span&gt; 3.8.3 with
Python 2.4; almost everything&amp;nbsp;worked.&lt;/p&gt;
&lt;p&gt;The long and the short of this issue appears to be, as the &lt;a class="reference external" href="http://pypi.python.org/pypi/ZODB3/3.9.5#compatibility"&gt;&lt;span class="caps"&gt;ZODB&lt;/span&gt;
documentation mentions&lt;/a&gt;, is that Python 2.4 servers work with 2.5+
clients, but not the other way around.&amp;nbsp; It&amp;#8217;s slightly misleading when
you read further and see&amp;nbsp;that:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
ZODB ZEO clients from ZODB 3.2 on can talk to ZODB 3.9 servers. ZODB
ZEO Clients can talk to ZODB 3.8 and 3.9 ZEO servers.
&lt;/pre&gt;
&lt;p&gt;So, despite this seeming interoperability, dang - I can&amp;#8217;t use my
pre-existing &lt;span class="caps"&gt;ZEO&lt;/span&gt; server setup (based on the Plone 4 buildout for
versions, etc) which is currently in place and&amp;nbsp;running.&lt;/p&gt;
&lt;p&gt;Thankfully, building being what it is, the solution for me was to simply
re-use that buildout for any Plone instances that are Python 2.4
clients.&amp;nbsp; This was as simple as re-cloning my git repository where I
keep the buildouts, firing up a brand new virtualenv for Python 2.4, and
moving the data&amp;nbsp;across.&lt;/p&gt;
&lt;div class="section" id="one-more-thing"&gt;
&lt;h2&gt;One more&amp;nbsp;thing&amp;#8230;&lt;/h2&gt;
&lt;p&gt;There is one final thing worth mentioning, which I got awfully caught
out by.&amp;nbsp; I was finding that my &lt;span class="caps"&gt;ZEO&lt;/span&gt; processes, under this new
environment, just would not start - essentially, they would keep
respawning again and again until they stopped (triggered by some
&amp;#8216;quick-respawn&amp;#8217; safety mechanism, seemingly).&amp;nbsp; I thought this was some
issue concerning the fact I&amp;#8217;d had my databases and files loaded against
newer &lt;span class="caps"&gt;ZEO&lt;/span&gt; versions, but this actually not.&amp;nbsp; This was a by-product of not
having my &lt;span class="caps"&gt;ZEO&lt;/span&gt; authentication database present - because there was no
file, presumably the processes kept crashing.&amp;nbsp; Sadly, no error message,
so hence this note.&amp;nbsp; Take care with this&amp;nbsp;one.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="database"></category><category term="fs"></category><category term="plone"></category><category term="server"></category><category term="zeo"></category><category term="zope"></category></entry><entry><title>Migrating Plone 2.5 content straight onto Plone 4</title><link href="http://davidjb.com/blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/" rel="alternate"></link><updated>2011-01-14T15:07:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-01-14:blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/</id><summary type="html">&lt;p&gt;It&amp;#8217;s my very last Plone 2.5 site and I&amp;#8217;m very happy to see the back of
it.&amp;nbsp; Using the joy that is &lt;strong&gt;quintagroup.transmogrifier&lt;/strong&gt;, I was able
to, without much manual effort, migrate my content from a Plone 2.5 site
(constructed with instancemanager, of all things!) straight into a shiny
new Plone 4 site on&amp;nbsp;Buildout.&lt;/p&gt;
&lt;p&gt;My only key need was to port the content and structure, and I was happy
to make big allowances for the sake of certain content and time.&amp;nbsp; So, my
thoughts here mightn&amp;#8217;t (probably won&amp;#8217;t!) suit everyone.My requirements
and allowances were&amp;nbsp;these:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Content and structure only needed to be migrated.&amp;nbsp; Plone settings,
theme, user accounts, and everything else would either come from my
newly-created Plone 4 theme or be manually&amp;nbsp;re-added.&lt;/li&gt;
&lt;li&gt;There were/are only a handful of users on the&amp;nbsp;site.&lt;/li&gt;
&lt;li&gt;My Plone 2.5 site used a lot of custom content types (IronicWiki,
Wicked, Quills, PloneSoftwareCentre, Poi and more).&lt;ul&gt;
&lt;li&gt;I want to avoid ever going through migrating custom &amp;#8216;document&amp;#8217;
types again.&amp;nbsp; Thankfully, the &amp;#8216;wiki&amp;#8217;-based content types translate
easily to pure Plone&amp;nbsp;documents.&lt;/li&gt;
&lt;li&gt;I was happy to jettison content in &lt;span class="caps"&gt;PSC&lt;/span&gt;, Poi, and Quills
(Weblogs).&amp;nbsp; This is a big issue but it wasn&amp;#8217;t worth my time since
the content was already 5+ years out of date and never&amp;nbsp;used.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Default folder view selections don&amp;#8217;t appear to migrate.&amp;nbsp; I was able
to manually fix things&amp;nbsp;up.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That out of the way, here&amp;#8217;s my&amp;nbsp;process.&lt;/p&gt;
&lt;div class="section" id="for-plone-2-5"&gt;
&lt;h2&gt;For Plone&amp;nbsp;2.5&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Follow Step 1 of &lt;a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone2-3"&gt;QuintaGroup&amp;#8217;s instructions&lt;/a&gt; for migrating a
Plone 2.1 site to Plone 3.&amp;nbsp; I had a Plone 2.5 site and this worked
well.&amp;nbsp; Essentially, you want to use ZopeSkel (paster) to create
yourself a Plone 2.5 buildout and then checkout the relevant packages
(as per the instructions).&amp;nbsp; I created mine on my local Ubuntu machine
for my sanity as the old server the site was running on was ages out
of&amp;nbsp;date.&lt;/li&gt;
&lt;li&gt;Figure out what you need to actually get the Plone 2.5 instance to
start up.&amp;nbsp; Now, my site had a huge amount of 3rd party packages that
caused me grief, and I had to add these into the buildout before the
instance would even start successfully.&amp;nbsp; In my case, it was a matter
of copying out the old product web links from my instancemanager
script and putting them in the &lt;strong&gt;productdistros&lt;/strong&gt; section of my Plone
2.5 buildout.&lt;ul&gt;
&lt;li&gt;Note that if your Plone instance was entirely manually managed,
then I&amp;#8217;m guess you either on a hunt, or you could try copying the
files into your relevant&amp;nbsp;directory.&lt;/li&gt;
&lt;li&gt;I also had a number of &lt;span class="caps"&gt;SVN&lt;/span&gt;-based products too so I employed my
fried, mr.developer, to check them out from the right &lt;span class="caps"&gt;SVN&lt;/span&gt; location
to the buildout src&amp;nbsp;directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Once you&amp;#8217;ve got your instance started (in the foreground), then you
should be able to access
&lt;a class="reference external" href="http://localhost:8080"&gt;http://localhost:8080&lt;/a&gt;/&amp;lt;your_site_name&amp;gt;/&amp;#64;&amp;#64;pipeline-config which is
the configuration for Transmogrifier.&lt;ol class="arabic"&gt;
&lt;li&gt;You can modify your configuration to suit you.&amp;nbsp; There&amp;#8217;s a little
learning involved here, but there are a good number of
Transmogrifier resources&amp;nbsp;around.&lt;/li&gt;
&lt;li&gt;My configuration looks like this: &lt;a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-export.txt"&gt;transmogrifier-export.txt&lt;/a&gt;,
where I explicitly ignore a whole bunch of content types (read:
problematic for export/import), and export my content out to a
temporary&amp;nbsp;directory&lt;/li&gt;
&lt;li&gt;Make changes to the export configuration and save the&amp;nbsp;result.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Under the &lt;span class="caps"&gt;ZMI&lt;/span&gt;, head into portal_setup and click the &amp;#8216;Properties&amp;#8217;
tab.&amp;nbsp; Change the active site configuration to be &amp;#8216;Transmogrifier&amp;#8217; and
save&amp;nbsp;this.&lt;/li&gt;
&lt;li&gt;Click the &amp;#8216;Export&amp;#8217; tab at the top, and then export the &amp;#8216;Content&amp;#8217; step
you see listed.&amp;nbsp; Watch your console output for progress and anything
that might be a&amp;nbsp;problem.&lt;/li&gt;
&lt;li&gt;If successful, then you&amp;#8217;ll get presented with a generic setup .tar.gz
to download.&amp;nbsp; Save this somewhere useful; you&amp;#8217;ll need it shortly.&amp;nbsp; If
you were like me and exported to a directory, then you&amp;#8217;ll get an
&amp;#8216;empty&amp;#8217; .tar.gz download and your content will be in the directory
you&amp;nbsp;specified.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="manually-modify-content-before-import"&gt;
&lt;h2&gt;Manually modify content before&amp;nbsp;import&lt;/h2&gt;
&lt;p&gt;The reason I outputted to a directory so was I could hack a few things
around in my content. Transmogrifier is powerful, but a bit complicated.
I couldn&amp;#8217;t find out how to rename a field to another in the pipeline (eg
IronicWiki content use the &amp;#8220;body&amp;#8221; field rather than &amp;#8220;text&amp;#8221; as do normal
Document content), and likewise I couldn&amp;#8217;t successfully translate
content type&amp;nbsp;names.&lt;/p&gt;
&lt;p&gt;So, find and replace it is. WickedDocs and IronicWiki are essentially
modern Plone Documents in disguise (as wiki markup is the same), so we
can just translate them over. In addition, I go ahead and rename
anything that&amp;#8217;s called &amp;#8220;index_html&amp;#8221; as this would otherwise be
displayed as the actual page on a given folder automagically (and not
through being selected in the Display drop down&amp;nbsp;menu):&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; /path/to/our/temp/directory
grep -lr -e &lt;span class="s1"&gt;'WickedDoc'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/WickedDoc/Document/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'IronicWiki'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/name=\&amp;quot;body\&amp;quot;/name=\&amp;quot;text\&amp;quot;/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'IronicWiki'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/IronicWiki/Document/g'&lt;/span&gt;
find . -name index_html | xargs rename -v &lt;span class="s1"&gt;'s/index_html/main_page/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'index_html'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/index_html/main_page/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'copy_of_main_page'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/copy_of_main_page/copy_of_index_html/g'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Once done with this, I copied the &amp;#8216;structure&amp;#8217; directory (inside the temp
directory) into the .tar.gz you have from earlier, ready for upload to
the new&amp;nbsp;site.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="for-plone-4"&gt;
&lt;h2&gt;For Plone&amp;nbsp;4&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Set up your Plone 4 like normal.&amp;nbsp; You should (are?) using Buildout,
so follow the instructions &lt;a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone3-4#Installationonbuildout"&gt;here&lt;/a&gt;, again from QuintaGroup, to
install the same quintagroup.transmogrifier product into your Plone 4
instance (eg just add it into your eggs and zcml for your&amp;nbsp;instance).&lt;/li&gt;
&lt;li&gt;Create a Plone site if you haven&amp;#8217;t&amp;nbsp;already.&lt;/li&gt;
&lt;li&gt;Like before, you can use the configuration page at
&lt;a class="reference external" href="http://localhost:8080"&gt;http://localhost:8080&lt;/a&gt;/&amp;lt;your_site_name&amp;gt;/&amp;#64;&amp;#64;pipeline-config , except
this time, configure the import options.&amp;nbsp; My config looks like this:
&lt;a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-import.txt"&gt;transmogrifier-import.txt&lt;/a&gt; - pretty much the same as the&amp;nbsp;default.&lt;/li&gt;
&lt;li&gt;When you&amp;#8217;re ready, head into the &lt;span class="caps"&gt;ZMI&lt;/span&gt; and into &amp;#8216;portal_setup&amp;#8217;, this
time clicking on the &amp;#8216;Import&amp;#8217;&amp;nbsp;tab.&lt;/li&gt;
&lt;li&gt;Browse down to the very bottom of the page, and use the file field
(hint: Browse button) to locate your .tar.gz file you&amp;#8217;ve&amp;nbsp;prepared.&lt;/li&gt;
&lt;li&gt;Click &amp;#8216;Import uploaded tarball&amp;#8217; and watch your console output for&amp;nbsp;progress.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="cleaning-up"&gt;
&lt;h2&gt;Cleaning&amp;nbsp;up&lt;/h2&gt;
&lt;p&gt;This process wasn&amp;#8217;t without manual work, unfortunately.&amp;nbsp; But, it
certainly took care of 95% of the pain of copying content across!
Here&amp;#8217;s an overview of the manual work I had to&amp;nbsp;do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Set default pages of folders.&amp;nbsp; This could have probably been carried
out by a script but I didn&amp;#8217;t write one because I only had a 20
folders to fix.&amp;nbsp; In Plone 2.5, I believe the default view was when
you set a page to be called &amp;#8216;index_html&amp;#8217; (happy for corrections),
but &lt;span class="caps"&gt;AFAIK&lt;/span&gt;, there weren&amp;#8217;t options to set a certain page as the&amp;nbsp;view.&lt;/li&gt;
&lt;li&gt;Set site settings.&amp;nbsp; This involved going through all control panels to
pick and manually port settings, but because of so many changes from
Plone 2.5 to 4, there&amp;#8217;s probably not an obvious migration path&amp;nbsp;anyway.&lt;/li&gt;
&lt;li&gt;Convert legacy portlets.&amp;nbsp; These settings do get copied across, but
you&amp;#8217;ll need to go to the &amp;#8216;Manage portlets&amp;#8217; link on your main homepage
and click the &amp;#8216;Convert&amp;#8217; button.&amp;nbsp; At time of writing (Plone 4.0.2)
this migration is actually broken (ticket logged already!) but you
can just as easily migrate manually &amp;#8212; look in the &lt;span class="caps"&gt;ZMI&lt;/span&gt; properties at
the site root for your portlet&amp;nbsp;listings.&lt;/li&gt;
&lt;li&gt;Fix some workflow states.&amp;nbsp; My old site used a non-default workflow,
so workflow states needed correcting.&amp;nbsp; Thankfully, I was able to push
most content around just using the Types control&amp;nbsp;panel.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And the rest of the actions I did were simply boilerplate for setting up
a Plone 4 site (theme installation,&amp;nbsp;etc).&lt;/p&gt;
&lt;p&gt;This isn&amp;#8217;t the most straightforward path, but it did work and get my
content across.&amp;nbsp; Hopefully moving to Plone 5 and above won&amp;#8217;t be too much
of a&amp;nbsp;problem.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="content"></category><category term="migration"></category><category term="plone"></category><category term="settings"></category><category term="site"></category></entry><entry><title>Checking Plone REQUEST for Ajax’d requests (XMLHttpRequest)</title><link href="http://davidjb.com/blog/2011/01/checking-plone-request-for-ajaxd-requests-xmlhttprequest/" rel="alternate"></link><updated>2011-01-07T10:54:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-01-07:blog/2011/01/checking-plone-request-for-ajaxd-requests-xmlhttprequest/</id><summary type="html">&lt;p&gt;Recently, I&amp;#8217;ve needed a PloneFormGen (&lt;span class="caps"&gt;PFG&lt;/span&gt;) form of mine to have certain
fields excluded when the form is displayed in one of Plone 4&amp;#8217;s fancy
popups.&amp;nbsp; At the same time, I need this field to still persist within the
&amp;#8216;standard&amp;#8217; view of the form.&amp;nbsp; It&amp;#8217;s the request object to the rescue, and
all I&amp;#8217;ve had to do is insert this &lt;span class="caps"&gt;TALES&lt;/span&gt; expression against the &lt;em&gt;Enabling
Expression&lt;/em&gt; for my &lt;span class="caps"&gt;PFG&lt;/span&gt;&amp;nbsp;field:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'HTTP_X_REQUESTED_WITH'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;'XMLHttpRequest'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and the end result is that unless the request is one of XMLHttpRequest,
then we&amp;#8217;ll show the&amp;nbsp;field.&lt;/p&gt;
&lt;p&gt;Shouldn&amp;#8217;t be any reason this same &lt;span class="caps"&gt;TALES&lt;/span&gt; couldn&amp;#8217;t be applied in a page
template against &lt;span class="caps"&gt;XHTML&lt;/span&gt;, or&amp;nbsp;elsewhere.&lt;/p&gt;
</summary><category term="ajax"></category><category term="fields"></category><category term="form"></category><category term="http"></category><category term="pfg"></category><category term="plone"></category><category term="request"></category></entry><entry><title>Plone/Zope: Truncating a Data.fs back to a certain date/time</title><link href="http://davidjb.com/blog/2010/07/plonezope-truncating-a-data-fs-back-to-a-certain-datetime/" rel="alternate"></link><updated>2010-07-20T13:39:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-20:blog/2010/07/plonezope-truncating-a-data-fs-back-to-a-certain-datetime/</id><summary type="html">&lt;p&gt;Okay. So, anyone out here who&amp;#8217;s listening &amp;#8212; particularly those
overly-enthusiastic users &amp;#8212; don&amp;#8217;t try to recursively &lt;tt class="docutils literal"&gt;wget&lt;/tt&gt; your
Plone site (or other &lt;span class="caps"&gt;CMS&lt;/span&gt;, for that matter) whilst you&amp;#8217;re logged in with
an account that can make edits. It &lt;strong&gt;will&lt;/strong&gt; lead to a very bad situation
where your site administrator and technical team need to step in and fix
your mistakes. For the uninitiated, a loose recursive wget (when logged
in with some degree of Edit rights) will hit every link that&amp;#8217;s on your
pages, and I mean in the (X)&lt;span class="caps"&gt;HTML&lt;/span&gt; &lt;em&gt;source&lt;/em&gt;. For a Plone site, this means
hitting every &amp;#8220;Edit&amp;#8221; link, every &amp;#8220;Revert to this version&amp;#8221; link, and
every other link that might be dangerous when clicked randomly. Oh, and
if the account you&amp;#8217;ve got has admin rights, well, it&amp;#8217;s not getting any
better and requires the Data.fs to be undone back to before it happened.
Here&amp;#8217;s how to do that&amp;nbsp;easily.&lt;/p&gt;
&lt;p&gt;So enough of the backstory. How to fix a suitably bollocks&amp;#8217;d Data.fs?
Well, the easy answer is to recover from a backup. Of course you&amp;#8217;ve got
plenty of those, right? No? Oh dear. Never to stress, you can use your
existing Data.fs file and strip away any number of transactions, to
bring your file back to any date, time, or transaction you&amp;#8217;d&amp;nbsp;like.&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Realise you&amp;#8217;ll be losing everything from now back until then, so take
a copy of data off your Plone site, back up your Data.fs (twice, if
need be), and make it crystal clear to your users changes are going&amp;nbsp;bye-by.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Figure out when you want to go back to.&amp;nbsp; If you want a particular
transaction, consider checking your Zope Undo log to locate the
specific date/time of a given transaction.&amp;nbsp; Otherwise, figure out the
date and time.&amp;nbsp; Then, convert that date and time to &lt;span class="caps"&gt;UTC&lt;/span&gt; as that what
date/times are in the Data.fs.&amp;nbsp; In Queensland, Australia, we&amp;#8217;re +10&amp;nbsp;hours.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Shut down &lt;span class="caps"&gt;ZEO&lt;/span&gt; if it&amp;#8217;s still&amp;nbsp;running.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Edit &lt;tt class="docutils literal"&gt;parts/zope2/lib/python/&lt;span class="caps"&gt;ZODB&lt;/span&gt;/FileStorage/fsdump.py&lt;/tt&gt;, and add
this to allow you to run this&amp;nbsp;file:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Get your &lt;span class="caps"&gt;PYTHONPATH&lt;/span&gt; sorted for running this file.&amp;nbsp; Consider
&lt;tt class="docutils literal"&gt;./bin/instance1&lt;/tt&gt; shell, if you&amp;#8217;ve got a Plone instance, or using
zopepy.&amp;nbsp; Manually update it if&amp;nbsp;necessary.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Run the the &lt;tt class="docutils literal"&gt;fsdump.py&lt;/tt&gt; script thusly, substituting the date for
yours (or a&amp;nbsp;date/time):&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
./bin/python parts/zope2/lib/python/ZODB/FileStorage/fsdump.py var/filestorage/Data.fs | grep 2010-07-12
&lt;/pre&gt;
&lt;p&gt;This will tell you exactly the offset you need to truncate the
Data.fs&amp;nbsp;file.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Take that offset amount and truncate your Data.fs file, inserting the
number after&amp;nbsp;&amp;#8220;seek=&amp;#8221;:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;var/filestorage/Data.fs &lt;span class="nv"&gt;seek&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;199340531 &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1 &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Restart your &lt;span class="caps"&gt;ZEO&lt;/span&gt; service and re-connect to it from your Plone/Zope
instance.&amp;nbsp; Your database should be back to the date and time you
specified.&amp;nbsp; If it&amp;#8217;s close, but not quite right, check your times and
that they&amp;#8217;re&amp;nbsp;&lt;span class="caps"&gt;UTC&lt;/span&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Get some backups and politely ask your users to think twice about any
such consequences next&amp;nbsp;time.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And we&amp;#8217;re&amp;nbsp;done!&lt;/p&gt;
</summary><category term="data.fs"></category><category term="database"></category><category term="date"></category><category term="fix"></category><category term="linux"></category><category term="plone"></category><category term="python"></category><category term="time"></category><category term="truncate"></category><category term="zeo"></category><category term="zodb"></category><category term="zodb3"></category><category term="zope"></category></entry><entry><title>Plone: running Plone without copies of blobs</title><link href="http://davidjb.com/blog/2010/07/plone-running-plone-without-copies-of-blobs/" rel="alternate"></link><updated>2010-07-13T16:30:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-13:blog/2010/07/plone-running-plone-without-copies-of-blobs/</id><summary type="html">&lt;p&gt;Having a bad day? Just bombed your only copies of some files that you&amp;#8217;d
been storing as blobs together with your Plone database? Maybe you had
the blobs stored incorrectly on your Zeo client, rather than the server,
and then in a hasty effort to free some space (due to an on-going issue
with blobs eating &lt;span class="caps"&gt;HDD&lt;/span&gt; space), deleted them. Whoops..they&amp;#8217;re gone and
their references are still in your Plone database. Or, in a less
disastrous situation, maybe you just want to be able to run your Plone
database without needing lost blobs? Read on.The suggestion, as
mentioned elsewhere on the Interwebs, is to catch the exception that
gets raised on accessing relevant blobs. The two locations to catch (as
of plone.app.blob 1.0b18)&amp;nbsp;are:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;plone/app/blob/mixins.py&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;getScale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot; get scale by name or original &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getUnwrapped&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;handler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IImageScaleHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;handler&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getScale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;plone/app/blob/field.py&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot; return the size of the blob &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;blob&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;openBlob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fstat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fileno&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;st_size&lt;/span&gt;
        &lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;If you put these try/catch statements in, you&amp;#8217;ll stop your site from
dying when accessing the View and Edit pages for your content. This
means you can safely replace lost blobs with files again, or otherwise
just use your site without the files, like if your client sends you only
the database to save on size. Happy&amp;nbsp;days.&lt;/p&gt;
</summary><category term="blob"></category><category term="blobs"></category><category term="files"></category><category term="patch"></category><category term="plone"></category><category term="problem"></category><category term="python"></category></entry><entry><title>Plone: Overrides.zcml gets auto-included with z3c.autoinclude</title><link href="http://davidjb.com/blog/2010/07/plone-overrides-zcml-gets-auto-included-with-z3c-autoinclude/" rel="alternate"></link><updated>2010-07-13T15:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-13:blog/2010/07/plone-overrides-zcml-gets-auto-included-with-z3c-autoinclude/</id><summary type="html">&lt;p&gt;Unsurprisingly, specifying a z3c.autoinclude entry point in your Plone
product egg means your &lt;span class="caps"&gt;ZCML&lt;/span&gt; gets automatically included. That&amp;#8217;s great
because it means you don&amp;#8217;t have to specify your product under the &lt;span class="caps"&gt;ZCML&lt;/span&gt;
section of your instance in buildout. One thing that isn&amp;#8217;t so obvious
(it&amp;#8217;s not mentioned that I can see on &lt;a class="reference external" href="http://plone.org/products/plone/roadmap/247"&gt;plone.org&lt;/a&gt;) is that if your
package is marked for &lt;span class="caps"&gt;ZCML&lt;/span&gt; autoinclude, then Plone will automatically
load an &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; file in your&amp;nbsp;product.&lt;/p&gt;
&lt;p&gt;Nothing hits you like a slippery wet fish in the face more than hitting
this issue and having it obfuscated through a lot of different layers.
The first symptom was that my content icons weren&amp;#8217;t appearing within my
Plone site. Only some of them though &amp;#8212; the ones in folder listings and
the navigation portlet. I thought nothing much of it initially, just
thinking the setting for displaying content icons had been changed in
the Plone control&amp;nbsp;panel.&lt;/p&gt;
&lt;p&gt;I started digging into this issue a bit more because it was annoying me.
That, and changing the control panel&amp;#8217;s options weren&amp;#8217;t working. Hacking
a few bits into the folder_listing.pt view showed me that icons were
there, just not outputting any &lt;span class="caps"&gt;HTML&lt;/span&gt;. Weird. Outputting the actual type
of the icon brain itself showed&amp;nbsp;me:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
myorg.theme.layout.icons.CatalogBrainContentIcon
&lt;/pre&gt;
&lt;p&gt;and didn&amp;#8217;t think much of it. So what, a class is being generated at run
time for my theme? It wouldn&amp;#8217;t surprise me &amp;#8212; Python can do some pretty
cool things and that&amp;#8217;s probably just one of&amp;nbsp;them.&lt;/p&gt;
&lt;p&gt;Taking the &lt;tt class="docutils literal"&gt;CatalogBrainContentIcon&lt;/tt&gt; string and &lt;tt class="docutils literal"&gt;grep&lt;/tt&gt;&amp;#8216;ing for it
showed me otherwise. My theme package had this class, amongst others,
hanging around in it&amp;#8217;s &lt;tt class="docutils literal"&gt;layout&lt;/tt&gt; module. Moving the module and
restarting Zope showed me that the &lt;span class="caps"&gt;ZCML&lt;/span&gt; was being&amp;nbsp;loaded.&lt;/p&gt;
&lt;p&gt;But how/why? It was definitely excluded from my main &lt;tt class="docutils literal"&gt;configure.zcml&lt;/tt&gt;
files..but not excluded entirely though. Little did I realise that I had
an &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; file floating around. Commented out from
&lt;tt class="docutils literal"&gt;configure.zcml&lt;/tt&gt;, but still there all the same. Turns out adding the
z3c.autoinclude entry point to the theme product makes Plone
auto-include all &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; (unless told otherwise).
&lt;strong&gt;*fish-smack to face*&lt;/strong&gt; This behaviour was modified slightly in Plone
4.0a5, so that you can make your &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; be excluded, but
that doesn&amp;#8217;t mean anything about Plone&amp;nbsp;3.3.5.&lt;/p&gt;
&lt;p&gt;So, watch out with seemingly innocuous &lt;span class="caps"&gt;ZCML&lt;/span&gt; files floating around. They
can still be brought into&amp;nbsp;play.&lt;/p&gt;
</summary><category term="auto"></category><category term="icons"></category><category term="include"></category><category term="plone"></category><category term="plone 3"></category><category term="problem"></category><category term="theme"></category><category term="z3c"></category><category term="zcml"></category><category term="zope"></category></entry><entry><title>Plone 4: Local Zeo blobs conflict with Plone instance</title><link href="http://davidjb.com/blog/2010/07/plone-4-local-zeo-blobs-conflict-with-plone-instance/" rel="alternate"></link><updated>2010-07-06T16:04:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-06:blog/2010/07/plone-4-local-zeo-blobs-conflict-with-plone-instance/</id><summary type="html">&lt;p&gt;As the title suggests, there&amp;#8217;s a conflict between a Zeo database
instance being run together with a Plone 4/Zope instance, and them
trying to share the same blob storage folder.&amp;nbsp; But, this only happens if
you misunderstand or incorrectly set the option of&amp;nbsp; &lt;em&gt;shared-blob = off&lt;/em&gt;,
and &lt;em&gt;blob-storage&lt;/em&gt; to be the same location as for Zeo in your buildout.
If that previous set of (seemingly jumbled) thoughts doesn&amp;#8217;t make any
sense to you, then move along, nothing to see&amp;nbsp;here.&lt;/p&gt;
&lt;p&gt;By default, at the time of writing, blob support within Zeo runs with
the &lt;em&gt;bushy&lt;/em&gt;layout, and creates this format by default when starting up
for the first time. Plone 4, however, when trying to stream blobs from
your Zeo database, uses a customised &lt;em&gt;zeocache&lt;/em&gt; blob layout. See where
I&amp;#8217;m going with this? You try and inadvertently use these aspects
together and you&amp;#8217;ve got a&amp;nbsp;conflict.&lt;/p&gt;
&lt;p&gt;If you&amp;#8217;re having this problem, then you&amp;#8217;ll get weird errors concerning
the &lt;em&gt;layout&lt;/em&gt; of your blobs. Starting the Zope instance before the Zeo
server results in Zope setting the &lt;strong&gt;.layout&lt;/strong&gt; file for the blob storage
to &lt;em&gt;zeocache&lt;/em&gt;. Once your Zope instance errors out and you realise that
your Zeo instance isn&amp;#8217;t running, you&amp;#8217;ll inevitably try and start Zeo up.
When you do, you get an error about the layout type not&amp;nbsp;existing:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;/home/david/buildout/parts/zeo/bin/runzeo
&lt;/span&gt;&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  &lt;span class="c"&gt;...&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/&lt;span class="caps"&gt;ZODB3&lt;/span&gt;-3.9.5-py2.6-linux-i686.egg/&lt;span class="caps"&gt;ZODB&lt;/span&gt;/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;714&lt;/span&gt;, in &lt;span class="n"&gt;__init__&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_blob_init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_directory&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/&lt;span class="caps"&gt;ZODB3&lt;/span&gt;-3.9.5-py2.6-linux-i686.egg/&lt;span class="caps"&gt;ZODB&lt;/span&gt;/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;600&lt;/span&gt;, in &lt;span class="n"&gt;_blob_init&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fshelper&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FilesystemHelper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blob_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/&lt;span class="caps"&gt;ZODB3&lt;/span&gt;-3.9.5-py2.6-linux-i686.egg/&lt;span class="caps"&gt;ZODB&lt;/span&gt;/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;339&lt;/span&gt;, in &lt;span class="n"&gt;__init__&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;layout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;&lt;span class="caps"&gt;LAYOUTS&lt;/span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;layout_name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gr"&gt;KeyError&lt;/span&gt;: &lt;span class="n"&gt;'zeocache'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Now, if you try to fix this by dumping your now-existing blob storage
folder (a method mentioned to work elsewhere on the web) and starting
your Zeo server first, you&amp;#8217;ll still get problems. The blob storage gets
created correctly with the &amp;#8216;bushy&amp;#8217; layout by Zeo, but trying to start
the Zope instance fails, because Zeo&amp;#8217;s created its storage accordingly
in the same spot. This is part of the&amp;nbsp;error:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  &lt;span class="c"&gt;...&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/&lt;span class="caps"&gt;ZODB3&lt;/span&gt;-3.9.5-py2.6-linux-i686.egg/&lt;span class="caps"&gt;ZODB&lt;/span&gt;/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;362&lt;/span&gt;, in &lt;span class="n"&gt;create&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;layout_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;base_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gr"&gt;ValueError&lt;/span&gt;: &lt;span class="n"&gt;Directory layout `zeocache` selected for blob directory /home/david/buildout/var/blobstorage/, but marker found for layout `bushy`&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;The two ways of solving this are&amp;nbsp;to:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Change the &lt;em&gt;shared-blob&lt;/em&gt; option to be &lt;strong&gt;on&lt;/strong&gt;. Both Zeo and Zope will
exist in harmony again, both using the &lt;em&gt;bushy&lt;/em&gt;&amp;nbsp;layout.&lt;/li&gt;
&lt;li&gt;Changing the &lt;em&gt;blob-storage&lt;/em&gt; location for either the Zeo server or the
Zope instance. This will result in two separate folders and likely
duplicate files and &lt;span class="caps"&gt;HDD&lt;/span&gt; wastage, but hey, it&amp;#8217;ll work, right? This is
probably a useful option for&amp;nbsp;testing.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The &lt;em&gt;zeocache&lt;/em&gt; layout is new with Plone 4 (aka, I haven&amp;#8217;t seen it before
so it probably is), so watch out for this when&amp;nbsp;upgrading.&lt;/p&gt;
&lt;p&gt;Stay tuned for more in this series of Plone 4 upgrade&amp;nbsp;notes.&lt;/p&gt;
</summary><category term="blob"></category><category term="conflict"></category><category term="database"></category><category term="db"></category><category term="files"></category><category term="plone"></category><category term="plone 4"></category><category term="problem"></category><category term="upgrade"></category><category term="zeo"></category></entry><entry><title>Plone: SiteManager leftovers; not the good kind</title><link href="http://davidjb.com/blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/" rel="alternate"></link><updated>2010-06-28T14:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-28:blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;&lt;strong&gt;Update:&lt;/strong&gt; You should check out &lt;a class="reference external" href="http://pypi.python.org/pypi/wildcard.fixpersistentutilities"&gt;wildcard.fixpersistentutilities&lt;/a&gt;
- it&amp;#8217;s a fantastic solution to problems like this. Many thanks to
Nathan Van Gheem, the author of the add on. Check out the link and
see how to install it (temporarily) on your Plone instance that
needs its site manager cleaned&amp;nbsp;up.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Leftovers are typically useful when they&amp;#8217;re in your fridge at home. They
mean you don&amp;#8217;t have to mess around making lunch for the next day for
work, and can just grab them, and walk right out the door. Now,
leftovers in the zope.component SiteManager aren&amp;#8217;t so nice, especially
when some Plone products fail to remove what they&amp;#8217;ve registered. The
consequences of this are that you&amp;#8217;ve got references left which will
break things when you uninstall/remove the physical eggs/files. These
leftovers would be ones would be mutated food that comes to kill you
after you&amp;#8217;ve thrown it in the bin, assuming we follow the same analogy.
But how to fix&amp;nbsp;them?&lt;/p&gt;
&lt;p&gt;Here&amp;#8217;s the error message you might be faced with when trying to install
or uninstall products &amp;#8212; something that stops you might in your&amp;nbsp;tracks:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2010-06-22T10:38:48 &lt;span class="caps"&gt;ERROR&lt;/span&gt; Zope.SiteErrorLog https://mysite.com/portal_quickinstaller/uninstallProducts
Traceback (innermost last):
Module ZPublisher.Publish, line 125, in publish
Module Zope2.App.startup, line 238, in commit
Module transaction._manager, line 96, in commit
Module transaction._transaction, line 395, in commit
Module transaction._transaction, line 495, in _commitResources
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 510, in commit
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 555, in _commit
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 582, in _store_objects
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.serialize, line 407, in serialize
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.serialize, line 416, in _dump
PicklingError: Can't pickle &amp;lt;class 'p4a.plonevideoembed.interfaces.IVideoLinkSupport'&amp;gt;: import of module p4a.plonevideoembed.interfaces failed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Unsurprisingly, it&amp;#8217;s similar to something I encountered before. Way back
when, I hit the same issue with &lt;a class="reference external" href="http://davidjb.com/blog/2009/04/plone-issues-with-products/"&gt;ZipFileTransport&lt;/a&gt;, and my fix for it
is just as relevant today as it was then. Start up a zopepy session (or
ipython) that still has the relevant classes in the system path, and run&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;p4a.plonevideoembed.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IVideoLinkSupport&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;intclass&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;p4a.video.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IVideoSupport&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;intclass2&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.app.component.hooks&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;setSite&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.component&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;
&lt;span class="n"&gt;setSite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;portal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;#Even though unregister happened, it probably said it worked but left crap around.&lt;/span&gt;
&lt;span class="c"&gt;#Let's clean it up.&lt;/span&gt;

&lt;span class="c"&gt;#This intclass variables might not be right or perfectly complete. It's going to be the key present below,&lt;/span&gt;
&lt;span class="c"&gt;#so you can always find the right InterfaceClass manually and set it accordingly.&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;#From here, search for a term to see if it's gone&lt;/span&gt;
&lt;span class="c"&gt;#Each should return -1. If not, you've done something wrong!&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;transaction&lt;/span&gt;
&lt;span class="n"&gt;transaction&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Shut down your existing Plone/Zope instance and restart it. You should
now be able to install or remove products accordingly again &amp;#8212; and also
get rid of those old packages&amp;#8217; physical files you don&amp;#8217;t&amp;nbsp;need.&lt;/p&gt;
</summary><category term="egg"></category><category term="error"></category><category term="install"></category><category term="plone"></category><category term="problem"></category><category term="site"></category><category term="update"></category><category term="zope"></category></entry><entry><title>Plone, Dexterity, and Incorrect Widgets</title><link href="http://davidjb.com/blog/2010/06/plone-dexterity-and-incorrect-widgets/" rel="alternate"></link><updated>2010-06-21T15:09:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-21:blog/2010/06/plone-dexterity-and-incorrect-widgets/</id><summary type="html">&lt;p&gt;A nice &amp;#8216;gotcha&amp;#8217; is the distinction between Zope&amp;#8217;s schema.Date and
schema.Datetime. The difference is obvious and straightforward when the
two terms are laid out side-by-side: one is for dates only and the other
adds a time component. Where things fell down for me in my usage of
these fields with a Dexterity-based content type in Plone is the human
component. When these fields are mashed in together within a lot of
other text/Python/names, it&amp;#8217;s easy to miss those 4 little letters of
&amp;#8216;time&amp;#8217;. This lead me trying to use a DatetimeFieldWidget when I really
could only use a DateFieldWidget. &lt;strong&gt;Wrong widget for the wrong type =&amp;nbsp;unpredictable.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When it&amp;#8217;s all laid out like that, things are clear and simple. When the
small typo has been made, however, things are far less forgiving and
informative. Thankfully, the typo wasn&amp;#8217;t my fault, but was caused by a
ZopeSkel template for Dexterity (&lt;a class="reference external" href="http://pypi.python.org/pypi/zopeskel.dexterity"&gt;zopeskel.dexterity&lt;/a&gt;) so I&amp;#8217;m not
kicking myself over it. Essentially, the error message (for those of you
possibly experiencing something similar) is like&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2010-06-18 16:32:03 &lt;span class="caps"&gt;ERROR&lt;/span&gt; Zope.SiteErrorLog 1276842723.120.730292360531 http://localhost:8080/test/kss_z3cform_inline_validation/validate_input
    Traceback (innermost last):
    Module ZPublisher.Publish, line 119, in publish
    Module ZPublisher.mapply, line 88, in mapply
    Module ZPublisher.Publish, line 42, in call_object
    Module &amp;lt;wrapper&amp;gt;, line 5, in wrapper
    Module kss.core.actionwrapper, line 238, in apply
    Module plone.app.z3cform.kss.validation, line 48, in validate_input
    Module z3c.form.group, line 92, in extractData
    Module z3c.form.form, line 143, in extractData
    Module z3c.form.field, line 302, in extract
    Module z3c.form.converter, line 164, in toFieldValue
    Module zope.i18n.format, line 79, in parse
    Module sre, line 129, in match
    TypeError: expected string or buffer&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And the end result of this is that you can&amp;#8217;t validate fields in your
Dexterity content Add form (eg the above traceback is echoed whenever
you click in/out of a field), nor can you actually save your content.
Unfortunately, even if you were to go hunting through the traceback,
you&amp;#8217;d probably end up like me and find that the code is trying to
validate a completely different field than the problematic one. No help&amp;nbsp;whatsoever.&lt;/p&gt;
&lt;p&gt;After going through each of the different fields I had on my content
type, I figured out the cause. If you&amp;#8217;re hitting a similar issue, check
your widgets. If you&amp;#8217;re using &lt;a class="reference external" href="http://pypi.python.org/pypi/zopeskel.dexterity"&gt;zopeskel.dexterity&lt;/a&gt;, don&amp;#8217;t worry though.
I checked in a fix for this issue this morning, correcting the widget to
be used. You&amp;#8217;ll need to use the latest version from the Plone Collective
&lt;span class="caps"&gt;SVN&lt;/span&gt; to make the templates work&amp;nbsp;correctly.&lt;/p&gt;
&lt;p&gt;On the other hand, you could look at &lt;a class="reference external" href="http://pypi.python.org/pypi/collective.z3cform.datepicker"&gt;collective.z3cform.datepicker&lt;/a&gt;,
which implements a much more user-friendly Date and DateTime widgets
(using jQuery &lt;span class="caps"&gt;UI&lt;/span&gt;&amp;nbsp;etc).&lt;/p&gt;
</summary><category term="content type"></category><category term="datetime"></category><category term="dexterity"></category><category term="fields"></category><category term="form"></category><category term="plone"></category><category term="problem"></category><category term="product"></category><category term="zope"></category></entry><entry><title>Plone/Zope: Using LDAPUserFolder with posixGroups</title><link href="http://davidjb.com/blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/" rel="alternate"></link><updated>2010-06-03T16:03:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-03:blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/</id><summary type="html">&lt;p&gt;Due to various reasons, the Products.LDAPUserFolder package available
for Plone and Zope doesn&amp;#8217;t support &lt;span class="caps"&gt;POSIX&lt;/span&gt; groups.&amp;nbsp; The &amp;#8216;official&amp;#8217; (ish)
reason for this is because of the fact that these groups don&amp;#8217;t store
full distinguished names (DNs) for members.&amp;nbsp; It makes some degree of
sense, because a user &lt;span class="caps"&gt;ID&lt;/span&gt; like &amp;#8216;david.test&amp;#8217; isn&amp;#8217;t strictly unique.&amp;nbsp; On
the other hand, these types of groups are quite common in &lt;span class="caps"&gt;LDAP&lt;/span&gt;
implementations; not supporting them without giving it at least half a
shot to find the user seems a bit&amp;nbsp;strange.&lt;/p&gt;
&lt;p&gt;Here&amp;#8217;s where a quick patch steps in. Thanks to Weblion&amp;#8217;s infinity of
Plone resources (specifically, their article on &lt;a class="reference external" href="https://weblion.psu.edu/trac/weblion/wiki/LDAPWithPlone"&gt;Plone &lt;span class="caps"&gt;LDAP&lt;/span&gt;&lt;/a&gt;), I
patched part of my&amp;nbsp;Products.LDAPUserFolder.&lt;/p&gt;
&lt;p&gt;Now, what they&amp;#8217;ve got wasn&amp;#8217;t infallible. Whilst the patch they have on
their site took care of enumerating the groups, and the groups a user is
in, it didn&amp;#8217;t ensure looking a group showed its users. Whether this was
a change in LDAPUserFolder recently (since version 2.12) or not, I&amp;#8217;m not&amp;nbsp;sure.&lt;/p&gt;
&lt;p&gt;In any case, the reason for the issue is that deep down, the code
attempts to query group members by &lt;span class="caps"&gt;DN&lt;/span&gt;. Obviously our &lt;span class="caps"&gt;POSIX&lt;/span&gt; groups don&amp;#8217;t
have full DNs, so with a quick bit of string manipulation (read:
hacking), I assume that the &lt;em&gt;user base&lt;/em&gt; you specify will have your user.
&lt;strong&gt;Note:&lt;/strong&gt; this won&amp;#8217;t do one iota if your user isn&amp;#8217;t at the user base,
but if it is &amp;#8212; like all the LDAPs I&amp;#8217;ve used &amp;#8212; you&amp;#8217;re golden. Here&amp;#8217;s
the patch for Products.LDAPUserFolder&amp;nbsp;2.17.&lt;/p&gt;
&lt;pre class="code diff literal-block"&gt;
&lt;span class="gh"&gt;diff --git a/Products/LDAPUserFolder/LDAPUserFolder.py b/Products/LDAPUserFolder/LDAPUserFolder.py
index 0e61396..a235e74 100644
&lt;/span&gt;&lt;span class="gd"&gt;--- a/Products/LDAPUserFolder/LDAPUserFolder.py
&lt;/span&gt;&lt;span class="gi"&gt;+++ b/Products/LDAPUserFolder/LDAPUserFolder.py
&lt;/span&gt;&lt;span class="gu"&gt;&amp;#64;&amp;#64; -950,6 +950,7 &amp;#64;&amp;#64; class LDAPUserFolder(BasicUserFolder):
&lt;/span&gt;
for dn in all_dns.keys():
try:
&lt;span class="gi"&gt;+                if 'uid=' not in dn: dn = ('uid='+dn+','+self.users_base)
&lt;/span&gt;user = self.getUserByDN(dn)
except:
user = None
&lt;span class="gu"&gt;&amp;#64;&amp;#64; -1216,6 +1217,8 &amp;#64;&amp;#64; class LDAPUserFolder(BasicUserFolder):
&lt;/span&gt;f_template = '(&amp;amp;amp;amp;(objectClass=%s)(%s=%s))'
group_filter = '(|'

&lt;span class="gi"&gt;+                dn = dn.replace('uid=','').replace(','+self.users_base,'')
+
&lt;/span&gt;for g_name, m_name in GROUP_MEMBER_MAP.items():
fltr = filter_format(f_template, (g_name, m_name, dn))
group_filter += fltr
&lt;span class="gh"&gt;diff --git a/Products/LDAPUserFolder/utils.py b/Products/LDAPUserFolder/utils.py
index 4a88cd7..26b73bc 100644
&lt;/span&gt;&lt;span class="gd"&gt;--- a/Products/LDAPUserFolder/utils.py
&lt;/span&gt;&lt;span class="gi"&gt;+++ b/Products/LDAPUserFolder/utils.py
&lt;/span&gt;&lt;span class="gu"&gt;&amp;#64;&amp;#64; -48,6 +48,7 &amp;#64;&amp;#64; GROUP_MEMBER_MAP = { 'groupOfUniqueNames' : 'uniqueMember'
&lt;/span&gt;, 'accessGroup' : 'member'
, 'group' : 'member'
, 'univentionGroup' : 'uniqueMember'
&lt;span class="gi"&gt;+                  , 'posixGroup' : 'memberUid'
&lt;/span&gt;}

VALID_GROUP_ATTRIBUTES = Set(list(GROUP_MEMBER_MAP.values()) +
&lt;/pre&gt;
</summary><category term="groups"></category><category term="ldap"></category><category term="ldapuserfolder"></category><category term="openldap"></category><category term="patch"></category><category term="plone"></category><category term="python"></category><category term="zope"></category></entry><entry><title>Virtualenv, Python 2.4, Plone 3.x and Lucid Lynx (Ubuntu 10.04)</title><link href="http://davidjb.com/blog/2010/05/virtualenv-python-2-4-plone-3-x-and-lucid-lynx-ubuntu-10-04/" rel="alternate"></link><updated>2010-05-12T14:47:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-05-12:blog/2010/05/virtualenv-python-2-4-plone-3-x-and-lucid-lynx-ubuntu-10-04/</id><summary type="html">&lt;p&gt;These titles of my posts just keep getting longer and longer.&amp;nbsp; For those
of you paying close attention (I know who you are), this is the next in
my series of getting the above-mentioned tools working together.
Previously, it was Centos 5.x, Jaunty (9.04), Karmic (9.10) and now
Lucid (10.04).&amp;nbsp; Only subtly different, each of this distributions has
pretty much called for its own post on the matter of getting a working
Plone 3.x / Python 2.4 virtualenv installation going.&amp;nbsp; So, here goes
this time&amp;nbsp;around.&lt;/p&gt;
&lt;div class="section" id="install-python-2-4-first"&gt;
&lt;h2&gt;Install Python 2.4&amp;nbsp;first&lt;/h2&gt;
&lt;p&gt;If you&amp;#8217;ve not done so already, you need to install Python 2.4.&amp;nbsp; Lucid
now no longer comes with the packages for Python 2.4 (at all; so not
even python2.4, python2.4-dev) in its repositories, so you need to wind
back the clock and get the Karmic packages.&amp;nbsp; Don&amp;#8217;t worry, everything
seems to work okay.&amp;nbsp; &lt;a class="reference external" href="http://davidjb.com/blog/2010/05/installing-python-2-4-on-ubuntu-10-04-lucid-lynx"&gt;Read my post about this&lt;/a&gt; and come back&amp;nbsp;here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="prerequisites"&gt;
&lt;h2&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Ready to roll? You might want to make sure that you&amp;#8217;ve got python2.4
available (eg run &lt;tt class="docutils literal"&gt;python2.4&lt;/tt&gt;) and that you can &lt;tt class="docutils literal"&gt;import&amp;nbsp; profile&lt;/tt&gt;.
If not, go back to the other post and read carefully (or complain loudly
:)). You should also check the&amp;nbsp;following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;Got easy_install-2.4?&amp;nbsp; Try and type it in your terminal.&amp;nbsp; No good?
Then do&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://pypi.python.org/packages/2.4/s/setuptools/setuptools-0.6c11-py2.4.egg
sudo sh setuptools-0.6c11-py2.4.egg
rm -f setuptools-0.6c11-py2.4.egg
sudo easy_install-2.4 -U setuptools
sudo easy_install-2.4 virtualenv
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;If you&amp;#8217;ve got the python-virtualenv Ubuntu package installed.&amp;nbsp; If you
do, have a serious think about uninstalling it and getting the one
for Python2.4 via easy_install-2.4. Your warranty ends here if you
continue with the Ubunutu-installed&amp;nbsp;virtualenv.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;If you need to install system-level packages. Even if you&amp;#8217;ve run this
before on an old Karmic (or older install), do it again as you&amp;#8217;ve
likely lost packages in the&amp;nbsp;upgrade.&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install libtk-img-dev libfreeimage-dev libjpeg62-dev libfreetype6-dev libtk-img-dev tcl8.5-dev tk8.5-dev lynx poppler-utils xpdf wv xlhtml ppthtml
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="make-your-virtualenv-happen"&gt;
&lt;h2&gt;Make your virtualenv&amp;nbsp;happen&lt;/h2&gt;
&lt;p&gt;Now that&amp;#8217;s sorted, convert an existing buildout folder over to&amp;nbsp;Virtualenv:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
python bootstrap.py -v1.4.3
easy_install ipython
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
./bin/buildout
&lt;/pre&gt;
&lt;p&gt;And that handles setting up and activating virtualenv, &lt;strong&gt;making sure we
bootstrap with version 1.4.3 of buildout&lt;/strong&gt;, installing useful/necessary
python packages, and reworking everything via buildout. As highlighted
with the &lt;strong&gt;bold&lt;/strong&gt; text, you must make sure you add the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-v1.4.3&lt;/span&gt;&lt;/tt&gt;
option to running&amp;nbsp;bootstrap.py.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So, that wraps things up. You should now have a fully functional
virtualenv, just like you did back in the good old days (or, if you&amp;#8217;re
new to this game, a fresh new install). Now, if you&amp;#8217;re a Plonista, you
can fire up your instance and it should start just&amp;nbsp;fine.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="10.04"></category><category term="how-to"></category><category term="install"></category><category term="installation"></category><category term="lucid"></category><category term="plone"></category><category term="python"></category><category term="virtualenv"></category></entry><entry><title>Good Morning World Plone Day!</title><link href="http://davidjb.com/blog/2010/04/good-morning-world-plone-day/" rel="alternate"></link><updated>2010-04-28T00:00:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-04-28:blog/2010/04/good-morning-world-plone-day/</id><summary type="html">&lt;p&gt;Good morning from the land down under and welcome to World Plone Day
2010! It&amp;#8217;s right on the hour (well, just after now) and 28 April 2010 &amp;#8212;
and yes, that&amp;#8217;s World Plone Day to the uninitiated. To celebrate and to
mark the occasion, I&amp;#8217;ll be holding a bit of a discussion today about
what Plone is, why it&amp;#8217;s so useful, and what we, as users, are hanging
out for in Plone 4 and above. But, what fun is that without sweets to
eat?&amp;nbsp; And what&amp;#8217;s potentially tastier than Plone?&amp;nbsp; Plone&amp;nbsp;cupcakes!&lt;/p&gt;
&lt;p&gt;Thanks to some great work by my lovely partner, she&amp;#8217;s whipped up some
cupcakes for &lt;span class="caps"&gt;WPD&lt;/span&gt;.&amp;nbsp; I didn&amp;#8217;t do much save for helping with design and
icing &amp;#8212; woo!&amp;nbsp; Here&amp;#8217;s the end&amp;nbsp;results:&lt;/p&gt;
&lt;img alt="|filename|images/cupcakes1.jpg" src="http://davidjb.com/static/images/cupcakes1.jpg" style="width: 45%;" /&gt;
&lt;img alt="|filename|images/cupcakes2.jpg" src="http://davidjb.com/static/images/cupcakes2.jpg" style="width: 45%;" /&gt;
&lt;p&gt;Okay, so the &lt;span class="caps"&gt;CMYK&lt;/span&gt; colour might be a little off and I&amp;#8217;m thinking I&amp;#8217;m not
conforming to all Plone logo usage guidelines but they look good.
Haven&amp;#8217;t tasted them yet but I&amp;#8217;m sure they&amp;#8217;ll be excellent.&amp;nbsp; I had
thought of a line like &amp;#8220;Open Source never tasted so sweet&amp;#8221;, but I think
I&amp;#8217;ll let that&amp;nbsp;go.&lt;/p&gt;
&lt;p&gt;Viva la World Plone&amp;nbsp;Day!&lt;/p&gt;
</summary><category term="date"></category><category term="food"></category><category term="life"></category><category term="plone"></category><category term="sweets"></category><category term="tasty"></category><category term="wpd"></category></entry><entry><title>Plone/Zope: Utilising zope.testrecorder for unit testing</title><link href="http://davidjb.com/blog/2010/03/plonezope-utilising-zope-testrecorder-for-unit-testing/" rel="alternate"></link><updated>2010-03-25T09:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-03-25:blog/2010/03/plonezope-utilising-zope-testrecorder-for-unit-testing/</id><summary type="html">&lt;p&gt;Writing unit tests (especial doctests) for your Plone product is
reasonably time consuming. For us developers, having tested code is
absolutely essential. This is especially true when clients are beating
down your door looking for a fully functional product and you need to
know what you&amp;#8217;ve written works and isn&amp;#8217;t going to fall over (just yet,
anyway). Web apps are able to be tested using a multitude of frameworks,
and whilst not the most fully featured (eg lacking Javascript support),
Zope&amp;#8217;s doctest machinery is right there within your Plone product. In
order to write these, enter zope.testrecorder to more-or-less automate
replicating your actions into&amp;nbsp;tests.&lt;/p&gt;
&lt;p&gt;zope.testrecorder is simple to install: just add it to your eggs list
under your buildout&amp;#8217;s relevant instance section, and also the
corresponding zcml list too. Re-run your buildout and you will now have
the latest version of the package&amp;nbsp;installed.&lt;/p&gt;
&lt;p&gt;There&amp;#8217;s some good documentation out there about this, such as &lt;a class="reference external" href="http://plone.org/documentation/kb/testing/zope-testrecorder"&gt;Martin
Aspeli&amp;#8217;s article&lt;/a&gt; on plone.org, but it&amp;#8217;s slightly dated given latest
updates with the package. Essentially, everything is relevant with the
exception of how to actually access the test recorder now. Enter
&lt;a class="reference external" href="http://pyyou.wordpress.com/2008/04/11/how-to-install-zopetestrecorder-with-buildout/"&gt;PyYou&amp;#8217;s post&lt;/a&gt; about this same topic. Thanks to that article I now know
you should go to
&lt;strong&gt;http://zopehost:port/++resource++recorder/index.html&lt;/strong&gt; to access the
test recorder, and not try and add an object in the root of Zope (or&amp;nbsp;elsewhere).&lt;/p&gt;
&lt;p&gt;Aside from that, the recorder works like a charm. You input the address
of what site (it can be anything or anywhere) you want to test and click
the &amp;#8216;Go&amp;#8217; button. Everything you do (mostly) gets monitored and recorded.
A few words to the wise&amp;nbsp;though:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;No testing or recording Javascript-based or centric actions.&amp;nbsp; So
don&amp;#8217;t expect that product you wrote with the Google Maps &lt;span class="caps"&gt;API&lt;/span&gt; to work
so well with recording tests.&amp;nbsp; Or, don&amp;#8217;t expect the test recorder to
understand correctly that you clicking on the &amp;#8216;Add New&amp;#8230;&amp;#8217; menu in
Plone isn&amp;#8217;t actually a real&amp;nbsp;link.&lt;/li&gt;
&lt;li&gt;No ability to just browse with Javascript turned off.&amp;nbsp; Essentially,
as the zope.testrecorder itself needs Javascript to run, you can&amp;#8217;t
turn it off, thinking you&amp;#8217;ll record things correctly, or at all.
Maybe there&amp;#8217;s a way around this issue, but it&amp;#8217;s likely more
complicated than I care to concern myself&amp;nbsp;with.&lt;/li&gt;
&lt;li&gt;Specialised form widgets are problematic.&amp;nbsp; The Plone visual editor is
one (Javascript, again), but does work if you switch the editor to be
&lt;span class="caps"&gt;HTML&lt;/span&gt; before saving a form.&amp;nbsp; Another example that will require some
fancy work around is z3c.relationfield &amp;#8212; there&amp;#8217;s no non-Javascript
fall back here (that I can&amp;nbsp;see).&lt;/li&gt;
&lt;li&gt;You&amp;#8217;ll need to manually intervene with the rendered tests and fix
some things up.&amp;nbsp; For example, testing the default title of a Plone
site doesn&amp;#8217;t work because there&amp;#8217;s a hyphen in the title.&amp;nbsp; It&amp;#8217;s a
special character and thus saved &amp;#8220;incorrectly&amp;#8221; within the&amp;nbsp;doctests.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Aside from all that, most of the heavy lifting is done for you, so
cheers to the creators of zope.testrecorder for making my life just that
bit&amp;nbsp;easier.&lt;/p&gt;
</summary><category term="buildout"></category><category term="install"></category><category term="plone"></category><category term="product"></category><category term="recorder"></category><category term="test"></category><category term="unit tests"></category><category term="zope"></category></entry><entry><title>GenericSetup and “mismatched” tags in ZCML</title><link href="http://davidjb.com/blog/2010/03/genericsetup-and-mismatched-tags-in-zcml/" rel="alternate"></link><updated>2010-03-12T11:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-03-12:blog/2010/03/genericsetup-and-mismatched-tags-in-zcml/</id><summary type="html">&lt;p&gt;Ever the issue-magnet, I&amp;#8217;ve spent the better part of my morning trying
to debug a mistmatched tag error from within some &lt;span class="caps"&gt;ZCML&lt;/span&gt; (aka &lt;span class="caps"&gt;XML&lt;/span&gt; for the
non-initiated).&amp;nbsp; Essentially, the issue boiled down to the system
telling me that it was certain that I had a mistmatched tag within my
configuration, and presented me with the problematic &lt;span class="caps"&gt;XML&lt;/span&gt; tag (complete
with line numbers).&amp;nbsp; However, life&amp;#8217;s not always that&amp;nbsp;simple.&lt;/p&gt;
&lt;p&gt;The traceback looked like&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;&lt;span class="gr"&gt;zope.configuration.config.ConfigurationExecutionError&lt;/span&gt;: &lt;span class="n"&gt;xml.parsers.expat.ExpatError: mismatched tag: line 6, column 70&lt;/span&gt;
&lt;span class="x"&gt;in:
File &amp;quot;/home/david/buildout/src/aaa.project/aaa/project/profiles.zcml&amp;quot;, line 9.2-15.6&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And specified the exact genericsetup:registerProfile configuration that
was problematic. After much poking and prodding and thinking that there
must be some random character hidden in my configuration file (and
checking other files that call this one), no dice. Even copying and
pasting some new code that I knew worked just simply didn&amp;#8217;t when I put
it&amp;nbsp;here.&lt;/p&gt;
&lt;p&gt;So, I just happened to actually think about what I&amp;#8217;m calling with this
&lt;span class="caps"&gt;ZCML&lt;/span&gt;: a Plone product generic setup profile. And, yes, now it seems so
clear that the issue was in fact in that &lt;span class="caps"&gt;GS&lt;/span&gt; profile. My vim editor had
kindly re-auto-closed a tag that it shouldn&amp;#8217;t have (because it was
already closed) in my metadata.xml. Fixing that solved the issue and let
my Zope instance start up&amp;nbsp;again.&lt;/p&gt;
</summary><category term="configuration"></category><category term="error"></category><category term="mismatched"></category><category term="plone"></category><category term="tags"></category><category term="xml"></category><category term="zcml"></category><category term="zope"></category></entry><entry><title>(Lack of) Kupu CSS Styles, Plone and Deliverance</title><link href="http://davidjb.com/blog/2010/01/lack-of-kupu-css-styles-plone-and-deliverance/" rel="alternate"></link><updated>2010-01-14T14:13:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-01-14:blog/2010/01/lack-of-kupu-css-styles-plone-and-deliverance/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; see &lt;a class="reference external" href="http://www.coactivate.org/projects/deliverance/lists/deliverance-discussion/archive/2010/01/1263439188459/forum_view"&gt;this post&lt;/a&gt; for up-to-date&amp;nbsp;details.&lt;/p&gt;
&lt;p&gt;Essentially, the issue is that Deliverance doesn&amp;#8217;t theme (and rightly
so) the Kupu editor within Plone and hence any styles applied to normal
pages by Deliverance don&amp;#8217;t show up.&amp;nbsp; My workaround, as detailed on that
post, is to customise the &amp;#8220;emptypageresources&amp;#8221; page template and include
a suitable link to the &lt;span class="caps"&gt;CSS&lt;/span&gt; file, like&amp;nbsp;so:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;link&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;site.css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;rel=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;StyleSheet&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;tal:attributes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;href string:${context/&amp;#64;&amp;#64;plone_portal_state/navigation_root_url}/static/theme/site.css;&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;(changing the tal:attributes section accordingly).&amp;nbsp; This should
introduce perfectly correct styles for your editor from your Deliverance
(or other) static&amp;nbsp;theme.&lt;/p&gt;
&lt;p&gt;This feels to be a very common use case, but I can&amp;#8217;t seem to find any
other suggestions on a workaround/solution. I&amp;#8217;d have to think that this
is likely to be a widespread issue, though. It&amp;#8217;s definitely not
something that should happen if we&amp;#8217;re actually able to have the &lt;span class="caps"&gt;WYSIWYG&lt;/span&gt;
editor be &lt;span class="caps"&gt;WYSIWYG&lt;/span&gt; (unlike some other &lt;span class="caps"&gt;CMS&lt;/span&gt;&amp;nbsp;products).&lt;/p&gt;
</summary><category term="css"></category><category term="deliverance"></category><category term="editor"></category><category term="kupu"></category><category term="plone"></category><category term="static"></category><category term="style"></category><category term="theme"></category></entry><entry><title>Logged out users can’t bring up the Plone popup calendar</title><link href="http://davidjb.com/blog/2009/12/logged-out-users-cant-bring-up-the-plone-popup-calendar/" rel="alternate"></link><updated>2009-12-18T12:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-18:blog/2009/12/logged-out-users-cant-bring-up-the-plone-popup-calendar/</id><summary type="html">&lt;p&gt;It&amp;#8217;s another one of those &amp;#8216;strange&amp;#8217; problems that has cropped up, but by
default in Plone, users who aren&amp;#8217;t authenticated aren&amp;#8217;t actually able to
bring up a pop-up calendar on a date&amp;nbsp;field.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s amazing that I haven&amp;#8217;t run into this issue before with something
like PloneFormGen, where you&amp;#8217;d think that a simple Date input field
would be pretty common.&amp;nbsp; Although, I guess it&amp;#8217;s the case that even
though I&amp;#8217;ve used these given forms, I&amp;#8217;ve probably never taken much
notice of the popup calendar icon and just selected a random date from
the drop-down lists.&amp;nbsp; I suppose entering a random number on they
keyboard and hitting tab across the fields 3 times is simpler than going
for the mouse.&amp;nbsp; Who&amp;nbsp;knows.&lt;/p&gt;
&lt;p&gt;Anyway, the issue presents itself with an error in the Javascript on the
page, with something like &amp;#8216;plone.jscalendar not defined&amp;#8217;, if my memory
serves me correctly.&amp;nbsp; I believe that Firebug/Firefox didn&amp;#8217;t show up an
error for me (because I was logged in!) so make sure you test this on
your site when you&amp;#8217;re logged out, if you&amp;#8217;ve got such fields.&amp;nbsp; Testing in
&lt;span class="caps"&gt;IE&lt;/span&gt; revealed the problem since my &lt;span class="caps"&gt;IE&lt;/span&gt; versions in my &lt;span class="caps"&gt;VM&lt;/span&gt; can&amp;#8217;t actually
enter details into form fields, thus preventing me &lt;em&gt;from&lt;/em&gt; actually
logging&amp;nbsp;in.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;The solution was the only Google result at the time, and that was at:
&lt;a class="reference external" href="http://plone.org/products/ploneformgen/issues/232"&gt;http://plone.org/products/ploneformgen/issues/232&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Essentially, head into the portal_css and portal_javascripts areas in
the &lt;span class="caps"&gt;ZMI&lt;/span&gt; and look search on the page for &amp;#8220;calendar&amp;#8221;.&amp;nbsp; You should find
that the &amp;#8216;condition&amp;#8217; on these resources isn&amp;#8217;t right (eg only logged in
users or &amp;#8220;not: portal/portal_membership/isAnonymousUser&amp;#8221; is set or
isn&amp;#8217;t correct at all).&amp;nbsp; Correct it accordingly to be blank (easiest
way!) and save.&amp;nbsp; You may need to enable/reload/disable the debugging
modes for the &lt;span class="caps"&gt;CSS&lt;/span&gt; and &lt;span class="caps"&gt;JS&lt;/span&gt; to see the change&amp;nbsp;immediately.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="authenticated"></category><category term="calendar"></category><category term="css"></category><category term="javascript"></category><category term="members"></category><category term="plone"></category><category term="popup"></category><category term="problem"></category><category term="testing"></category><category term="users"></category></entry><entry><title>David tries Plone 4.0a2 (Part 2)</title><link href="http://davidjb.com/blog/2009/12/david-tries-plone-4-0a2-part-2/" rel="alternate"></link><updated>2009-12-08T16:21:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-08:blog/2009/12/david-tries-plone-4-0a2-part-2/</id><summary type="html">&lt;p&gt;Rightio!&amp;nbsp; So we&amp;#8217;ve got Plone 4.0a2 installed and up and running.&amp;nbsp; Boy,
she looks&amp;nbsp;sweet:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The new Plone site setup is flawlessly simple.&amp;nbsp; No more &lt;span class="caps"&gt;ZMI&lt;/span&gt; for those
of us that don&amp;#8217;t want to use it.&amp;nbsp; It&amp;#8217;ll always still be useful, but
having Plone throw up a simple, no no-nonsense front-end installer is
just what it needed.&amp;nbsp; Other &lt;span class="caps"&gt;PHP&lt;/span&gt; based CMSes always had it too easy&amp;nbsp;;-)&lt;/li&gt;
&lt;li&gt;Editing view:&amp;nbsp; clearer tabs at the top (no idea how many clients miss
those, me included to start!) and resizable editing fields.&amp;nbsp; Great.
TinyMCE as the editor &amp;#8212; just what the doctor ordered as Kupu just
wasn&amp;#8217;t quite up to task.&amp;nbsp; (Note that I&amp;#8217;m using Wordpress with
TinyMCE, so I could be a little biased).&amp;nbsp; Still needs work with the
Image insert page, but anyway, in good time.&lt;ul&gt;
&lt;li&gt;Also, it seems like the &amp;#8220;auto-link text from Plone content title&amp;#8221;
feature is gone.&amp;nbsp; I&amp;#8217;ve opened a ticket, hopefully it&amp;#8217;ll get fixed:
&lt;a class="reference external" href="https://dev.plone.org/plone/ticket/9908"&gt;https://dev.plone.org/plone/ticket/9908&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Good to see the Resource Types for TinyMCE are simpler than Kupu.
Wow it was it a mission to add a new type of Folder-ish content
and not de-select the rest of everything in the process in its
multi-select box&amp;nbsp;widget.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pop-up overlays inside Plone: very cool.&amp;nbsp; Saves an entire page reload
(I would hope so&amp;#8230;) so a thumbs up from&amp;nbsp;me!&lt;/li&gt;
&lt;li&gt;Better search options and collapsed options on the form.&amp;nbsp; I saw the
latter as an add-on from ages ago and thought it&amp;#8217;d be a good thing to
have.&amp;nbsp; Nice to see it (or similar) included by default.&amp;nbsp; Those search
options were&amp;nbsp;daunting.&lt;/li&gt;
&lt;li&gt;Email addresses as logins!&amp;nbsp; Another feature that users keep asking
about that&amp;#8217;s&amp;nbsp;included.&lt;/li&gt;
&lt;li&gt;User rego fields &amp;#8212; something very promising as I&amp;#8217;ve been
looking/hoping to move to a less-fixed way of managing user profile
attributes in Plone.&amp;nbsp;&amp;nbsp;Goodo.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That&amp;#8217;s about a wrap from me.&amp;nbsp; Looking good so far; a lot of smaller
issues are getting sorted.&amp;nbsp; Cheers to all those developers for all the
hard work so far.&amp;nbsp; If I knew more, I&amp;#8217;d be helping out more than I am&amp;nbsp;now.&lt;/p&gt;
</summary><category term="alpha"></category><category term="demo"></category><category term="new"></category><category term="plone"></category><category term="sunburst"></category><category term="test"></category><category term="theme"></category><category term="ubuntu"></category></entry><entry><title>David tries Plone 4.0a2 (Part 1)</title><link href="http://davidjb.com/blog/2009/12/david-tries-plone-4-alpha-2-part-1/" rel="alternate"></link><updated>2009-12-08T15:48:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-08:blog/2009/12/david-tries-plone-4-alpha-2-part-1/</id><summary type="html">&lt;p&gt;Plone 4 is approaching!&amp;nbsp; Excellent!&amp;nbsp; Lots of new features to play around
with and plenty more things to have to fix with the upgrade.&amp;nbsp; I&amp;#8217;ve been
keeping tabs on the change log of updates and it&amp;#8217;s looking really good.
Lots of little, but significant, changes are afoot.&amp;nbsp; Now, how about
actually installing the Alpha 2 version of Plone 4 to see it for real?
Let&amp;#8217;s do&amp;nbsp;it!&lt;/p&gt;
&lt;p&gt;My steps are not going to work on your computer.&amp;nbsp; I don&amp;#8217;t think you&amp;#8217;ll
be able to follow my words/commands exactly, but here goes anyway about
my experience so far.&amp;nbsp; The buildout might/might not work on Windows/Mac;
I&amp;#8217;m on Linux and that&amp;#8217;s that&amp;nbsp;&lt;span class="caps"&gt;FYI&lt;/span&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;I grabbed the buildout from
&lt;a class="reference external" href="https://svn.plone.org/svn/plone/buildouts/plone-coredev/branches/"&gt;https://svn.plone.org/svn/plone/buildouts/plone-coredev/branches/&lt;/a&gt;
and beat it over the head with a stick.&amp;nbsp; I downloaded the Plone 4.0a2
versions.cfg from &lt;a class="reference external" href="http://dist.plone.org/release/4.0a2/versions.cfg"&gt;http://dist.plone.org/release/4.0a2/versions.cfg&lt;/a&gt;
over the top of the one provided and made the buildout.cfg provided
only extend off versions.cfg.&amp;nbsp; You&amp;#8217;ll also need to strip back the
&amp;#8216;parts&amp;#8217; section of the buildout (eg no &amp;#8216;test&amp;#8217; sections since I don&amp;#8217;t
really need to know things aren&amp;#8217;t 100% right yet ;-)&amp;nbsp;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Set up your virtualenv in your given folder, making sure you use
&lt;strong&gt;Python 2.6&lt;/strong&gt;.&amp;nbsp; It&amp;#8217;s not marked in huge text and bold for you as
much as it is for me.&amp;nbsp; If you see&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;While:
Installing.
Getting section instance1.
Initializing section instance1.
Loading zc.buildout recipe entry plone.recipe.zope2instance &amp;gt;=2.0:default.
An internal error occured due to a bug in either zc.buildout or in a
recipe being used:
)[1 if IS_WIN else 0]
^
SyntaxError: invalid syntax&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;then you need to stop using Python 2.4 and start using 2.6,&amp;nbsp;okay?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Make sure you&amp;#8217;ve got the Python 2.6 development libraries installed
on your machine.&amp;nbsp; Expect pain from Zope 2.12.1 (etc) if you don&amp;#8217;t.
If you see&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;include/ExtensionClass/ExtensionClass.h:83:20: error: Python.h: No such file or directory
....[lots of nasty errors]...
error: Setup script exited with error: command 'gcc' failed with exit status 1
An error occured when trying to install Zope2 2.12.1.Look above this message for any errors thatwere output by easy_install.
While:
Installing.
Getting section instance.
Initializing section instance.
Installing recipe plone.recipe.zope2instance.
Getting distribution for 'Zope2==2.12.1'.
Error: Couldn't install: Zope2 2.12.1&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;then go and run this, then run Buildout&amp;nbsp;again:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python-dev
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Sort your &lt;span class="caps"&gt;PIL&lt;/span&gt; out.&amp;nbsp; See here: &lt;a class="reference external" href="http://davidjb.com/blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty"&gt;this post&lt;/a&gt; for how to handle it.&amp;nbsp; I&amp;#8217;m
sure there are other, possibly easier ways, but the two
&amp;#8216;easy_install&amp;#8217; lines in that post&amp;nbsp;work.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Run your buildout and hope there&amp;#8217;s no other problems I haven&amp;#8217;t
covered.&amp;nbsp; If you get stuck, go say hi to Google and I&amp;#8217;ll see you back
here after class.&amp;nbsp; Other than that, wait a very long amount of time
whilst the buildout completes, with or without fingers crossed.&amp;nbsp; Your
choice.&amp;nbsp; My buildout&amp;#8217;s going well so far,&amp;nbsp;though.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And we&amp;#8217;re done buildout-ing!&amp;nbsp;&amp;nbsp;Success!&lt;/p&gt;
&lt;p&gt;See my &lt;a class="reference external" href="http://davidjb.com/blog/2009/12/david-tries-plone-4-0a2-part-2"&gt;next post&lt;/a&gt; for my thoughts of this new version so&amp;nbsp;far.&lt;/p&gt;
</summary><category term="alpha"></category><category term="buildout"></category><category term="install"></category><category term="plone"></category><category term="plone 4"></category><category term="testing"></category><category term="zope"></category></entry><entry><title>Deliverance, Plone, and tags</title><link href="http://davidjb.com/blog/2009/11/deliverance-plone-and-tags/" rel="alternate"></link><updated>2009-11-27T15:17:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-11-27:blog/2009/11/deliverance-plone-and-tags/</id><summary type="html">&lt;p&gt;It&amp;#8217;s been a little bit of time since my last post, and who can blame me
with my site having been down for almost 2 full days over the last
week!&amp;nbsp; I&amp;#8217;m not paying that much for the webspace, thankfully, but if I
was, I&amp;#8217;d be seeing red over it.&amp;nbsp; Apparently some patch for MySQL broke
everything; imagine how it looked to see my site with a &amp;#8216;500 internal
error&amp;#8217; plastered all over it and not being able to access my cPanel.&amp;nbsp;Ugh.&lt;/p&gt;
&lt;p&gt;Anyway, everything&amp;#8217;s back again, assuming that you can see this.&amp;nbsp; Okay?&amp;nbsp;Great!&lt;/p&gt;
&lt;p&gt;Today&amp;#8217;s conundrum presented itself very, very strangely.&amp;nbsp; People
couldn&amp;#8217;t change their password in Plone (which effectively breaks
registration if a user has to select a password).&amp;nbsp; The Plone site we
have was being themed by Deliverance. A colleague and I were taking a
look at this earlier in the week and from everything that we could see,
the request traffic and variables were being sent onto Plone correctly
from Deliverance. That said, the issue&amp;nbsp;persisted.&lt;/p&gt;
&lt;p&gt;The issue ended up being a missing &amp;lt;base&amp;gt; tag in the page&amp;#8217;s &lt;span class="caps"&gt;HTML&lt;/span&gt; &amp;lt;head&amp;gt;
tag. Since this &amp;lt;base&amp;gt; tag controls relative links on any given page, I
guess that the resulting request/etc for password selection must have
been affected.&amp;nbsp; I&amp;#8217;ve seen some pretty whacked out things happen without
that base tag, including bad relative links (the obvious problem),
missing menus on content (another issue relating to an old blog post)&amp;nbsp;etc.&lt;/p&gt;
&lt;p&gt;Essentially, Deliverance doesn&amp;#8217;t bring the &amp;lt;base&amp;gt; tag across by default,
as it doesn&amp;#8217;t know any better. That said, putting these new&amp;nbsp;elements:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;replace&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;theme=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;append&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;theme=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;children:/html/head&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;in the deliverance.xml configuration solved the problem.&amp;nbsp; Depending on
your theme, you might want just one of the lines as it says &amp;#8220;replace my
&amp;lt;base&amp;gt; tag in theme with the one from the page&amp;#8221; and falls back to
&amp;#8220;append the base tag into the theme&amp;#8221;.&amp;nbsp; Thanks the tag being moved with
the first command, the 2nd doesn&amp;#8217;t happen if the base tag is already
gone from the&amp;nbsp;content.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;phew&lt;/em&gt; That was confusing; hopefully it helps someone&amp;nbsp;out!&lt;/p&gt;
</summary><category term="deliverance"></category><category term="element"></category><category term="plone"></category><category term="problem"></category><category term="theme"></category><category term="themeing"></category><category term="xml"></category></entry><entry><title>Missing content menus in Plone</title><link href="http://davidjb.com/blog/2009/09/missing-content-menus-in-plone/" rel="alternate"></link><updated>2009-09-30T12:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-30:blog/2009/09/missing-content-menus-in-plone/</id><summary type="html">&lt;p&gt;Another dose of insanity please!&amp;nbsp; Coming right up,&amp;nbsp;sir.&lt;/p&gt;
&lt;p&gt;Today&amp;#8217;s second discussion comes from an issue I was having recently with
a new Plone site that I was hosting behind Apache and Deliverance.&amp;nbsp; No
Varnish here yet, because I&amp;#8217;d rather the site worked first before I try
and cache the life out of&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;Now, the specific problem I was having was that the content menus in
Plone (eg Add New, Display, State, Actions and for me, Sub-types)
weren&amp;#8217;t displaying.&amp;nbsp; I thought it a Deliverance issue - maybe I was
dropping those content items accidentally or not including the
JavaScript needed to display them.&amp;nbsp; Uh, nope on both&amp;nbsp;accounts.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;After a detailed search of everything I could have been doing wrong, I
can across my Apache rewrite rules.&amp;nbsp; Amazingly enough, I&amp;#8217;d left off the
&lt;strong&gt;/_vh_mysite&lt;/strong&gt; at the end, so the URLs weren&amp;#8217;t being written
correctly.&amp;nbsp; Whilst the site was loading (mostly) fine, because I&amp;#8217;d
inserted the &lt;span class="caps"&gt;URL&lt;/span&gt; to point to the site correctly, I&amp;#8217;d forgotten that the
&lt;span class="caps"&gt;VHM&lt;/span&gt; needs the _vh_mysite&amp;nbsp;part.&lt;/p&gt;
&lt;p&gt;Adding it in fixed the problem in a second, along with a throat-clearing&amp;nbsp;shift-refresh.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="apache"></category><category term="hosting"></category><category term="menus"></category><category term="plone"></category><category term="rewrite"></category><category term="rules"></category><category term="urls"></category><category term="VHM"></category><category term="virtual hosting"></category></entry><entry><title>Migrating a Plone site off to another database (Zeo)</title><link href="http://davidjb.com/blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/" rel="alternate"></link><updated>2009-09-30T12:25:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-30:blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/</id><summary type="html">&lt;p&gt;Another of the interesting things in my professional life has been
migrating a Plone site from one database (where it lived as a dev site,
along with many others) onto a nice, clean database of its own.&amp;nbsp; Now,
yes, I&amp;#8217;m aware that the export/import feature of Zope &lt;strong&gt;isn&amp;#8217;t&lt;/strong&gt; supposed to
be used for migrating content or sites.&amp;nbsp; I am also aware, however,
through personal experience, that things have always been fine because
I&amp;#8217;m using the same eggs and essentially the same installations
everywhere, thanks to&amp;nbsp;buildout.&lt;/p&gt;
&lt;p&gt;So, the process goes as follows, with the above-mentioned points
considered&amp;nbsp;already:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Head to the root of your &lt;span class="caps"&gt;ZMI&lt;/span&gt; and export your given Plone site&amp;nbsp; as&amp;nbsp;&lt;span class="caps"&gt;ZEXP&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Shut down your instance (or do what you will with your old site and&amp;nbsp;installation)&lt;/li&gt;
&lt;li&gt;Copy the &lt;span class="caps"&gt;ZEXP&lt;/span&gt; file into the &amp;#8216;import&amp;#8217; folder of your new Zope&amp;nbsp;instance&lt;/li&gt;
&lt;li&gt;Start your new instance, with your new empty&amp;nbsp;database&lt;/li&gt;
&lt;li&gt;Log in to the root of the&amp;nbsp;&lt;span class="caps"&gt;ZMI&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Add a new Plone site and call it anything you want (eg &amp;#8216;foo&amp;#8217;).&amp;nbsp; I&amp;#8217;ll
explain why&amp;nbsp;shortly.&lt;/li&gt;
&lt;li&gt;Delete your &amp;#8216;foo&amp;#8217; Plone&amp;nbsp;site.&lt;/li&gt;
&lt;li&gt;Import your existing Plone site and be happy because it&amp;#8217;s now arrived
safe and&amp;nbsp;sound.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="note"&gt;
&lt;h2&gt;Note&lt;/h2&gt;
&lt;p&gt;The reason I highlight adding a new Plone site a point 6 is because if
originally, you were like me and imported your site first to a bare Zope
install, you&amp;#8217;ll get errors &lt;strong&gt;everywhere&lt;/strong&gt; in your site.&amp;nbsp; They&amp;#8217;ll look
like &amp;#8220;AttributeError: getGroups&amp;#8221; or possibly something more obscure (if
possible!) and everything will fall over and&amp;nbsp;die.&lt;/p&gt;
&lt;p&gt;Now, by creating a new Plone site first &amp;#8216;massages&amp;#8217; the root of Zope, and
then your site should be fine.&amp;nbsp; Among other things, adding a site
changes the acl_users of the &lt;span class="caps"&gt;ZMI&lt;/span&gt; (seeing an abnormal acl_users is what
led me to the solution).&amp;nbsp; At a guess, given its type, this acl_users
change probably has something to do with the error&amp;nbsp;above.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="database"></category><category term="export"></category><category term="import"></category><category term="migration"></category><category term="plone"></category><category term="site"></category><category term="zeo"></category><category term="zodb"></category></entry><entry><title>PloneFormGen (Plone) &amp; Google Calendar Integration</title><link href="http://davidjb.com/blog/2009/09/ploneformgen-plone-google-calendar-integration/" rel="alternate"></link><updated>2009-09-22T10:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-22:blog/2009/09/ploneformgen-plone-google-calendar-integration/</id><summary type="html">&lt;p&gt;It&amp;#8217;s a little bit of a different mash-up, but it&amp;#8217;s still nonetheless
useful to have, given types of booking forms and so forth that could
utilise it.&amp;nbsp; The easiest way I found (to avoid security issues with
Python scripts in Plone) was to create an external method and just
import it within a &lt;span class="caps"&gt;PFG&lt;/span&gt; Custom&amp;nbsp;Adapter.&lt;/p&gt;
&lt;div class="section" id="parts"&gt;
&lt;h2&gt;Parts&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;My &lt;a class="reference external" href="http://davidjb.com/static/files/GoogleCalendar.py"&gt;GoogleCalendar.py&lt;/a&gt; external method.&amp;nbsp; I&amp;#8217;ve had to add this into a
policy product I have.&amp;nbsp; The function should be generalised enough to
work with any Google account, hosted or not.&amp;nbsp; In&amp;nbsp;short:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;It takes in a variety of arguments (email, password,
calendar_url, start_time, end_time, title, location, content).&lt;ul&gt;
&lt;li&gt;Email/password are your auth&amp;nbsp;details&lt;/li&gt;
&lt;li&gt;calendar_url is where you&amp;#8217;re putting the&amp;nbsp;event,&lt;/li&gt;
&lt;li&gt;and the rest of the args are related to the event&amp;nbsp;itself.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;It builds the &lt;span class="caps"&gt;XML&lt;/span&gt;-based request to create the event.&amp;nbsp; I tried
going for the gdata &lt;span class="caps"&gt;API&lt;/span&gt;, but it&amp;#8217;s just over the top for a simple
exercise like&amp;nbsp;this.&lt;/li&gt;
&lt;li&gt;Send the request to Google (twice, as required), and create the
event in the&amp;nbsp;process.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;A custom &lt;span class="caps"&gt;PFG&lt;/span&gt; script adapter like&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;DateTime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DateTime&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;my.theme.Extensions.GoogleCalendar&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;createGoogleCalendarEvent&lt;/span&gt;
&lt;span class="n"&gt;calendar_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'http://www.google.com/...'&lt;/span&gt;
&lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'&amp;lt;span class=&amp;quot;mh-email&amp;quot;&amp;gt;myu&amp;lt;a href=&amp;quot;http://www.google.com/recaptcha/mailhide/d?k=01y8BLyDqFl2lR8hms6kYeaw==&amp;amp;c=WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY=&amp;quot; onclick=&amp;quot;window.open('&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;google&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;recaptcha&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mailhide&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mo"&gt;01&lt;/span&gt;&lt;span class="n"&gt;y8BLyDqFl2lR8hms6kYeaw&lt;/span&gt;&lt;span class="o"&gt;==&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;', '', '&lt;/span&gt;&lt;span class="n"&gt;toolbar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;scrollbars&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;statusbar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;menubar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;resizable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="s"&gt;'); return false;&amp;quot; title=&amp;quot;Reveal this e-mail address&amp;quot;&amp;gt;...&amp;lt;/a&amp;gt;&amp;#64;google.com&amp;lt;/span&amp;gt;'&lt;/span&gt;
&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'shhhhhsecret'&lt;/span&gt;
&lt;span class="n"&gt;startDateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'start-date-time'&lt;/span&gt;&lt;span class="p"&gt;])))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;&lt;span class="caps"&gt;HTML4&lt;/span&gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;endDateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'end-date-time'&lt;/span&gt;&lt;span class="p"&gt;])))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;&lt;span class="caps"&gt;HTML4&lt;/span&gt;&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;eventTitle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'purpose'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;eventLocation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'rooms-to-book'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;eventContent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'Booked for:  '&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'booking-name'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;createGoogleCalendarEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;calendar_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;startDateTime&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;endDateTime&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventTitle&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventLocation&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventContent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And that should be that.&amp;nbsp; As long as all your URLs, emails, passwords,
and fields in your form are suitable, this should work a treat.&amp;nbsp; Note
that the start-date-time and end-date-time fields are date/time fields
in your Form Folder and converting to &lt;span class="caps"&gt;HTML4&lt;/span&gt;() makes them into Google&amp;#8217;s
format.&amp;nbsp; Additional info can be added in the eventContent variable, and
that&amp;#8217;ll turn up in the Description in Google&amp;nbsp;Calendar.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="for-added-spice"&gt;
&lt;h2&gt;For added&amp;nbsp;spice&amp;#8230;&lt;/h2&gt;
&lt;p&gt;Just add a web interface to your Google Calendar to your Plone site (eg
in a normal Plone page; watch out for iframe filtering) and let people
book themselves into things.&amp;nbsp; Would be great to see &lt;span class="caps"&gt;PFG&lt;/span&gt; know when a
Google Calendar event was on (and stop people submitting) but it&amp;#8217;s a bit
much just for&amp;nbsp;now.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="calendar"></category><category term="form"></category><category term="gen"></category><category term="google"></category><category term="mash"></category><category term="pfg"></category><category term="plone"></category><category term="product"></category><category term="python"></category><category term="script"></category></entry><entry><title>Plone: Re-ordering Viewlets</title><link href="http://davidjb.com/blog/2009/08/plone-re-ordering-viewlets/" rel="alternate"></link><updated>2009-08-19T16:34:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-08-19:blog/2009/08/plone-re-ordering-viewlets/</id><summary type="html">&lt;p&gt;Just responded to a post on the Plone Nabble forums (&lt;a class="reference external" href="http://n2.nabble.com/reordering-portal-globalnav--tp3470440p3470440.html"&gt;here&lt;/a&gt;) about how
to re-order viewlets.&amp;nbsp; In particular, this one is little different (but
not terribly so) because the original poster wanted to put the
breadcrumbs above the global sections (global tabs in Plone).&amp;nbsp; Normally,
this is straight forward because you just use a Generic Setup profile
(viewlets.xml) and use an order manager to move your viewlet.&amp;nbsp; This,
however, is a teeny bit more complicated because you&amp;#8217;ve got one viewlet
that&amp;#8217;s outside of another viewlet&amp;nbsp;manager.&lt;/p&gt;
&lt;p&gt;Without further ado, my post from the&amp;nbsp;forums:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Check out
&lt;a class="reference external" href="http://plone.org/documentation/tutorial/customizing-main-template-viewlets/reordering-and-hiding-viewlets"&gt;http://plone.org/documentation/tutorial/customizing-main-template-viewlets/reordering-and-hiding-viewlets&lt;/a&gt;
for a pretty useful idea of manipulating&amp;nbsp;viewlets.&lt;/p&gt;
&lt;p&gt;As it mentions there, you need a viewlets.xml in your theme
product&amp;#8217;s generic setup profile. &amp;nbsp;In this case, there&amp;#8217;s a bit more
complexity because the path_bar isn&amp;#8217;t registered in the same order
manager. &amp;nbsp;So, in your case, you&amp;#8217;ll want something like this in your
&lt;strong&gt;viewlets.xml&lt;/strong&gt; (hides the old path bar, and inserts it now before
the global sections&amp;nbsp;[tabs]):&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;hidden&lt;/span&gt; &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.portaltop&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;skinname=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;My Theme&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;viewlet&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/hidden&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;order&lt;/span&gt; &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.portalheader&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;skinname=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;My Theme&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;viewlet&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;insert-before=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.global_sections&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/order&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and you&amp;#8217;ll need to have something like this in a &lt;strong&gt;configure.zcml&lt;/strong&gt;
file (eg browser/configure.zcml) in order to get it into the
PortalHeader&amp;nbsp;manager:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;browser&lt;/span&gt; &lt;span class="err"&gt;:viewlet&lt;/span&gt;
    &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt;
    &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.app.layout.viewlets.interfaces.IPortalHeader&amp;quot;&lt;/span&gt;
    &lt;span class="na"&gt;permission=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;zope2.View&amp;quot;&lt;/span&gt;
    &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, make these updates to your theme product, reinstall, and it
should be&amp;nbsp;good.&lt;/p&gt;
&lt;p&gt;Also, depending on ordering and what else you have in your theme,
you might just want to re-order plone.path_bar to the top of the
plone.portaltop viewlet. &amp;nbsp;That&amp;#8217;ll put it before the PortalHeader
manager (as you can see in&amp;nbsp;&amp;#64;&amp;#64;manage-viewlets).&lt;/p&gt;
&lt;/blockquote&gt;
</summary><category term="genericsetup"></category><category term="plone"></category><category term="product"></category><category term="programming"></category><category term="theme"></category></entry><entry><title>Virtualenv, Plone, and Centos 5.x</title><link href="http://davidjb.com/blog/2009/07/virtualenv-plone-and-centos-5/" rel="alternate"></link><updated>2009-07-09T13:25:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-07-09:blog/2009/07/virtualenv-plone-and-centos-5/</id><summary type="html">&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;EDIT&lt;/span&gt;:&lt;/strong&gt; Watch out for python-ldap 2.3.10, the latest version at time
of writing. Seems like there&amp;#8217;s an issue with it and Centos 5.4. Forcing
python-ldap to be version 2.3.8 works, though. (easy_install&amp;nbsp;python-ldap==2.3.8)&lt;/p&gt;
&lt;p&gt;Previously, you might have read about setting up a Virtualenv on Ubuntu
Jaunty. Now, that was reasonably painless since python-virtualenv and
python-setuptools is in the Ubuntu repo. Whether it&amp;#8217;s my Centos servers
and their misguided repos or me just not being able to find such a
related rpm packages, Centos just needs little more love to get it to
the same setup. (&lt;strong&gt;Note:&lt;/strong&gt; actually, there was a setuptools &lt;span class="caps"&gt;RPM&lt;/span&gt; that I
installed, but no idea why it didn&amp;#8217;t give me&amp;nbsp;easy_install&amp;#8230;)&lt;/p&gt;
&lt;p&gt;Here&amp;#8217;s what we&amp;#8217;re looking at for this time&amp;nbsp;around.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;Install the dependencies and various development libraries needed for
&lt;span class="caps"&gt;PIL&lt;/span&gt;&amp;nbsp;etc:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
yum install gcc gdbm-devel readline-devel ncurses-devel zlib-devel bzip2-devel sqlite-devel db4-devel openssl-devel tk-devel bluez-libs-devel libjpeg-devel zlib-devel freetype-devel
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Install setuptools and&amp;nbsp;virtualenv:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://pypi.python.org/packages/2.4/s/setuptools/setuptools-0.6c9-py2.4.egg#md5&lt;span class="o"&gt;=&lt;/span&gt;260a2be2e5388d66bdaee06abec6342a
sh setuptools-0.6c9-py2.4.egg
rm -f setuptools-0.6c9-py2.4.egg
easy_install-2.4 -U setuptools
easy_install-2.4 virtualenv
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Create a virtual environment and activate&amp;nbsp;it:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Easy install the dependencies of Plone. Not sure if they&amp;#8217;re needed
for Centos, but it did all work nicely after doing&amp;nbsp;this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre class="code literal-block"&gt;
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
easy_install lxml
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Clear as mud? I thought so. Essentially the only difference is actually
getting the right development libraries and then getting setuptools
itself working correctly. As I mentioned, for whatever reason my
python-setuptools rpm doesn&amp;#8217;t have easy install. Maybe it&amp;#8217;s because it&amp;#8217;s
an old version? Who knows. This is an easy enough&amp;nbsp;workaround.&lt;/p&gt;
</summary><category term="centos"></category><category term="easy_install"></category><category term="plone"></category><category term="python"></category><category term="rpm"></category><category term="virtualenv"></category></entry><entry><title>plone.app.blob and Failed Migrations</title><link href="http://davidjb.com/blog/2009/07/plone-app-blob-and-failed-migrations/" rel="alternate"></link><updated>2009-07-03T12:11:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-07-03:blog/2009/07/plone-app-blob-and-failed-migrations/</id><summary type="html">&lt;p&gt;Another fun-and-games style problem I&amp;#8217;ve come across when using
plone.app.blob: sometimes migrations won&amp;#8217;t work when converting a
standard site&amp;#8217;s files over to&amp;nbsp;blobs.&lt;/p&gt;
&lt;p&gt;That&amp;#8217;s a pretty ambiguious description, but essentially, the error you
might see will have a semi-normal traceback to start, and then garbage
(contents of a file, presumably) - which, depending on the file size
might hurt your browser.&amp;nbsp; The last part of the (normal) traceback reads&amp;nbsp;thus:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;File &amp;quot;/home/buildout/instance/eggs/plone.app.linkintegrity-1.0.11-py2.4.egg/ plone/app/linkintegrity/handlers.py&amp;quot;, line 158, in referencedObjectRemoved raise LinkIntegrityNotificationException, obj LinkIntegrityNotificationException&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Thankfully, this gives us an excellent pointer to a solution: disable
link integrity checking on your site prior to&amp;nbsp;migrating.&lt;/p&gt;
&lt;div class="section" id="the-fix-workaround"&gt;
&lt;h2&gt;The&amp;nbsp;fix/workaround&lt;/h2&gt;
&lt;p&gt;Head to the Plone Control Panel, and click onto Site.&amp;nbsp; Uncheck &lt;em&gt;Enable
link integrity checks&lt;/em&gt;and then run your blob migration.&amp;nbsp; When you&amp;#8217;re
done, you can return your site to normal.Or not.&amp;nbsp; Your choice.&amp;nbsp; Doens&amp;#8217;t
seem like there&amp;#8217;s any harm with turning it back on once everything&amp;#8217;s
happy; just something to watch out when migrating&amp;nbsp;content.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="blob"></category><category term="fix"></category><category term="links"></category><category term="plone"></category><category term="problem"></category><category term="traceback"></category></entry><entry><title>User-selectable Themes In Plone</title><link href="http://davidjb.com/blog/2009/06/user-selectable-themes-in-plone/" rel="alternate"></link><updated>2009-06-25T13:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-06-25:blog/2009/06/user-selectable-themes-in-plone/</id><summary type="html">&lt;p&gt;It&amp;#8217;s something I came across a while ago, but wasn&amp;#8217;t exactly something
that stayed in the fore-front of my mind: how to let users choose or
select a theme (arbitrarily) on a Plone site.&amp;nbsp; Normally, I stick to
having one theme per site for continuity but a new theme-test site for
clients is an&amp;nbsp;exception.&lt;/p&gt;
&lt;p&gt;If you were to search Google for the right terms, you&amp;#8217;ll find out how to
let this happen, but I ended up having to go hunt it down myself.
Hopefully this entry will help people (if I go and include as many terms
as I think I or someone else might look&amp;nbsp;for!).&lt;/p&gt;
&lt;div class="section" id="how"&gt;
&lt;h2&gt;How&lt;/h2&gt;
&lt;p&gt;Head to the &lt;span class="caps"&gt;ZMI&lt;/span&gt; as an administrative user (/manage), and then to
portal_skins.&amp;nbsp; Under the Properties tab, you&amp;#8217;ll find a Boolean option
called &amp;#8220;Allow arbitrary skins to be selected&amp;#8221;.&amp;nbsp; You guessed it; turn to
it on and&amp;nbsp;save.&lt;/p&gt;
&lt;p&gt;Your users now have a drop-down menu in their personal preferences for
changing the theme.&amp;nbsp; Install some additional themes and away you&amp;nbsp;go.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; seems like this feature doesn&amp;#8217;t work well or I&amp;#8217;m not using it
right.&amp;nbsp; Changing the theme for one user changes it for everyone..hmm.
Probably the reason the option&amp;#8217;s hiding in the&amp;nbsp;&lt;span class="caps"&gt;ZMI&lt;/span&gt;!&lt;/p&gt;
&lt;/div&gt;
</summary><category term="plone"></category><category term="skin"></category><category term="theme"></category><category term="zmi"></category></entry><entry><title>Virtualenv, Plone, and Ubuntu 9.04 Jaunty</title><link href="http://davidjb.com/blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty/" rel="alternate"></link><updated>2009-06-12T12:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-06-12:blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty/</id><summary type="html">&lt;p&gt;What a complicated situation it is trying to use all of the
above-mentioned pieces of software together. In all seriousness,
Virtualenv is now appearing to be the best thing since sliced bread for
me to help out with making Plone/Zope usable under&amp;nbsp;Jaunty.&lt;/p&gt;
&lt;p&gt;By default, as everyone should know by now, a whole bunch of old Python
2.4 packages got removed from Jaunty, throwing us Plone developers into
peril.&amp;nbsp; Well, those of us who hadn&amp;#8217;t discovered the joys of virtualenv
yet, that&amp;nbsp;is.&lt;/p&gt;
&lt;p&gt;Here&amp;#8217;s how to convert an existing buildout folder over to Virtualenv
without too much&amp;nbsp;hassle:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python-virtualenv
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
easy_install ipython
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
./bin/buildout
&lt;/pre&gt;
&lt;p&gt;And that should handle the issues of, in order of command: installing
virtualenv, setting up our current folder, activating virtualenv,
installing useful/necessary python packages, and reworking everything
via&amp;nbsp;buildout.&lt;/p&gt;
&lt;p&gt;The instance of Plone/Zope can be started up with/without
`&lt;strong&gt;activate&lt;/strong&gt;` being `&lt;strong&gt;source&lt;/strong&gt;`&amp;#8217;d, as virtualenv has now
got its own local python interpreter&amp;nbsp;here.&lt;/p&gt;
&lt;p&gt;Cheers to Athena Geek &amp;#64;
&lt;a class="reference external" href="http://athenageek.wordpress.com/2009/05/22/virtualenv-in-plone/"&gt;http://athenageek.wordpress.com/2009/05/22/virtualenv-in-plone/&lt;/a&gt; for the
details to get me&amp;nbsp;started.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;EDIT&lt;/span&gt;:&lt;/strong&gt; You might need to install some of the following packages to
make all the imaging (and rest of Plone) be&amp;nbsp;happy:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python2.4-dev libtk-img-dev libfreeimage-dev libjpeg62-dev libfreetype6-dev libtk-img-dev tcl8.5-dev tk8.5-dev lynx poppler-utils xpdf wv xlhtml ppthtml
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;EDIT2&lt;/span&gt;:&lt;/strong&gt; If you get weird messages about &amp;#8220;Undefined symbol:
PyUnicodeUCS2_*&amp;#8221; then you should probably wipe your virtualenv clean
and go again. Essentially, dump your lib, include, and content of your
eggs folder, and re-do your virtualenv. If pain persists, see your&amp;nbsp;Google.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;EDIT3&lt;/span&gt;:&lt;/strong&gt; This also works on Karmic (9.10)!&amp;nbsp;:)&lt;/p&gt;
</summary><category term="9.04"></category><category term="9.10"></category><category term="jaunty"></category><category term="karmic"></category><category term="linux"></category><category term="plone"></category><category term="python"></category><category term="ubuntu"></category><category term="virtualenv"></category><category term="zope"></category></entry><entry><title>Plone: Issues with products</title><link href="http://davidjb.com/blog/2009/04/plone-issues-with-products/" rel="alternate"></link><updated>2009-04-23T09:15:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-04-23:blog/2009/04/plone-issues-with-products/</id><summary type="html">&lt;p&gt;Oh dear. Products in Plone that don&amp;#8217;t care to uninstall themselves at
all when removed. One such product that comes to mind is&amp;nbsp;ZipFileTransport.&lt;/p&gt;
&lt;p&gt;I could go into depth all day about its failure to uninstall, but in
specific, it&amp;#8217;s this line of code in its setupHandlers.py file that kills&amp;nbsp;me:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registerUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'zipfiletransport'&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Now, where&amp;#8217;s the unregisterUtility called? Nowhere, unfortunately. So
when one tries to go and install/uninstall/reinstall/do certain things
on the site, you get a nasty failure message about trying to unpickle a
python&amp;nbsp;object:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2009-04-23 10:19:19 &lt;span class="caps"&gt;ERROR&lt;/span&gt; Zope.SiteErrorLog http://localhost:8080/eresearch/portal_quickinstaller/uninstallProductsTraceback (innermost last):
Module ZPublisher.Publish, line 125, in publish
Module Zope2.App.startup, line 238, in commit
Module transaction._manager, line 96, in commit
Module transaction._transaction, line 395, in commit
Module transaction._transaction, line 495, in _commitResources
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 510, in commit
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 555, in _commit
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.Connection, line 582, in _store_objects
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.serialize, line 407, in serialize
Module &lt;span class="caps"&gt;ZODB&lt;/span&gt;.serialize, line 416, in _dump
PicklingError: Can't pickle: import of module Products.ZipFileTransport.utilities.interfaces failed&lt;/span&gt;
&lt;/pre&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution?&lt;/h2&gt;
&lt;p&gt;Okay, I found the unregisterUtility function in zope.component, and it
can be accessed by something like this (ipython session, of course):
(You&amp;#8217;ll need at least the &lt;span class="caps"&gt;ZFT&lt;/span&gt; parts below present to import&amp;nbsp;them).&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.app.component.hooks&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;setSite&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.component&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.ZipFileTransport.utilities.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.ZipFileTransport.utilities.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ZipFileTransportUtility&lt;/span&gt;
&lt;span class="n"&gt;setSite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;portal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;#Even though unregister happened, it probably said it worked but left crap around.&lt;/span&gt;
&lt;span class="c"&gt;#Let's clean it up&lt;/span&gt;

&lt;span class="c"&gt;#This intclass variable might not be right.  It's going to be the key present below,&lt;/span&gt;
&lt;span class="c"&gt;#so you can always find the right InterfaceClass manually and set it accordingly.&lt;/span&gt;
&lt;span class="n"&gt;intclass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;#From here, search for 'Zip' to see if it's gone&lt;/span&gt;
&lt;span class="c"&gt;#Each should return -1.  If not, you've done something wrong!&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And thus ends the tyranny of&amp;nbsp;ZipFileTransport.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Edit:&lt;/strong&gt; I should make it clear that to run the above commands you need
to have a handle to your Plone site object, and be pre-set as the
&amp;#8216;portal&amp;#8217; variable. If you set up ipython like so:
&lt;a class="reference external" href="http://plone.org/documentation/kb/setup-ipython-for-zope"&gt;http://plone.org/documentation/kb/setup-ipython-for-zope&lt;/a&gt; then that takes
care of things automatically and gives you interactive handles to your
portal and Zope app root. If you&amp;#8217;re not using this, then figure out how
to set &amp;#8216;portal&amp;#8217; manually to be your Plone site object (not a string or
name, but the actual object) and run the rest of the lines of&amp;nbsp;code.&lt;/p&gt;
&lt;p&gt;Also, I&amp;#8217;m not sure whether you need to commit your changes or not. If
you find the changes don&amp;#8217;t stick, then try this in your ipython&amp;nbsp;session:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;transaction&lt;/span&gt;
&lt;span class="n"&gt;transaction&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
</summary><category term="plone"></category><category term="problem"></category><category term="products"></category><category term="zip"></category></entry><entry><title>Plone: Clamping down on categories</title><link href="http://davidjb.com/blog/2009/04/plone-clamping-down-on-categories/" rel="alternate"></link><updated>2009-04-21T09:11:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-04-21:blog/2009/04/plone-clamping-down-on-categories/</id><summary type="html">&lt;p&gt;Probably my last blog entry here because I&amp;#8217;ll be moving to the &lt;span class="caps"&gt;AWESOME&lt;/span&gt;
WordPress very soon &amp;#64; &lt;a class="reference external" href="http://davidjb.com/blog"&gt;http://davidjb.com/blog&lt;/a&gt; (with a nice new site design,
too)&amp;nbsp; (&lt;span class="caps"&gt;EDIT&lt;/span&gt;: Migrated from my old blog 8-) ) .  (&lt;strong&gt;2013 edit&lt;/strong&gt;: Goodbye
Wordpress, I really hate &lt;span class="caps"&gt;PHP&lt;/span&gt; and its security issues. I&amp;#8217;m a Python developer
and I really should be eating my own&amp;nbsp;dogfood).&lt;/p&gt;
&lt;p&gt;Anyway, how to prevent the addition of new categories to the Plone
listing (the inline comments aren&amp;#8217;t mine, they&amp;#8217;re&amp;nbsp;copied):&lt;/p&gt;
&lt;blockquote&gt;
It&amp;#8217;s a bit hidden and probably undocumented but here we go: &lt;span class="caps"&gt;ZMI&lt;/span&gt; -&amp;gt;
portal_metadata -&amp;gt; schema tab (should be the default view of the
tool in &lt;span class="caps"&gt;ZMI&lt;/span&gt;) -&amp;gt; click &lt;span class="caps"&gt;DCMI&lt;/span&gt; in the Metadata Schemas section (why do
so many people not know that the plural form of &amp;#8216;schema&amp;#8217; is
&amp;#8216;schemata&amp;#8217; - but I digress …) -&amp;gt; click &amp;#8216;Subject&amp;#8217; within the
&amp;#8216;Element&amp;#8217; row -&amp;gt; add terms to the vocabulary field - in the upper
part if this should apply to all portal types (don&amp;#8217;t forget to press
&amp;#8216;Update&amp;#8217;) or in the lower part to define a portal type specific
policy.&lt;/blockquote&gt;
&lt;p&gt;Something that wasn&amp;#8217;t mentioned was the &amp;#8216;Enforce vocabulary?&amp;#8217; box. If
you go and tick that, and save the changes, then any additional
categories that someone adds are only localised to that one content item
- they&amp;#8217;re not entered into the overall listing. Doesn&amp;#8217;t stop someone who
misses a category from entering a new one locally, but it&amp;#8217;s a good&amp;nbsp;start.&lt;/p&gt;
</summary><category term="categories"></category><category term="enforce"></category><category term="plone"></category></entry><entry><title>Plone: Plone4Artists Video - Can’t Edit Videos</title><link href="http://davidjb.com/blog/2009/02/plone-plone4artists-video-cant-edit-videos/" rel="alternate"></link><updated>2009-02-25T09:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-02-25:blog/2009/02/plone-plone4artists-video-cant-edit-videos/</id><summary type="html">&lt;p&gt;Wow..I just keep hitting these problems. The latest issue is chronicled
here: &lt;a class="reference external" href="http://dev.plone4artists.org/pm/p/plone4artists/ticket/160"&gt;http://dev.plone4artists.org/pm/p/plone4artists/ticket/160&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;which essentially boils down to this problem when you try and edit a
video subtyped File from p4a.plonevideo (or p4a.video or whatever it&amp;#8217;s
called&amp;nbsp;now):&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Traceback (innermost last):
* Module ZPublisher.Publish, line 119, in publish
* Module ZPublisher.mapply, line 88, in mapply
* Module ZPublisher.Publish, line 42, in call_object
* Module zope.formlib.form, line 769, in __call__
* Module p4a.video.browser.video, line 362, in update
* Module Products.Five.formlib.formbase, line 55, in update
* Module zope.formlib.form, line 732, in update
* Module p4a.video.browser.video, line 367, in setUpWidgets
* Module zope.formlib.form, line 393, in setUpEditWidgets
* Module zope.formlib.form, line 323, in _createWidget
* Module zope.component._api, line 103, in getMultiAdapter
ComponentLookupError: ((&amp;lt;p4a .fileimage.file._field.FileField object at 0x15ce2610&amp;gt;, &amp;lt;httprequest , &lt;span class="caps"&gt;URL&lt;/span&gt;=[snip].mp4/atct_edit&amp;gt;), &amp;lt;interfaceclass zope.app.form.interfaces.IInputWidget&amp;gt;, u'')&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And so, after much painful searching and confusion, it&amp;#8217;s just simply an
issue of including &lt;tt class="docutils literal"&gt;p4a.fileimage&lt;/tt&gt; in the &lt;span class="caps"&gt;ZCML&lt;/span&gt; section of your
instance in your&amp;nbsp;buildout.&lt;/p&gt;
&lt;p&gt;Wow..back to work&amp;nbsp;(finally).&lt;/p&gt;
</summary><category term="p4a"></category><category term="plone"></category><category term="plone4artists"></category><category term="problem"></category><category term="subtyped"></category><category term="video"></category></entry><entry><title>Plone: Google Calendar Integration</title><link href="http://davidjb.com/blog/2009/02/plone-google-calendar-integration/" rel="alternate"></link><updated>2009-02-19T08:55:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-02-19:blog/2009/02/plone-google-calendar-integration/</id><summary type="html">&lt;p&gt;Wouldn&amp;#8217;t it be great if you could somehow add your Event content item
within the Plone &lt;span class="caps"&gt;CMS&lt;/span&gt; onto your Google Calendar with just a click? (it&amp;#8217;d
be better with fewer, but 1 click is pretty good - give me a&amp;nbsp;break!)&lt;/p&gt;
&lt;p&gt;Try this placed inside the &lt;tt class="docutils literal"&gt;event_view&lt;/tt&gt; page template (customise it in
the &lt;span class="caps"&gt;ZMI&lt;/span&gt;) after the vCal and iCal&amp;nbsp;links:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;tal:attributes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;href python:'http://www.google.com/calendar/event?action=&lt;span class="caps"&gt;TEMPLATE&lt;/span&gt;'
+'&amp;amp;text='+here.title
+'&amp;amp;dates='+here.start().toZone('&lt;span class="caps"&gt;UTC&lt;/span&gt;').&lt;span class="caps"&gt;ISO8601&lt;/span&gt;().replace('-','').replace(':','').split('+')[0]+'Z/'
+here.end().toZone('&lt;span class="caps"&gt;UTC&lt;/span&gt;').&lt;span class="caps"&gt;ISO8601&lt;/span&gt;().replace('-','').replace(':','').split('+')[0]+'Z'
+'&amp;amp;location='+here.location
+'&amp;amp;details='+here.getRawDescription()+'&amp;lt;br /&amp;gt;'+here.getRawText()
+'&amp;amp;trp=true'
+'&amp;amp;sprop=website:'+here.event_url()
+'&amp;amp;sprop=name:'+here.contact_name();&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;title=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Add this event to Google Calendar&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;target=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;_blank&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;style=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;background-image: none; padding: 0px;&amp;quot;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;img&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://www.google.com/calendar/images/ext/gc_button1.gif&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;alt=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Add to Google Calendar&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;50&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;13&amp;quot;&lt;/span&gt;  &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, it&amp;#8217;s clear as mud, right? It does some magic and completes a link
for you to use to add your given event and it&amp;#8217;s details into Google
Calendar from&amp;nbsp;Plone.&lt;/p&gt;
&lt;p&gt;For those of you really paying attention, the date conversion is nasty
(why doesn&amp;#8217;t Google accept an immediately accessible format?) and this
&lt;em&gt;won&amp;#8217;t&lt;/em&gt; work unless all fields are filled out. I&amp;#8217;m still working on a
field-friendly&amp;nbsp;solution.&lt;/p&gt;
&lt;p&gt;Either way, I didn&amp;#8217;t find anything on the web about doing this, so here
it is. Use as you&amp;nbsp;will.&lt;/p&gt;
</summary><category term="add to"></category><category term="calendar"></category><category term="event"></category><category term="google"></category><category term="integration"></category><category term="plone"></category></entry><entry><title>Plone: URL Encoding In A Script</title><link href="http://davidjb.com/blog/2009/01/plone-url-encoding-in-a-script/" rel="alternate"></link><updated>2009-01-30T08:46:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-30:blog/2009/01/plone-url-encoding-in-a-script/</id><summary type="html">&lt;p&gt;So, for today&amp;#8217;s problem, how can we get a &lt;span class="caps"&gt;URL&lt;/span&gt; (specifically the &lt;span class="caps"&gt;GET&lt;/span&gt;
request arguments) suitably encoded? Easy, if we&amp;#8217;re talking about a
Python script that lives on the file system and can be used within
Zope/Plone that way. But what about some sort of Python script that has
to exist on the Plone site (specifically, creating a PloneFormGen (&lt;span class="caps"&gt;PFG&lt;/span&gt;)
Custom&amp;nbsp;Adapter)?&lt;/p&gt;
&lt;p&gt;First thing I jumped to is urllib and urlecode: but no luck because
you&amp;#8217;re unauthorised to import the library in your script.&amp;nbsp;Boo!&lt;/p&gt;
&lt;p&gt;After much poking, and Googling for something that I thought should be
simple, I found&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.PythonScripts.standard&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;url_quote_plus&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Does exactly what it says and what it should, and no security issues.
There&amp;#8217;s also &lt;tt class="docutils literal"&gt;url_quote&lt;/tt&gt; which produces &lt;tt class="docutils literal"&gt;%20&lt;/tt&gt; instead of &lt;tt class="docutils literal"&gt;+&lt;/tt&gt;.&lt;/p&gt;
</summary><category term="adapter"></category><category term="form"></category><category term="plone"></category><category term="ploneformgen"></category><category term="python"></category><category term="quote"></category><category term="url"></category></entry><entry><title>Plone: Correcting Page Template Errors Easily</title><link href="http://davidjb.com/blog/2009/01/plone-correcting-page-template-errors-easily/" rel="alternate"></link><updated>2009-01-22T08:43:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-22:blog/2009/01/plone-correcting-page-template-errors-easily/</id><summary type="html">&lt;p&gt;Here&amp;#8217;s how to correct pesky problems in your code/&lt;span class="caps"&gt;XHTML&lt;/span&gt; since the line
number and column references are slightly useless in the&amp;nbsp;&lt;span class="caps"&gt;ZMI&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Paste contents from a page or page template from the &lt;span class="caps"&gt;ZMI&lt;/span&gt; into a program
like gedit and then the line and column reference numbers will be
correct (once you remove the comment about the error from the top of the&amp;nbsp;page).&lt;/p&gt;
&lt;p&gt;Editing in the &lt;span class="caps"&gt;ZMI&lt;/span&gt; is a bit painful, but we&amp;nbsp;persevere.&lt;/p&gt;
</summary><category term="code"></category><category term="editing"></category><category term="page"></category><category term="plone"></category><category term="python"></category><category term="template"></category><category term="zmi"></category></entry><entry><title>Plone: Varnish Configuration (Cache Hits, Purge Fails)</title><link href="http://davidjb.com/blog/2009/01/plone-varnish-configuration-cache-hits-purge-fails/" rel="alternate"></link><updated>2009-01-21T08:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-21:blog/2009/01/plone-varnish-configuration-cache-hits-purge-fails/</id><summary type="html">&lt;p&gt;What a painful, painful day. It&amp;#8217;s taken about the entire day, but I&amp;#8217;ve
finally figured out why our Varnish configuration around here for
Plone/Zope hasn&amp;#8217;t been accepting &lt;span class="caps"&gt;PURGE&lt;/span&gt; requests. Thus, without accepting
purge requests correctly, any content that gets changed in Plone doesn&amp;#8217;t
get updated in the cache until it times out (or we restart it). Ouch -
especially because it affects all sites under virtual hosting, and a lot
of these sites have publicly visible content that needs to be available&amp;nbsp;immediately.&lt;/p&gt;
&lt;p&gt;So, the problem manifested itself as&amp;nbsp;thus:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Cache hits&amp;nbsp;happen&lt;/li&gt;
&lt;li&gt;Performance was good on the Plone&amp;nbsp;sites&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;PURGE&lt;/span&gt; requests sent to Varnish would produce&amp;nbsp;404&amp;#8217;s&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So, after checking (many times) the object path for the &lt;span class="caps"&gt;PURGE&lt;/span&gt; was right,
Varnish would return a &lt;span class="caps"&gt;MISS&lt;/span&gt; and produce a 404 (&lt;span class="caps"&gt;DEBUG&lt;/span&gt; &amp;#8220;VCL_error(404,
Not in cache)&amp;#8221; as the Varnish&amp;nbsp;message).&lt;/p&gt;
&lt;p&gt;Much searching/etc later, I found that&amp;nbsp;using:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
curl -X PURGE http://localhost:8000/object/path
&lt;/pre&gt;
&lt;p&gt;straight on the machine running Varnish would work and give a &lt;em&gt;200 Purged
response&lt;/em&gt;. But, running the same command (replacing localhost with a &lt;span class="caps"&gt;FQDN&lt;/span&gt;) from
the Zope machine produced the 404. So, essentially, Varnish knows where to look
for the first command but not for the&amp;nbsp;second.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;Where you set the backend for your Plone/Zope in the Varnish
configuration, add set req.http.host&amp;nbsp;accordingly:&lt;/p&gt;
&lt;pre class="code cpp literal-block"&gt;
&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;elseif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;^/VirtualHostBase/https?/my.plone.site.com:(80\|443)/plone/VirtualHostRoot&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;backend&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;zope1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;my.plone.site.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;In short, the &lt;span class="caps"&gt;URL&lt;/span&gt; is processed from Apache (in my situation) to result
in the &lt;em&gt;req.url&lt;/em&gt;, and then Varnish needs to know what host anything
being cached relates to. Without it, hello 404&amp;nbsp;heaven.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="cache"></category><category term="plone"></category><category term="problem"></category><category term="purge"></category><category term="varnish"></category></entry><entry><title>Plone: Re-ordering Folder Contents</title><link href="http://davidjb.com/blog/2009/01/plone-re-ordering-folder-contents/" rel="alternate"></link><updated>2009-01-19T16:42:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-19:blog/2009/01/plone-re-ordering-folder-contents/</id><summary type="html">&lt;p&gt;Ahhh, a new work&amp;nbsp;week.&lt;/p&gt;
&lt;p&gt;The first perplexing puzzle for the week was a seemingly silly idea (it
still is) in Plone where it allows you to view the contents of a given
folder in batches of 20. Now, combine this concept (which is good) with
a concept of being able to re-order items within the folder (which is
good too), you end up with not being able to move items between&amp;nbsp;&amp;#8216;batches&amp;#8217;.&lt;/p&gt;
&lt;p&gt;Troublesome. There&amp;#8217;s nothing obvious that you can do aside from
disabling your browser&amp;#8217;s JavaScript and using the manual buttons. Nope:
not&amp;nbsp;feasible.&lt;/p&gt;
&lt;p&gt;Try making your folder view &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/folder_contents?show_all=true&lt;/span&gt;&lt;/tt&gt;. Batching
is disabled temporarily for the change to be&amp;nbsp;made.&lt;/p&gt;
&lt;p&gt;Apparently that&amp;#8217;s a legitimate fix for a significant problem. Not
terribly elegant, but I&amp;#8217;m struggling to think of a better&amp;nbsp;solution.&lt;/p&gt;
</summary><category term="batch"></category><category term="folder contents"></category><category term="forms"></category><category term="help"></category><category term="javascript"></category><category term="plone"></category></entry><entry><title>Plone How-To: XHTML Compliant Flash Insertion</title><link href="http://davidjb.com/blog/2009/01/plone-how-to-xhtml-compliant-flash-insertion/" rel="alternate"></link><updated>2009-01-13T16:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-13:blog/2009/01/plone-how-to-xhtml-compliant-flash-insertion/</id><summary type="html">&lt;p&gt;Wow, it seems easy doesn&amp;#8217;t it. Just add an object tag, params, and embed
and we&amp;#8217;re done, right? Well, sure, if we didn&amp;#8217;t want to adhere to &lt;span class="caps"&gt;W3C&lt;/span&gt;&amp;nbsp;standards.&lt;/p&gt;
&lt;p&gt;To do the right thing, we need something like&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;object&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;application/x-shockwave-flash&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;data=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie.swf&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;param&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie.swf&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;img&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;alt.jpg&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;alt=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/object&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Not much to it there, and this is available everywhere on the web. It
validates okay, and that&amp;#8217;s what we&amp;nbsp;need.&lt;/p&gt;
&lt;p&gt;However, if you follow normal procedure for sticking this in Plone
(disable filtering of the relevant &lt;strong&gt;object&lt;/strong&gt; and &lt;strong&gt;param&lt;/strong&gt; tags in &lt;span class="caps"&gt;HTML&lt;/span&gt;
Filtering (Plone Control Panel), then make a Page with this code),
you&amp;#8217;ll see it won&amp;#8217;t work in&amp;nbsp;&lt;span class="caps"&gt;IE&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Much hair-tearing and searching led me to find that the rendered Page is
missing the &lt;strong&gt;param&lt;/strong&gt; tag in the source &lt;span class="caps"&gt;XHTML&lt;/span&gt;. Huh?!?, you say - I just
disabled the filtering. Why&amp;#8217;s it not&amp;nbsp;there?!.&lt;/p&gt;
&lt;p&gt;Sure, you did. What noone told you is that you need to go into the &lt;span class="caps"&gt;ZMI&lt;/span&gt;
-&amp;gt; portal_transforms -&amp;gt; safe_html and tell Plone that the &lt;strong&gt;param&lt;/strong&gt;
tag is an &lt;em&gt;empty tag&lt;/em&gt; (like &amp;lt;img /&amp;gt;). In the list of &lt;strong&gt;valid_tags&lt;/strong&gt;,
set &lt;strong&gt;param&lt;/strong&gt; to be &lt;em&gt;0&lt;/em&gt;. Save this&amp;nbsp;page.&lt;/p&gt;
&lt;p&gt;Now try it again in &lt;span class="caps"&gt;IE&lt;/span&gt;. Looking at the source in both should show the
&lt;strong&gt;param&lt;/strong&gt; tag now, and your Flash should show up just fine once you
convince &lt;span class="caps"&gt;IE&lt;/span&gt; to&amp;nbsp;refresh.&lt;/p&gt;
</summary><category term="filtering"></category><category term="flash"></category><category term="parameters"></category><category term="plone"></category><category term="xhtml"></category></entry><entry><title>Plone: PloneFormGen Customisations</title><link href="http://davidjb.com/blog/2009/01/plone-ploneformgen-customisations/" rel="alternate"></link><updated>2009-01-12T16:39:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-12:blog/2009/01/plone-ploneformgen-customisations/</id><summary type="html">&lt;p&gt;Another fun problem for me to address today: upgrading to the latest
version of Plone (3.1.7 at time of writing) caused my custom
PloneFormGen (otherwise known as &lt;span class="caps"&gt;PFG&lt;/span&gt;) view to break in a nasty&amp;nbsp;way:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Module None, line 13, in fgvalidate_base
- &amp;lt;fscontrollervalidator at /site/fgvalidate_base used for /site/registration-form&amp;gt;
- Line 13
Module Products.PloneFormGen.content.form, line 519, in fgvalidate
Module plone.protect.authenticator, line 60, in check
Forbidden: Form authenticator is invalid.&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Obviously there&amp;#8217;s some new validation code for forms in Plone 3.1+.
Thanks to a very simple (and useful!) blog entry:
&lt;a class="reference external" href="http://www.die-welt.net/index.php/blog/239/Upgading_forms_in_Plone_3"&gt;http://www.die-welt.net/index.php/blog/239/Upgading_forms_in_Plone_3&lt;/a&gt;
, the solution is to&amp;nbsp;add:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;tal:replace=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;structure context/&amp;#64;&amp;#64;authenticator/authenticator&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;somewhere in the&amp;nbsp;form.&lt;/p&gt;
</summary><category term="authenticator"></category><category term="changes"></category><category term="forms"></category><category term="plone"></category></entry><entry><title>Rewrite Rules Made Easy</title><link href="http://davidjb.com/blog/2009/01/rewrite-rules-made-easy/" rel="alternate"></link><updated>2009-01-08T16:38:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-08:blog/2009/01/rewrite-rules-made-easy/</id><summary type="html">&lt;p&gt;I&amp;#8217;ve pretty much got a nice handle on Rewrite rules for Apache. Once
you&amp;#8217;ve seen a few of them, it&amp;#8217;s straight forward enough to replicate for
new Plone sites and so&amp;nbsp;forth.&lt;/p&gt;
&lt;p&gt;However, to make things even easier on my brain I&amp;#8217;ve found this:
&lt;a class="reference external" href="http://betabug.ch/zope/witch"&gt;http://betabug.ch/zope/witch&lt;/a&gt; , the Rewrite Rule Witch. Seems like the
rules it produces are what I&amp;#8217;d expect, which makes me ponder why, if I
know they&amp;#8217;re right, would I&amp;nbsp;bother.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reason:&lt;/strong&gt; easy confirmation and less chance of&amp;nbsp;typos.&lt;/p&gt;
</summary><category term="apache"></category><category term="rewrite"></category><category term="rules"></category></entry><entry><title>Plone: Python Eggs And Development</title><link href="http://davidjb.com/blog/2009/01/plone-python-eggs-and-development/" rel="alternate"></link><updated>2009-01-02T15:04:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-02:blog/2009/01/plone-python-eggs-and-development/</id><summary type="html">&lt;p&gt;Welcome to the new year! It&amp;#8217;s the start of another journey around the
sun and the beginning of work for me. Whilst I&amp;#8217;m the only one actually
working around here today, I thought I&amp;#8217;d take the chance and update with
some useful&amp;nbsp;info:&lt;/p&gt;
&lt;div class="section" id="troublesome-python-eggs"&gt;
&lt;h2&gt;Troublesome Python&amp;nbsp;eggs&lt;/h2&gt;
&lt;p&gt;Now, much to my amazement, when you&amp;#8217;re creating/compiling/whatever
Python eggs for Plone you need to actually specify the files you want
included in the build. I suppose it&amp;#8217;s fair enough, but thought it might
have actually done it for me. No such&amp;nbsp;luck!&lt;/p&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;SOURCES&lt;/span&gt;.txt&lt;/tt&gt; file in the egg-info folder needs to be updated
accordingly. A command like &lt;tt class="docutils literal"&gt;find ‘pwd` &lt;span class="pre"&gt;-name&lt;/span&gt; &lt;span class="pre"&gt;&amp;#8220;*.*&amp;#8221;&lt;/span&gt;&lt;/tt&gt; will do the trick
and list out the files in the directory (assuming you start from the
root of the egg). If there’s extra stuff in the folder, you&amp;#8217;ll probably
need to weed out the extraneous files (.pyc, git, svn, etc) before
building the egg&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
david&amp;#64;computer: python2.4 setup.py build
david&amp;#64;computer: python2.4 setup.py sdist bdist\_egg
&lt;/pre&gt;
&lt;p&gt;which gets our lovely setuptools to build (scramble?) the egg and place
the source and egg into the &lt;tt class="docutils literal"&gt;dist&lt;/tt&gt; folder. Providing the &lt;span class="caps"&gt;SOURCES&lt;/span&gt;.txt
file was correct, then you&amp;#8217;ll have the right files included. If you
don&amp;#8217;t, you&amp;#8217;ll be in for trouble when you try and include the egg under
&lt;span class="caps"&gt;ZCML&lt;/span&gt; etc because the files just don&amp;#8217;t come along for the&amp;nbsp;ride.&lt;/p&gt;
&lt;p&gt;Serve with sides of bacon and toast, place into your favourite PyPi
(cheese shop) and include with your buildout&amp;nbsp;config.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;Further&amp;nbsp;reading&lt;/h2&gt;
&lt;p&gt;If you&amp;#8217;re really bored, check out
&lt;a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools"&gt;http://peak.telecommunity.com/DevCenter/setuptools&lt;/a&gt; for some good
material on what Setuptools can do for&amp;nbsp;you.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="egg"></category><category term="linux"></category><category term="python"></category><category term="setuptools"></category></entry><entry><title>Plone: Buildout Won’t Install Products.OpenXml</title><link href="http://davidjb.com/blog/2008/12/plone-buildout-wont-install-products-openxml/" rel="alternate"></link><updated>2008-12-22T14:59:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-12-22:blog/2008/12/plone-buildout-wont-install-products-openxml/</id><summary type="html">&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;UPDATE&lt;/span&gt;:&lt;/strong&gt; Installation of Products.OpenXml appears to work happily
with buildout when I&amp;#8217;m using z3c.recipe.staticlxml to build lxml
separately from having to easy_install or install system-wide&amp;nbsp;packages.&lt;/p&gt;
&lt;p&gt;So it&amp;#8217;s almost Christmas time and I&amp;#8217;m still slaving away working. It&amp;#8217;s
all about&amp;nbsp;commitment.&lt;/p&gt;
&lt;p&gt;Today in my life I&amp;#8217;ve been trying to install the OpenXml product for
Plone (using buildout, of&amp;nbsp;course):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
david&amp;#64;computer:~/buildout/instance$ ./bin/buildout
Uninstalling zopepy.
Uninstalling instance.
Updating plone.
Updating zope2.
Updating productdistros.
Installing instance.
Getting distribution for 'Products.OpenXml'.
Got Products.OpenXml 1.0.1.
Getting distribution for 'openxmllib'.
Got openxmllib 1.0.3.
Getting distribution for 'lxml&amp;gt;=1.3.0,&amp;amp;amp;lt;2.0.0dev'.
Building lxml version 1.3.6
ERROR: /bin/sh: xslt-config: not found
** make sure the development packages of libxml2 and libxslt are installed
**ERROR: /bin/sh: xslt-config: not found
** make sure the development packages of libxml2 and libxslt are installed
**ERROR: /bin/sh: xslt-config: not found
&lt;/pre&gt;
&lt;p&gt;And then 50,000 errors follow, making this message hard to find. Either
way, the end result was that lxml wasn&amp;#8217;t able to&amp;nbsp;install.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Solution:&lt;/strong&gt; install libxslt and its dev counterpart plus the relevant
Python bindings on your system. In Ubuntu 8.10, that&amp;#8217;s libxslt1.1,
libxslt1-dev, and&amp;nbsp;python-libxslt1.&lt;/p&gt;
&lt;p&gt;All good&amp;nbsp;now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; Turns out Centos 5 (Red Hat) is has different package names.
Try &lt;tt class="docutils literal"&gt;yum install libxslt &lt;span class="pre"&gt;libxslt-devel&lt;/span&gt; &lt;span class="pre"&gt;libxslt-python&lt;/span&gt;&lt;/tt&gt; as root for&amp;nbsp;Centos.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Future response:&lt;/strong&gt; Just use &lt;a class="reference external" href="https://pypi.python.org/pypi/z3c.recipe.staticlxml"&gt;z3c.recipe.staticlxml&lt;/a&gt; and be done with it all.
No need for system level packages and it all just&amp;nbsp;works.&lt;/p&gt;
</summary><category term="buildout"></category><category term="libxml"></category><category term="openxml"></category><category term="plone"></category><category term="problem"></category><category term="products"></category><category term="xml"></category></entry><entry><title>Plone: Ploneboard Conversation Editing</title><link href="http://davidjb.com/blog/2008/11/plone-ploneboard-conversation-editing/" rel="alternate"></link><updated>2008-11-27T11:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-27:blog/2008/11/plone-ploneboard-conversation-editing/</id><summary type="html">&lt;p&gt;I&amp;#8217;m back with even more Plone goodness. Turns out Ploneboard has a
problem/issue (well, &lt;span class="caps"&gt;HAD&lt;/span&gt; an issue until I went and edited the code on
the &lt;span class="caps"&gt;SVN&lt;/span&gt; repository for the Collective of Plone. Read: will not have in
the next major release) with redirecting the user after they go and edit
a post. So essentially the user ends up getting to a page that says
&amp;#8216;Insufficient privileges&amp;#8217;, which is was extremely odd considering I do
everything as an&amp;nbsp;admin.&lt;/p&gt;
&lt;p&gt;The fix goes a little something like&amp;nbsp;this:&lt;/p&gt;
&lt;p&gt;In ploneboard_scripts/comment_redirect_to_conversation change it to&amp;nbsp;be:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="c"&gt;# &lt;span class="caps"&gt;XXX&lt;/span&gt; if we ever do batching, we need extra logic here.&lt;/span&gt;
&lt;span class="n"&gt;redirect_target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getConversation&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;anchor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;&lt;span class="caps"&gt;REQUEST&lt;/span&gt;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'&lt;span class="caps"&gt;RESPONSE&lt;/span&gt;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;redirect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;#&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;redirect_target&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;anchor&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Redirecting to &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;redirect_target&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;printed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Originally, the user was attempted to be sent to some other view that
they couldn&amp;#8217;t access. Now, they just get sent to the conversation. No
tricks, just the&amp;nbsp;conversation.&lt;/p&gt;
&lt;p&gt;More Plone on the&amp;nbsp;way!&lt;/p&gt;
</summary><category term="conversation"></category><category term="editing"></category><category term="plone"></category><category term="ploneboard"></category><category term="python"></category><category term="redirection"></category><category term="script"></category></entry><entry><title>Plone: Page Template Redirects</title><link href="http://davidjb.com/blog/2008/11/plone-page-template-redirects/" rel="alternate"></link><updated>2008-11-25T11:38:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-25:blog/2008/11/plone-page-template-redirects/</id><summary type="html">&lt;p&gt;Was wondering how to get a Plone page template to go to a page before the template actually loads. Now, actually getting Plone to not go to this template would be &lt;span class="caps"&gt;FAR&lt;/span&gt; better, but since we can’t actually modify the functionality of the Favourites content items in the content listings (not easily), I instead modify it’s default&amp;nbsp;view.&lt;/p&gt;
&lt;p&gt;Using&amp;nbsp;this:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;metal:js&lt;/span&gt; &lt;span class="na"&gt;fill-slot=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javascript_head_slot&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;script &lt;/span&gt;&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/javascript&amp;quot;&lt;/span&gt;
        &lt;span class="na"&gt;tal:content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;python:'location.href=\''+portal.absolute_url()+'/'+here.remoteUrl+'\';;'&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/metal:js&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;We see that the page reloads to the relevant location as soon as the
head JavaScript is done&amp;nbsp;loading.&lt;/p&gt;
&lt;p&gt;Easy, quick, useful, hack-y. More to come for&amp;nbsp;Plone.&lt;/p&gt;
</summary><category term="edit"></category><category term="hack"></category><category term="javascript"></category><category term="plone"></category><category term="redirect"></category><category term="template"></category></entry><entry><title>Plone: Relative ‘Recent Changes’ Portlets</title><link href="http://davidjb.com/blog/2008/11/plone-relative-recent-changes-portlets/" rel="alternate"></link><updated>2008-11-20T11:33:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-20:blog/2008/11/plone-relative-recent-changes-portlets/</id><summary type="html">&lt;p&gt;The problem I&amp;#8217;ve been faced with today on our Plone systems is that I
need to created a &amp;#8216;Recent Changes&amp;#8217; portlet that&amp;#8217;s relative to where the
user is on the&amp;nbsp;site.&lt;/p&gt;
&lt;p&gt;Now, the standard portlet doesn&amp;#8217;t do anything for me, so that&amp;#8217;s pretty
useless. I had a look at the standard code for the portlet too and it&amp;#8217;s
not really feasible to try and mess&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;tal:recentlist&lt;/span&gt; &lt;span class="na"&gt;define=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;view here/&amp;#64;&amp;#64;recent_view; results here/results;&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;However, using a (nasty?) workaround, if we put the classic Recent
Changes portlet into play, we can change that above code in the &lt;span class="caps"&gt;ZMI&lt;/span&gt; to
something&amp;nbsp;like:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;tal:recentlist&lt;/span&gt; &lt;span class="na"&gt;define=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;view here/&amp;#64;&amp;#64;recent_view;
                        theseResults python:container.portal_catalog(path='/'.join(context.getPhysicalPath()),sort_on='modified',sort_order='reverse');
                        results python:theseResults[:5];&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, we handle the problem by asking the portal catalog this time, and
only wanting stuff that&amp;#8217;s under our current physical path. By using the
&lt;em&gt;path&lt;/em&gt; parameter for the catalog, this works its magic for us. The
sub-selection of the array handles cutting back the&amp;nbsp;results.&lt;/p&gt;
&lt;p&gt;I noticed that the portlet also has links in its header and footer to
&amp;#8216;/recently_modified&amp;#8217;. This would, typically, just give us the
everything on the portal, but by making a new page template with a
slightly different name, copying the code in from &amp;#8216;recently_modified&amp;#8217;,
modifying its &lt;em&gt;results&lt;/em&gt; as above, and pointing the portlet&amp;#8217;s links at
this new page template under our current&amp;nbsp;page:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;'/relative_recently_modified'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;we end up with a nice, relative, recent changes full&amp;nbsp;listing.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s a brutal hack, but you could apply the same idea to an actual
product and make a real Plone 3 portlet out of&amp;nbsp;this.&lt;/p&gt;
</summary><category term="features"></category><category term="plone"></category><category term="portlets"></category><category term="product"></category><category term="python"></category></entry></feed>