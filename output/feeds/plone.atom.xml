<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>DavidJB.com</title><link href="http://davidjb.com/" rel="alternate"></link><link href="http://davidjb.com/feeds/plone.atom.xml" rel="self"></link><id>http://davidjb.com/</id><updated>2012-06-22T11:20:00+10:00</updated><entry><title>Members can't add folders to Plone via WebDAV (401 Unauthorized)</title><link href="http://davidjb.com/blog/2012/06/members-cant-add-folders-to-plone-via-webdav-401-unauthorized/" rel="alternate"></link><updated>2012-06-22T11:20:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2012-06-22:blog/2012/06/members-cant-add-folders-to-plone-via-webdav-401-unauthorized/</id><summary type="html">&lt;p&gt;This is a mirror of the (excellent) documentation at
&lt;a class="reference external" href="http://plone.org/documentation/error/unable-to-create-a-folder-through-webdav/"&gt;http://plone.org/documentation/error/unable-to-create-a-folder-through-webdav/&lt;/a&gt;,
but just a short editorial to also highlight that this is still very
applicable to Plone 4.x. Effectively, the symptom is that users will
report seeing a &amp;quot;401 Unauthorized&amp;quot; error when trying to create folders
within areas they have access to as an Owner. &amp;nbsp;Without further ado, the
documentation:&lt;/p&gt;
&lt;p&gt;Using a&amp;nbsp;WebDAV&amp;nbsp;client on a&amp;nbsp;Plone&amp;nbsp;site, site users are unable to create
newfolders&amp;nbsp;directories where they have Owner role.&lt;/p&gt;
&lt;div class="section" id="problem"&gt;
&lt;h2&gt;Problem:&lt;/h2&gt;
&lt;p&gt;The&amp;nbsp;WebDAV&amp;nbsp;&amp;quot;make folder&amp;quot; method, MKCOL, requires the &amp;quot;Add&amp;nbsp;Folders&amp;quot;
permission. This is not normally granted to Members or Owners on the
site.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="workaround"&gt;
&lt;h2&gt;Workaround:&lt;/h2&gt;
&lt;p&gt;In the Zope Management Interface, under the &amp;quot;Security&amp;quot; tab for
the&amp;nbsp;Plone&amp;nbsp;root, check the &amp;quot;Owners&amp;quot; box for the &amp;quot;Add&amp;nbsp;Folders&amp;quot; permission
setting.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="folder"></category><category term="http"></category><category term="plone"></category><category term="upload"></category><category term="webdav"></category></entry><entry><title>User IDs show as comment authors in Plone 4.x after migration from plone.app.discussion</title><link href="http://davidjb.com/blog/2011/11/user-ids-show-as-comment-authors-in-plone-4-x-after-migration-from-plone-app-discussion/" rel="alternate"></link><updated>2011-11-01T13:18:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-11-01:blog/2011/11/user-ids-show-as-comment-authors-in-plone-4-x-after-migration-from-plone-app-discussion/</id><summary type="html">&lt;p&gt;If you've migrated your site from earlier versions of Plone to the
latest ones in the 4.x series, or else have started using
plone.app.discussion earlier than that, you might have come across a
situation where comments on your site show user IDs as authors rather
than a user's full name. If you see this anywhere, chances are your
comment's migration didn't go according to plan, and that the Creator
information didn't get recorded correctly on the comment.&lt;/p&gt;
&lt;p&gt;I've just written this on the Collective developer docs:
&lt;a class="reference external" href="http://readthedocs.org/docs/collective-docs/en/latest/misc/upgrade.html#fixing-creator-details-on-existing-comments"&gt;http://readthedocs.org/docs/collective-docs/en/latest/misc/upgrade.html#fixing-creator-details-on-existing-comments&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The script there should help by stepping through all comments on your
site and fixing up the creator details as required. As mentioned in the
comments beneath the script, the mileage you get may vary depending on
the state of your comments. I found half my site's comments were fine
and half weren't. Some of mine had no author name, email, or user ID in
the relevant fields, and the script there checks for these (and the
actual existence of a user after looking up what's in the Creator
property), so that should be enough to sanity-check so it won't stomp
over correct comments.&lt;/p&gt;
&lt;p&gt;That said, if for some reason, you happened to have a user with ID
&lt;em&gt;david&lt;/em&gt; and full name of &lt;em&gt;Administrator&lt;/em&gt;, also had a user with the ID of
&lt;em&gt;Administrator&lt;/em&gt;, and had a comment which had an incorrect &lt;em&gt;Creator&lt;/em&gt; but
did have the three fields of &lt;em&gt;author_username&lt;/em&gt;, &lt;em&gt;author_name&lt;/em&gt;, and
&lt;em&gt;author_email&lt;/em&gt;, then it won't affect those comments and you might just
have to manually fix them up.&lt;/p&gt;
</summary><category term="collective"></category><category term="comments"></category><category term="discussion"></category><category term="docs"></category><category term="documentation"></category><category term="fix"></category><category term="plone"></category></entry><entry><title>Epic-sized (Really Large) Files with Plone 4.1.2</title><link href="http://davidjb.com/blog/2011/10/epic-sized-files-with-plone-4-1-2/" rel="alternate"></link><updated>2011-10-12T16:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-10-12:blog/2011/10/epic-sized-files-with-plone-4-1-2/</id><summary type="html">&lt;p&gt;In case you were ever curious, it's definitely possible to upload
epic-sized files within the Plone CMS. Browser support aside (Firefox
and your 2 GB limits, I'm looking you), I'd previously had issues with
being able to upload files larger than 4 GB, if memory serves correctly.
Previously, there was an issue with files causing out-of-memory issues,
and I'm fairly sure the errors I was getting were related to what was
fixed by &lt;a class="reference external" href="https://dev.plone.org/collective/changeset/244916/Products.CMFEditions/trunk/"&gt;this change&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For today's test, Google Chrome was able to upload a 26.3 GB
(28212643840 bytes) .tar file into Plone on my local machine:&lt;/p&gt;
&lt;img alt="|filename|images/2011-10-12-j9bibwU5DR.png" src="http://davidjb.com/static/images/2011-10-12-j9bibwU5DR.png" /&gt;
&lt;p&gt;It took a long while (even with my SSD) but it made it. No tracebacks or
memory leaks with Plone/Zope so kudos to the developers. It's
interesting to note that the file upload process seemingly took 2x
(double) the amount of disk space -- half was for a file in the /tmp/
directory, and I didn't end up tracking down the other one. Presumably
something like pre-allocated space for the final file, perhaps.&lt;/p&gt;
&lt;p&gt;Anyway, it works! Should you do this? Maybe, if you've got space and
don't mind hammering your CPU for your server during the upload
process.&amp;nbsp; I'll go for larger next time..only problem is my SSD is only
240GB so something like a 500GB file (eg 1TB needed at least) will just
have to wait.&lt;/p&gt;
</summary><category term="blob"></category><category term="file"></category><category term="large"></category><category term="plone"></category></entry><entry><title>AttributeError: 'NoneType' object has no attribute 'items': Can't upgrade Plone 3 to 4.x</title><link href="http://davidjb.com/blog/2011/09/attributeerror-nonetype-object-has-no-attribute-items-cant-upgrade-plone-3-to-4-x/" rel="alternate"></link><updated>2011-09-14T08:57:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-09-14:blog/2011/09/attributeerror-nonetype-object-has-no-attribute-items-cant-upgrade-plone-3-to-4-x/</id><summary type="html">&lt;p&gt;You may have seen an error like the one below when you've gone to
upgrade your Plone site to something in the Plone 4.x series from Plone
3:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2011-09-14 08:43:32 ERROR plone.app.upgrade Upgrade aborted. Error:
&lt;/span&gt;&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/Products.CMFPlone-4.1-py2.6.egg/Products/CMFPlone/MigrationTool.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;175&lt;/span&gt;, in &lt;span class="n"&gt;upgrade&lt;/span&gt;
    &lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'step'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;doStep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/Products.GenericSetup-1.6.3-py2.6.egg/Products/GenericSetup/upgrade.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;142&lt;/span&gt;, in &lt;span class="n"&gt;doStep&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tool&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/.buildout/eggs/plone.app.upgrade-1.1-py2.6.egg/plone/app/upgrade/v41/alphas.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;105&lt;/span&gt;, in &lt;span class="n"&gt;add_siteadmin_role&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;permission_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;roles&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;state&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;permission_roles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="gr"&gt;AttributeError&lt;/span&gt;: &lt;span class="n"&gt;'NoneType' object has no attribute 'items'&lt;/span&gt;
&lt;span class="x"&gt;2011-09-14 08:43:32 INFO plone.app.upgrade End of upgrade path, migration has finished
2011-09-14 08:43:32 ERROR plone.app.upgrade The upgrade path did NOT reach current version
2011-09-14 08:43:32 ERROR plone.app.upgrade Migration has failed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;If you've hit this, this means that you have a &lt;strong&gt;workflow state&lt;/strong&gt;
somewhere on your portal that has no specific permissions associated
with it (or otherwise has all permissions set as &lt;tt class="docutils literal"&gt;Acquire&lt;/tt&gt;). An easy way
around this is to go find that workflow state (look in custom
workflows!) in portal_workflow in the ZMI and temporarily change the
state or states so they have a permission.&lt;/p&gt;
&lt;p&gt;Then, go ahead and upgrade your portal to Plone 4.x and you can change
your permission back.&lt;/p&gt;
</summary><category term="4.1"></category><category term="plone"></category><category term="plone 4"></category><category term="traceback"></category><category term="upgrade"></category></entry><entry><title>Watch out: Python 2.4 ZEO client and Python 2.6 ZEO Server</title><link href="http://davidjb.com/blog/2011/07/watch-out-python-2-4-zeo-client-and-python-2-6-zeo-server/" rel="alternate"></link><updated>2011-07-11T16:23:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-07-11:blog/2011/07/watch-out-python-2-4-zeo-client-and-python-2-6-zeo-server/</id><summary type="html">&lt;p&gt;Today was interesting when an issue with saving content on a Plone 3.3.5
site got reported to me. The system was producing undecipherable error
messages about ZEO disconnections and database conflicts whenever
someone would try and create some content within Plone (folders,
particularly). Errors looked like:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Module ZEO.zrpc.connection, line 796, in wait. DisconnectedError&amp;quot; and &amp;quot;raise ReadConflictError().
ReadConflictError: database read conflict error&amp;quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and also:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;ERROR ZEO.zrpc (2515) can't decode message: '(K\x11K\x01U\tserialnos(]((U\x08\x00\x00\x00\x00\x00X\x...'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;-- essentially the issue described &lt;a class="reference external" href="https://mail.zope.org/pipermail/zodb-dev/2010-December/013893.html"&gt;here&lt;/a&gt;. My ZEO server was running
ZODB3 3.9.5 with Python 2.6, and my client running ZODB3 3.8.3 with
Python 2.4; almost everything worked.&lt;/p&gt;
&lt;p&gt;The long and the short of this issue appears to be, as the &lt;a class="reference external" href="http://pypi.python.org/pypi/ZODB3/3.9.5#compatibility"&gt;ZODB
documentation mentions&lt;/a&gt;, is that Python 2.4 servers work with 2.5+
clients, but not the other way around.&amp;nbsp; It's slightly misleading when
you read further and see that:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
ZODB ZEO clients from ZODB 3.2 on can talk to ZODB 3.9 servers. ZODB
ZEO Clients can talk to ZODB 3.8 and 3.9 ZEO servers.
&lt;/pre&gt;
&lt;p&gt;So, despite this seeming interoperability, dang - I can't use my
pre-existing ZEO server setup (based on the Plone 4 buildout for
versions, etc) which is currently in place and running.&lt;/p&gt;
&lt;p&gt;Thankfully, building being what it is, the solution for me was to simply
re-use that buildout for any Plone instances that are Python 2.4
clients.&amp;nbsp; This was as simple as re-cloning my git repository where I
keep the buildouts, firing up a brand new virtualenv for Python 2.4, and
moving the data across.&lt;/p&gt;
&lt;div class="section" id="one-more-thing"&gt;
&lt;h2&gt;One more thing...&lt;/h2&gt;
&lt;p&gt;There is one final thing worth mentioning, which I got awfully caught
out by.&amp;nbsp; I was finding that my ZEO processes, under this new
environment, just would not start - essentially, they would keep
respawning again and again until they stopped (triggered by some
'quick-respawn' safety mechanism, seemingly).&amp;nbsp; I thought this was some
issue concerning the fact I'd had my databases and files loaded against
newer ZEO versions, but this actually not.&amp;nbsp; This was a by-product of not
having my ZEO authentication database present - because there was no
file, presumably the processes kept crashing.&amp;nbsp; Sadly, no error message,
so hence this note.&amp;nbsp; Take care with this one.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="database"></category><category term="fs"></category><category term="plone"></category><category term="server"></category><category term="zeo"></category><category term="zope"></category></entry><entry><title>Migrating Plone 2.5 content straight onto Plone 4</title><link href="http://davidjb.com/blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/" rel="alternate"></link><updated>2011-01-14T15:07:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-01-14:blog/2011/01/migrating-plone-2-5-content-straight-onto-plone-4/</id><summary type="html">&lt;p&gt;It's my very last Plone 2.5 site and I'm very happy to see the back of
it.&amp;nbsp; Using the joy that is &lt;strong&gt;quintagroup.transmogrifier&lt;/strong&gt;, I was able
to, without much manual effort, migrate my content from a Plone 2.5 site
(constructed with instancemanager, of all things!) straight into a shiny
new Plone 4 site on Buildout.&lt;/p&gt;
&lt;p&gt;My only key need was to port the content and structure, and I was happy
to make big allowances for the sake of certain content and time.&amp;nbsp; So, my
thoughts here mightn't (probably won't!) suit everyone.My requirements
and allowances were these:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Content and structure only needed to be migrated.&amp;nbsp; Plone settings,
theme, user accounts, and everything else would either come from my
newly-created Plone 4 theme or be manually re-added.&lt;/li&gt;
&lt;li&gt;There were/are only a handful of users on the site.&lt;/li&gt;
&lt;li&gt;My Plone 2.5 site used a lot of custom content types (IronicWiki,
Wicked, Quills, PloneSoftwareCentre, Poi and more).&lt;ul&gt;
&lt;li&gt;I want to avoid ever going through migrating custom 'document'
types again.&amp;nbsp; Thankfully, the 'wiki'-based content types translate
easily to pure Plone documents.&lt;/li&gt;
&lt;li&gt;I was happy to jettison content in PSC, Poi, and Quills
(Weblogs).&amp;nbsp; This is a big issue but it wasn't worth my time since
the content was already 5+ years out of date and never used.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Default folder view selections don't appear to migrate.&amp;nbsp; I was able
to manually fix things up.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That out of the way, here's my process.&lt;/p&gt;
&lt;div class="section" id="for-plone-2-5"&gt;
&lt;h2&gt;For Plone 2.5&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Follow Step 1 of &lt;a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone2-3"&gt;QuintaGroup's instructions&lt;/a&gt; for migrating a
Plone 2.1 site to Plone 3.&amp;nbsp; I had a Plone 2.5 site and this worked
well.&amp;nbsp; Essentially, you want to use ZopeSkel (paster) to create
yourself a Plone 2.5 buildout and then checkout the relevant packages
(as per the instructions).&amp;nbsp; I created mine on my local Ubuntu machine
for my sanity as the old server the site was running on was ages out
of date.&lt;/li&gt;
&lt;li&gt;Figure out what you need to actually get the Plone 2.5 instance to
start up.&amp;nbsp; Now, my site had a huge amount of 3rd party packages that
caused me grief, and I had to add these into the buildout before the
instance would even start successfully.&amp;nbsp; In my case, it was a matter
of copying out the old product web links from my instancemanager
script and putting them in the &lt;strong&gt;productdistros&lt;/strong&gt; section of my Plone
2.5 buildout.&lt;ul&gt;
&lt;li&gt;Note that if your Plone instance was entirely manually managed,
then I'm guess you either on a hunt, or you could try copying the
files into your relevant directory.&lt;/li&gt;
&lt;li&gt;I also had a number of SVN-based products too so I employed my
fried, mr.developer, to check them out from the right SVN location
to the buildout src directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Once you've got your instance started (in the foreground), then you
should be able to access
&lt;a class="reference external" href="http://localhost:8080"&gt;http://localhost:8080&lt;/a&gt;/&amp;lt;your_site_name&amp;gt;/&amp;#64;&amp;#64;pipeline-config which is
the configuration for Transmogrifier.&lt;ol class="arabic"&gt;
&lt;li&gt;You can modify your configuration to suit you.&amp;nbsp; There's a little
learning involved here, but there are a good number of
Transmogrifier resources around.&lt;/li&gt;
&lt;li&gt;My configuration looks like this: &lt;a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-export.txt"&gt;transmogrifier-export.txt&lt;/a&gt;,
where I explicitly ignore a whole bunch of content types (read:
problematic for export/import), and export my content out to a
temporary directory&lt;/li&gt;
&lt;li&gt;Make changes to the export configuration and save the result.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Under the ZMI, head into portal_setup and click the 'Properties'
tab.&amp;nbsp; Change the active site configuration to be 'Transmogrifier' and
save this.&lt;/li&gt;
&lt;li&gt;Click the 'Export' tab at the top, and then export the 'Content' step
you see listed.&amp;nbsp; Watch your console output for progress and anything
that might be a problem.&lt;/li&gt;
&lt;li&gt;If successful, then you'll get presented with a generic setup .tar.gz
to download.&amp;nbsp; Save this somewhere useful; you'll need it shortly.&amp;nbsp; If
you were like me and exported to a directory, then you'll get an
'empty' .tar.gz download and your content will be in the directory
you specified.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="manually-modify-content-before-import"&gt;
&lt;h2&gt;Manually modify content before import&lt;/h2&gt;
&lt;p&gt;The reason I outputted to a directory so was I could hack a few things
around in my content. Transmogrifier is powerful, but a bit complicated.
I couldn't find out how to rename a field to another in the pipeline (eg
IronicWiki content use the &amp;quot;body&amp;quot; field rather than &amp;quot;text&amp;quot; as do normal
Document content), and likewise I couldn't successfully translate
content type names.&lt;/p&gt;
&lt;p&gt;So, find and replace it is. WickedDocs and IronicWiki are essentially
modern Plone Documents in disguise (as wiki markup is the same), so we
can just translate them over. In addition, I go ahead and rename
anything that's called &amp;quot;index_html&amp;quot; as this would otherwise be
displayed as the actual page on a given folder automagically (and not
through being selected in the Display drop down menu):&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; /path/to/our/temp/directory
grep -lr -e &lt;span class="s1"&gt;'WickedDoc'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/WickedDoc/Document/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'IronicWiki'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/name=\&amp;quot;body\&amp;quot;/name=\&amp;quot;text\&amp;quot;/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'IronicWiki'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/IronicWiki/Document/g'&lt;/span&gt;
find . -name index_html | xargs rename -v &lt;span class="s1"&gt;'s/index_html/main_page/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'index_html'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/index_html/main_page/g'&lt;/span&gt;
grep -lr -e &lt;span class="s1"&gt;'copy_of_main_page'&lt;/span&gt; * | xargs sed -i &lt;span class="s1"&gt;'s/copy_of_main_page/copy_of_index_html/g'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Once done with this, I copied the 'structure' directory (inside the temp
directory) into the .tar.gz you have from earlier, ready for upload to
the new site.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="for-plone-4"&gt;
&lt;h2&gt;For Plone 4&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Set up your Plone 4 like normal.&amp;nbsp; You should (are?) using Buildout,
so follow the instructions &lt;a class="reference external" href="http://projects.quintagroup.com/products/wiki/quintagroup.transmogrifier/plone3-4#Installationonbuildout"&gt;here&lt;/a&gt;, again from QuintaGroup, to
install the same quintagroup.transmogrifier product into your Plone 4
instance (eg just add it into your eggs and zcml for your instance).&lt;/li&gt;
&lt;li&gt;Create a Plone site if you haven't already.&lt;/li&gt;
&lt;li&gt;Like before, you can use the configuration page at
&lt;a class="reference external" href="http://localhost:8080"&gt;http://localhost:8080&lt;/a&gt;/&amp;lt;your_site_name&amp;gt;/&amp;#64;&amp;#64;pipeline-config , except
this time, configure the import options.&amp;nbsp; My config looks like this:
&lt;a class="reference external" href="http://davidjb.com/wp-content/uploads/2011/01/transmogrifier-import.txt"&gt;transmogrifier-import.txt&lt;/a&gt; - pretty much the same as the default.&lt;/li&gt;
&lt;li&gt;When you're ready, head into the ZMI and into 'portal_setup', this
time clicking on the 'Import' tab.&lt;/li&gt;
&lt;li&gt;Browse down to the very bottom of the page, and use the file field
(hint: Browse button) to locate your .tar.gz file you've prepared.&lt;/li&gt;
&lt;li&gt;Click 'Import uploaded tarball' and watch your console output for
progress.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="cleaning-up"&gt;
&lt;h2&gt;Cleaning up&lt;/h2&gt;
&lt;p&gt;This process wasn't without manual work, unfortunately.&amp;nbsp; But, it
certainly took care of 95% of the pain of copying content across!
Here's an overview of the manual work I had to do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Set default pages of folders.&amp;nbsp; This could have probably been carried
out by a script but I didn't write one because I only had a 20
folders to fix.&amp;nbsp; In Plone 2.5, I believe the default view was when
you set a page to be called 'index_html' (happy for corrections),
but AFAIK, there weren't options to set a certain page as the view.&lt;/li&gt;
&lt;li&gt;Set site settings.&amp;nbsp; This involved going through all control panels to
pick and manually port settings, but because of so many changes from
Plone 2.5 to 4, there's probably not an obvious migration path
anyway.&lt;/li&gt;
&lt;li&gt;Convert legacy portlets.&amp;nbsp; These settings do get copied across, but
you'll need to go to the 'Manage portlets' link on your main homepage
and click the 'Convert' button.&amp;nbsp; At time of writing (Plone 4.0.2)
this migration is actually broken (ticket logged already!) but you
can just as easily migrate manually -- look in the ZMI properties at
the site root for your portlet listings.&lt;/li&gt;
&lt;li&gt;Fix some workflow states.&amp;nbsp; My old site used a non-default workflow,
so workflow states needed correcting.&amp;nbsp; Thankfully, I was able to push
most content around just using the Types control panel.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And the rest of the actions I did were simply boilerplate for setting up
a Plone 4 site (theme installation, etc).&lt;/p&gt;
&lt;p&gt;This isn't the most straightforward path, but it did work and get my
content across.&amp;nbsp; Hopefully moving to Plone 5 and above won't be too much
of a problem.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="content"></category><category term="migration"></category><category term="plone"></category><category term="settings"></category><category term="site"></category></entry><entry><title>Checking Plone REQUEST for Ajax'd requests (XMLHttpRequest)</title><link href="http://davidjb.com/blog/2011/01/checking-plone-request-for-ajaxd-requests-xmlhttprequest/" rel="alternate"></link><updated>2011-01-07T10:54:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2011-01-07:blog/2011/01/checking-plone-request-for-ajaxd-requests-xmlhttprequest/</id><summary type="html">&lt;p&gt;Recently, I've needed a PloneFormGen (PFG) form of mine to have certain
fields excluded when the form is displayed in one of Plone 4's fancy
popups.&amp;nbsp; At the same time, I need this field to still persist within the
'standard' view of the form.&amp;nbsp; It's the request object to the rescue, and
all I've had to do is insert this TALES expression against the &lt;em&gt;Enabling
Expression&lt;/em&gt; for my PFG field:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'HTTP_X_REQUESTED_WITH'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;'XMLHttpRequest'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and the end result is that unless the request is one of XMLHttpRequest,
then we'll show the field.&lt;/p&gt;
&lt;p&gt;Shouldn't be any reason this same TALES couldn't be applied in a page
template against XHTML, or elsewhere.&lt;/p&gt;
</summary><category term="ajax"></category><category term="fields"></category><category term="form"></category><category term="http"></category><category term="pfg"></category><category term="plone"></category><category term="request"></category></entry><entry><title>Plone/Zope: Truncating a Data.fs back to a certain date/time</title><link href="http://davidjb.com/blog/2010/07/plonezope-truncating-a-data-fs-back-to-a-certain-datetime/" rel="alternate"></link><updated>2010-07-20T13:39:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-20:blog/2010/07/plonezope-truncating-a-data-fs-back-to-a-certain-datetime/</id><summary type="html">&lt;p&gt;Okay. So, anyone out here who's listening -- particularly those
overly-enthusiastic users -- don't try to recursively &lt;tt class="docutils literal"&gt;wget&lt;/tt&gt; your
Plone site (or other CMS, for that matter) whilst you're logged in with
an account that can make edits. It &lt;strong&gt;will&lt;/strong&gt; lead to a very bad situation
where your site administrator and technical team need to step in and fix
your mistakes. For the uninitiated, a loose recursive wget (when logged
in with some degree of Edit rights) will hit every link that's on your
pages, and I mean in the (X)HTML &lt;em&gt;source&lt;/em&gt;. For a Plone site, this means
hitting every &amp;quot;Edit&amp;quot; link, every &amp;quot;Revert to this version&amp;quot; link, and
every other link that might be dangerous when clicked randomly. Oh, and
if the account you've got has admin rights, well, it's not getting any
better and requires the Data.fs to be undone back to before it happened.
Here's how to do that easily.&lt;/p&gt;
&lt;p&gt;So enough of the backstory. How to fix a suitably bollocks'd Data.fs?
Well, the easy answer is to recover from a backup. Of course you've got
plenty of those, right? No? Oh dear. Never to stress, you can use your
existing Data.fs file and strip away any number of transactions, to
bring your file back to any date, time, or transaction you'd like.&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Realise you'll be losing everything from now back until then, so take
a copy of data off your Plone site, back up your Data.fs (twice, if
need be), and make it crystal clear to your users changes are going
bye-by.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Figure out when you want to go back to.&amp;nbsp; If you want a particular
transaction, consider checking your Zope Undo log to locate the
specific date/time of a given transaction.&amp;nbsp; Otherwise, figure out the
date and time.&amp;nbsp; Then, convert that date and time to UTC as that what
date/times are in the Data.fs.&amp;nbsp; In Queensland, Australia, we're +10
hours.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Shut down ZEO if it's still running.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Edit &lt;tt class="docutils literal"&gt;parts/zope2/lib/python/ZODB/FileStorage/fsdump.py&lt;/tt&gt;, and add
this to allow you to run this file:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Get your PYTHONPATH sorted for running this file.&amp;nbsp; Consider
&lt;tt class="docutils literal"&gt;./bin/instance1&lt;/tt&gt; shell, if you've got a Plone instance, or using
zopepy.&amp;nbsp; Manually update it if necessary.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Run the the &lt;tt class="docutils literal"&gt;fsdump.py&lt;/tt&gt; script thusly, substituting the date for
yours (or a date/time):&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
./bin/python parts/zope2/lib/python/ZODB/FileStorage/fsdump.py var/filestorage/Data.fs | grep 2010-07-12
&lt;/pre&gt;
&lt;p&gt;This will tell you exactly the offset you need to truncate the
Data.fs file.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Take that offset amount and truncate your Data.fs file, inserting the
number after &amp;quot;seek=&amp;quot;:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;var/filestorage/Data.fs &lt;span class="nv"&gt;seek&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;199340531 &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1 &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Restart your ZEO service and re-connect to it from your Plone/Zope
instance.&amp;nbsp; Your database should be back to the date and time you
specified.&amp;nbsp; If it's close, but not quite right, check your times and
that they're UTC.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Get some backups and politely ask your users to think twice about any
such consequences next time.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And we're done!&lt;/p&gt;
</summary><category term="data.fs"></category><category term="database"></category><category term="date"></category><category term="fix"></category><category term="linux"></category><category term="plone"></category><category term="python"></category><category term="time"></category><category term="truncate"></category><category term="zeo"></category><category term="zodb"></category><category term="zodb3"></category><category term="zope"></category></entry><entry><title>Plone: running Plone without copies of blobs</title><link href="http://davidjb.com/blog/2010/07/plone-running-plone-without-copies-of-blobs/" rel="alternate"></link><updated>2010-07-13T16:30:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-13:blog/2010/07/plone-running-plone-without-copies-of-blobs/</id><summary type="html">&lt;p&gt;Having a bad day? Just bombed your only copies of some files that you'd
been storing as blobs together with your Plone database? Maybe you had
the blobs stored incorrectly on your Zeo client, rather than the server,
and then in a hasty effort to free some space (due to an on-going issue
with blobs eating HDD space), deleted them. Whoops..they're gone and
their references are still in your Plone database. Or, in a less
disastrous situation, maybe you just want to be able to run your Plone
database without needing lost blobs? Read on.The suggestion, as
mentioned elsewhere on the Interwebs, is to catch the exception that
gets raised on accessing relevant blobs. The two locations to catch (as
of plone.app.blob 1.0b18) are:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;plone/app/blob/mixins.py&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;getScale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot; get scale by name or original &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getUnwrapped&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;handler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IImageScaleHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;handler&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;handler&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getScale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;plone/app/blob/field.py&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot; return the size of the blob &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;blob&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;openBlob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fstat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fileno&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;st_size&lt;/span&gt;
        &lt;span class="n"&gt;blob&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;If you put these try/catch statements in, you'll stop your site from
dying when accessing the View and Edit pages for your content. This
means you can safely replace lost blobs with files again, or otherwise
just use your site without the files, like if your client sends you only
the database to save on size. Happy days.&lt;/p&gt;
</summary><category term="blob"></category><category term="blobs"></category><category term="files"></category><category term="patch"></category><category term="plone"></category><category term="problem"></category><category term="python"></category></entry><entry><title>Plone: Overrides.zcml gets auto-included with z3c.autoinclude</title><link href="http://davidjb.com/blog/2010/07/plone-overrides-zcml-gets-auto-included-with-z3c-autoinclude/" rel="alternate"></link><updated>2010-07-13T15:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-13:blog/2010/07/plone-overrides-zcml-gets-auto-included-with-z3c-autoinclude/</id><summary type="html">&lt;p&gt;Unsurprisingly, specifying a z3c.autoinclude entry point in your Plone
product egg means your ZCML gets automatically included. That's great
because it means you don't have to specify your product under the ZCML
section of your instance in buildout. One thing that isn't so obvious
(it's not mentioned that I can see on &lt;a class="reference external" href="http://plone.org/products/plone/roadmap/247"&gt;plone.org&lt;/a&gt;) is that if your
package is marked for ZCML autoinclude, then Plone will automatically
load an &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; file in your product.&lt;/p&gt;
&lt;p&gt;Nothing hits you like a slippery wet fish in the face more than hitting
this issue and having it obfuscated through a lot of different layers.
The first symptom was that my content icons weren't appearing within my
Plone site. Only some of them though -- the ones in folder listings and
the navigation portlet. I thought nothing much of it initially, just
thinking the setting for displaying content icons had been changed in
the Plone control panel.&lt;/p&gt;
&lt;p&gt;I started digging into this issue a bit more because it was annoying me.
That, and changing the control panel's options weren't working. Hacking
a few bits into the folder_listing.pt view showed me that icons were
there, just not outputting any HTML. Weird. Outputting the actual type
of the icon brain itself showed me:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
myorg.theme.layout.icons.CatalogBrainContentIcon
&lt;/pre&gt;
&lt;p&gt;and didn't think much of it. So what, a class is being generated at run
time for my theme? It wouldn't surprise me -- Python can do some pretty
cool things and that's probably just one of them.&lt;/p&gt;
&lt;p&gt;Taking the &lt;tt class="docutils literal"&gt;CatalogBrainContentIcon&lt;/tt&gt; string and &lt;tt class="docutils literal"&gt;grep&lt;/tt&gt;'ing for it
showed me otherwise. My theme package had this class, amongst others,
hanging around in it's &lt;tt class="docutils literal"&gt;layout&lt;/tt&gt; module. Moving the module and
restarting Zope showed me that the ZCML was being loaded.&lt;/p&gt;
&lt;p&gt;But how/why? It was definitely excluded from my main &lt;tt class="docutils literal"&gt;configure.zcml&lt;/tt&gt;
files..but not excluded entirely though. Little did I realise that I had
an &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; file floating around. Commented out from
&lt;tt class="docutils literal"&gt;configure.zcml&lt;/tt&gt;, but still there all the same. Turns out adding the
z3c.autoinclude entry point to the theme product makes Plone
auto-include all &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; (unless told otherwise).
&lt;strong&gt;*fish-smack to face*&lt;/strong&gt; This behaviour was modified slightly in Plone
4.0a5, so that you can make your &lt;tt class="docutils literal"&gt;overrides.zcml&lt;/tt&gt; be excluded, but
that doesn't mean anything about Plone 3.3.5.&lt;/p&gt;
&lt;p&gt;So, watch out with seemingly innocuous ZCML files floating around. They
can still be brought into play.&lt;/p&gt;
</summary><category term="auto"></category><category term="icons"></category><category term="include"></category><category term="plone"></category><category term="plone 3"></category><category term="problem"></category><category term="theme"></category><category term="z3c"></category><category term="zcml"></category><category term="zope"></category></entry><entry><title>Plone 4: Local Zeo blobs conflict with Plone instance</title><link href="http://davidjb.com/blog/2010/07/plone-4-local-zeo-blobs-conflict-with-plone-instance/" rel="alternate"></link><updated>2010-07-06T16:04:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-07-06:blog/2010/07/plone-4-local-zeo-blobs-conflict-with-plone-instance/</id><summary type="html">&lt;p&gt;As the title suggests, there's a conflict between a Zeo database
instance being run together with a Plone 4/Zope instance, and them
trying to share the same blob storage folder.&amp;nbsp; But, this only happens if
you misunderstand or incorrectly set the option of&amp;nbsp; &lt;em&gt;shared-blob = off&lt;/em&gt;,
and &lt;em&gt;blob-storage&lt;/em&gt; to be the same location as for Zeo in your buildout.
If that previous set of (seemingly jumbled) thoughts doesn't make any
sense to you, then move along, nothing to see here.&lt;/p&gt;
&lt;p&gt;By default, at the time of writing, blob support within Zeo runs with
the &lt;em&gt;bushy&lt;/em&gt;layout, and creates this format by default when starting up
for the first time. Plone 4, however, when trying to stream blobs from
your Zeo database, uses a customised &lt;em&gt;zeocache&lt;/em&gt; blob layout. See where
I'm going with this? You try and inadvertently use these aspects
together and you've got a conflict.&lt;/p&gt;
&lt;p&gt;If you're having this problem, then you'll get weird errors concerning
the &lt;em&gt;layout&lt;/em&gt; of your blobs. Starting the Zope instance before the Zeo
server results in Zope setting the &lt;strong&gt;.layout&lt;/strong&gt; file for the blob storage
to &lt;em&gt;zeocache&lt;/em&gt;. Once your Zope instance errors out and you realise that
your Zeo instance isn't running, you'll inevitably try and start Zeo up.
When you do, you get an error about the layout type not existing:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;/home/david/buildout/parts/zeo/bin/runzeo
&lt;/span&gt;&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  &lt;span class="c"&gt;...&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/ZODB3-3.9.5-py2.6-linux-i686.egg/ZODB/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;714&lt;/span&gt;, in &lt;span class="n"&gt;__init__&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_blob_init&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_directory&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/ZODB3-3.9.5-py2.6-linux-i686.egg/ZODB/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;600&lt;/span&gt;, in &lt;span class="n"&gt;_blob_init&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fshelper&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FilesystemHelper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;blob_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/ZODB3-3.9.5-py2.6-linux-i686.egg/ZODB/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;339&lt;/span&gt;, in &lt;span class="n"&gt;__init__&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;layout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;LAYOUTS&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;layout_name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="gr"&gt;KeyError&lt;/span&gt;: &lt;span class="n"&gt;'zeocache'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Now, if you try to fix this by dumping your now-existing blob storage
folder (a method mentioned to work elsewhere on the web) and starting
your Zeo server first, you'll still get problems. The blob storage gets
created correctly with the 'bushy' layout by Zeo, but trying to start
the Zope instance fails, because Zeo's created its storage accordingly
in the same spot. This is part of the error:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;  &lt;span class="c"&gt;...&lt;/span&gt;
  File &lt;span class="nb"&gt;&amp;quot;/home/david/buildout/eggs/ZODB3-3.9.5-py2.6-linux-i686.egg/ZODB/blob.py&amp;quot;&lt;/span&gt;, line &lt;span class="m"&gt;362&lt;/span&gt;, in &lt;span class="n"&gt;create&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;layout_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;base_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;layout&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="gr"&gt;ValueError&lt;/span&gt;: &lt;span class="n"&gt;Directory layout `zeocache` selected for blob directory /home/david/buildout/var/blobstorage/, but marker found for layout `bushy`&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;The two ways of solving this are to:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Change the &lt;em&gt;shared-blob&lt;/em&gt; option to be &lt;strong&gt;on&lt;/strong&gt;. Both Zeo and Zope will
exist in harmony again, both using the &lt;em&gt;bushy&lt;/em&gt; layout.&lt;/li&gt;
&lt;li&gt;Changing the &lt;em&gt;blob-storage&lt;/em&gt; location for either the Zeo server or the
Zope instance. This will result in two separate folders and likely
duplicate files and HDD wastage, but hey, it'll work, right? This is
probably a useful option for testing.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The &lt;em&gt;zeocache&lt;/em&gt; layout is new with Plone 4 (aka, I haven't seen it before
so it probably is), so watch out for this when upgrading.&lt;/p&gt;
&lt;p&gt;Stay tuned for more in this series of Plone 4 upgrade notes.&lt;/p&gt;
</summary><category term="blob"></category><category term="conflict"></category><category term="database"></category><category term="db"></category><category term="files"></category><category term="plone"></category><category term="plone 4"></category><category term="problem"></category><category term="upgrade"></category><category term="zeo"></category></entry><entry><title>Plone: SiteManager leftovers; not the good kind</title><link href="http://davidjb.com/blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/" rel="alternate"></link><updated>2010-06-28T14:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-28:blog/2010/06/plone-sitemanager-leftovers-not-the-good-kind/</id><summary type="html">&lt;div class="note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;&lt;strong&gt;Update:&lt;/strong&gt; You should check out &lt;a class="reference external" href="http://pypi.python.org/pypi/wildcard.fixpersistentutilities"&gt;wildcard.fixpersistentutilities&lt;/a&gt;
- it's a fantastic solution to problems like this. Many thanks to
Nathan Van Gheem, the author of the add on. Check out the link and
see how to install it (temporarily) on your Plone instance that
needs its site manager cleaned up.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Leftovers are typically useful when they're in your fridge at home. They
mean you don't have to mess around making lunch for the next day for
work, and can just grab them, and walk right out the door. Now,
leftovers in the zope.component SiteManager aren't so nice, especially
when some Plone products fail to remove what they've registered. The
consequences of this are that you've got references left which will
break things when you uninstall/remove the physical eggs/files. These
leftovers would be ones would be mutated food that comes to kill you
after you've thrown it in the bin, assuming we follow the same analogy.
But how to fix them?&lt;/p&gt;
&lt;p&gt;Here's the error message you might be faced with when trying to install
or uninstall products -- something that stops you might in your tracks:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2010-06-22T10:38:48 ERROR Zope.SiteErrorLog https://mysite.com/portal_quickinstaller/uninstallProducts
Traceback (innermost last):
Module ZPublisher.Publish, line 125, in publish
Module Zope2.App.startup, line 238, in commit
Module transaction._manager, line 96, in commit
Module transaction._transaction, line 395, in commit
Module transaction._transaction, line 495, in _commitResources
Module ZODB.Connection, line 510, in commit
Module ZODB.Connection, line 555, in _commit
Module ZODB.Connection, line 582, in _store_objects
Module ZODB.serialize, line 407, in serialize
Module ZODB.serialize, line 416, in _dump
PicklingError: Can't pickle &amp;lt;class 'p4a.plonevideoembed.interfaces.IVideoLinkSupport'&amp;gt;: import of module p4a.plonevideoembed.interfaces failed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Unsurprisingly, it's similar to something I encountered before. Way back
when, I hit the same issue with &lt;a class="reference external" href="http://davidjb.com/blog/2009/04/plone-issues-with-products/"&gt;ZipFileTransport&lt;/a&gt;, and my fix for it
is just as relevant today as it was then. Start up a zopepy session (or
ipython) that still has the relevant classes in the system path, and run
this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;p4a.plonevideoembed.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IVideoLinkSupport&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;intclass&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;p4a.video.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IVideoSupport&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;intclass2&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.app.component.hooks&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;setSite&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.component&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;
&lt;span class="n"&gt;setSite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;portal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;#Even though unregister happened, it probably said it worked but left crap around.&lt;/span&gt;
&lt;span class="c"&gt;#Let's clean it up.&lt;/span&gt;

&lt;span class="c"&gt;#This intclass variables might not be right or perfectly complete. It's going to be the key present below,&lt;/span&gt;
&lt;span class="c"&gt;#so you can always find the right InterfaceClass manually and set it accordingly.&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;#From here, search for a term to see if it's gone&lt;/span&gt;
&lt;span class="c"&gt;#Each should return -1. If not, you've done something wrong!&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'p4a'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;transaction&lt;/span&gt;
&lt;span class="n"&gt;transaction&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Shut down your existing Plone/Zope instance and restart it. You should
now be able to install or remove products accordingly again -- and also
get rid of those old packages' physical files you don't need.&lt;/p&gt;
</summary><category term="egg"></category><category term="error"></category><category term="install"></category><category term="plone"></category><category term="problem"></category><category term="site"></category><category term="update"></category><category term="zope"></category></entry><entry><title>Plone, Dexterity, and Incorrect Widgets</title><link href="http://davidjb.com/blog/2010/06/plone-dexterity-and-incorrect-widgets/" rel="alternate"></link><updated>2010-06-21T15:09:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-21:blog/2010/06/plone-dexterity-and-incorrect-widgets/</id><summary type="html">&lt;p&gt;A nice 'gotcha' is the distinction between Zope's schema.Date and
schema.Datetime. The difference is obvious and straightforward when the
two terms are laid out side-by-side: one is for dates only and the other
adds a time component. Where things fell down for me in my usage of
these fields with a Dexterity-based content type in Plone is the human
component. When these fields are mashed in together within a lot of
other text/Python/names, it's easy to miss those 4 little letters of
'time'. This lead me trying to use a DatetimeFieldWidget when I really
could only use a DateFieldWidget. &lt;strong&gt;Wrong widget for the wrong type =
unpredictable.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When it's all laid out like that, things are clear and simple. When the
small typo has been made, however, things are far less forgiving and
informative. Thankfully, the typo wasn't my fault, but was caused by a
ZopeSkel template for Dexterity (&lt;a class="reference external" href="http://pypi.python.org/pypi/zopeskel.dexterity"&gt;zopeskel.dexterity&lt;/a&gt;) so I'm not
kicking myself over it. Essentially, the error message (for those of you
possibly experiencing something similar) is like this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2010-06-18 16:32:03 ERROR Zope.SiteErrorLog 1276842723.120.730292360531 http://localhost:8080/test/kss_z3cform_inline_validation/validate_input
    Traceback (innermost last):
    Module ZPublisher.Publish, line 119, in publish
    Module ZPublisher.mapply, line 88, in mapply
    Module ZPublisher.Publish, line 42, in call_object
    Module &amp;lt;wrapper&amp;gt;, line 5, in wrapper
    Module kss.core.actionwrapper, line 238, in apply
    Module plone.app.z3cform.kss.validation, line 48, in validate_input
    Module z3c.form.group, line 92, in extractData
    Module z3c.form.form, line 143, in extractData
    Module z3c.form.field, line 302, in extract
    Module z3c.form.converter, line 164, in toFieldValue
    Module zope.i18n.format, line 79, in parse
    Module sre, line 129, in match
    TypeError: expected string or buffer&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And the end result of this is that you can't validate fields in your
Dexterity content Add form (eg the above traceback is echoed whenever
you click in/out of a field), nor can you actually save your content.
Unfortunately, even if you were to go hunting through the traceback,
you'd probably end up like me and find that the code is trying to
validate a completely different field than the problematic one. No help
whatsoever.&lt;/p&gt;
&lt;p&gt;After going through each of the different fields I had on my content
type, I figured out the cause. If you're hitting a similar issue, check
your widgets. If you're using &lt;a class="reference external" href="http://pypi.python.org/pypi/zopeskel.dexterity"&gt;zopeskel.dexterity&lt;/a&gt;, don't worry though.
I checked in a fix for this issue this morning, correcting the widget to
be used. You'll need to use the latest version from the Plone Collective
SVN to make the templates work correctly.&lt;/p&gt;
&lt;p&gt;On the other hand, you could look at &lt;a class="reference external" href="http://pypi.python.org/pypi/collective.z3cform.datepicker"&gt;collective.z3cform.datepicker&lt;/a&gt;,
which implements a much more user-friendly Date and DateTime widgets
(using jQuery UI etc).&lt;/p&gt;
</summary><category term="content type"></category><category term="datetime"></category><category term="dexterity"></category><category term="fields"></category><category term="form"></category><category term="plone"></category><category term="problem"></category><category term="product"></category><category term="zope"></category></entry><entry><title>Plone/Zope: Using LDAPUserFolder with posixGroups</title><link href="http://davidjb.com/blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/" rel="alternate"></link><updated>2010-06-03T16:03:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-06-03:blog/2010/06/plonezope-using-ldapuserfolder-with-posixgroups/</id><summary type="html">&lt;p&gt;Due to various reasons, the Products.LDAPUserFolder package available
for Plone and Zope doesn't support POSIX groups.&amp;nbsp; The 'official' (ish)
reason for this is because of the fact that these groups don't store
full distinguished names (DNs) for members.&amp;nbsp; It makes some degree of
sense, because a user ID like 'david.test' isn't strictly unique.&amp;nbsp; On
the other hand, these types of groups are quite common in LDAP
implementations; not supporting them without giving it at least half a
shot to find the user seems a bit strange.&lt;/p&gt;
&lt;p&gt;Here's where a quick patch steps in. Thanks to Weblion's infinity of
Plone resources (specifically, their article on &lt;a class="reference external" href="https://weblion.psu.edu/trac/weblion/wiki/LDAPWithPlone"&gt;Plone LDAP&lt;/a&gt;), I
patched part of my Products.LDAPUserFolder.&lt;/p&gt;
&lt;p&gt;Now, what they've got wasn't infallible. Whilst the patch they have on
their site took care of enumerating the groups, and the groups a user is
in, it didn't ensure looking a group showed its users. Whether this was
a change in LDAPUserFolder recently (since version 2.12) or not, I'm not
sure.&lt;/p&gt;
&lt;p&gt;In any case, the reason for the issue is that deep down, the code
attempts to query group members by DN. Obviously our POSIX groups don't
have full DNs, so with a quick bit of string manipulation (read:
hacking), I assume that the &lt;em&gt;user base&lt;/em&gt; you specify will have your user.
&lt;strong&gt;Note:&lt;/strong&gt; this won't do one iota if your user isn't at the user base,
but if it is -- like all the LDAPs I've used -- you're golden. Here's
the patch for Products.LDAPUserFolder 2.17.&lt;/p&gt;
&lt;pre class="code diff literal-block"&gt;
&lt;span class="gh"&gt;diff --git a/Products/LDAPUserFolder/LDAPUserFolder.py b/Products/LDAPUserFolder/LDAPUserFolder.py
index 0e61396..a235e74 100644
&lt;/span&gt;&lt;span class="gd"&gt;--- a/Products/LDAPUserFolder/LDAPUserFolder.py
&lt;/span&gt;&lt;span class="gi"&gt;+++ b/Products/LDAPUserFolder/LDAPUserFolder.py
&lt;/span&gt;&lt;span class="gu"&gt;&amp;#64;&amp;#64; -950,6 +950,7 &amp;#64;&amp;#64; class LDAPUserFolder(BasicUserFolder):
&lt;/span&gt;
for dn in all_dns.keys():
try:
&lt;span class="gi"&gt;+                if 'uid=' not in dn: dn = ('uid='+dn+','+self.users_base)
&lt;/span&gt;user = self.getUserByDN(dn)
except:
user = None
&lt;span class="gu"&gt;&amp;#64;&amp;#64; -1216,6 +1217,8 &amp;#64;&amp;#64; class LDAPUserFolder(BasicUserFolder):
&lt;/span&gt;f_template = '(&amp;amp;amp;amp;(objectClass=%s)(%s=%s))'
group_filter = '(|'

&lt;span class="gi"&gt;+                dn = dn.replace('uid=','').replace(','+self.users_base,'')
+
&lt;/span&gt;for g_name, m_name in GROUP_MEMBER_MAP.items():
fltr = filter_format(f_template, (g_name, m_name, dn))
group_filter += fltr
&lt;span class="gh"&gt;diff --git a/Products/LDAPUserFolder/utils.py b/Products/LDAPUserFolder/utils.py
index 4a88cd7..26b73bc 100644
&lt;/span&gt;&lt;span class="gd"&gt;--- a/Products/LDAPUserFolder/utils.py
&lt;/span&gt;&lt;span class="gi"&gt;+++ b/Products/LDAPUserFolder/utils.py
&lt;/span&gt;&lt;span class="gu"&gt;&amp;#64;&amp;#64; -48,6 +48,7 &amp;#64;&amp;#64; GROUP_MEMBER_MAP = { 'groupOfUniqueNames' : 'uniqueMember'
&lt;/span&gt;, 'accessGroup' : 'member'
, 'group' : 'member'
, 'univentionGroup' : 'uniqueMember'
&lt;span class="gi"&gt;+                  , 'posixGroup' : 'memberUid'
&lt;/span&gt;}

VALID_GROUP_ATTRIBUTES = Set(list(GROUP_MEMBER_MAP.values()) +
&lt;/pre&gt;
</summary><category term="groups"></category><category term="ldap"></category><category term="ldapuserfolder"></category><category term="openldap"></category><category term="patch"></category><category term="plone"></category><category term="python"></category><category term="zope"></category></entry><entry><title>Virtualenv, Python 2.4, Plone 3.x and Lucid Lynx (Ubuntu 10.04)</title><link href="http://davidjb.com/blog/2010/05/virtualenv-python-2-4-plone-3-x-and-lucid-lynx-ubuntu-10-04/" rel="alternate"></link><updated>2010-05-12T14:47:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-05-12:blog/2010/05/virtualenv-python-2-4-plone-3-x-and-lucid-lynx-ubuntu-10-04/</id><summary type="html">&lt;p&gt;These titles of my posts just keep getting longer and longer.&amp;nbsp; For those
of you paying close attention (I know who you are), this is the next in
my series of getting the above-mentioned tools working together.
Previously, it was Centos 5.x, Jaunty (9.04), Karmic (9.10) and now
Lucid (10.04).&amp;nbsp; Only subtly different, each of this distributions has
pretty much called for its own post on the matter of getting a working
Plone 3.x / Python 2.4 virtualenv installation going.&amp;nbsp; So, here goes
this time around.&lt;/p&gt;
&lt;div class="section" id="install-python-2-4-first"&gt;
&lt;h2&gt;Install Python 2.4 first&lt;/h2&gt;
&lt;p&gt;If you've not done so already, you need to install Python 2.4.&amp;nbsp; Lucid
now no longer comes with the packages for Python 2.4 (at all; so not
even python2.4, python2.4-dev) in its repositories, so you need to wind
back the clock and get the Karmic packages.&amp;nbsp; Don't worry, everything
seems to work okay.&amp;nbsp; &lt;a class="reference external" href="http://davidjb.com/blog/2010/05/installing-python-2-4-on-ubuntu-10-04-lucid-lynx"&gt;Read my post about this&lt;/a&gt; and come back here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="prerequisites"&gt;
&lt;h2&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Ready to roll? You might want to make sure that you've got python2.4
available (eg run &lt;tt class="docutils literal"&gt;python2.4&lt;/tt&gt;) and that you can &lt;tt class="docutils literal"&gt;import&amp;nbsp; profile&lt;/tt&gt;.
If not, go back to the other post and read carefully (or complain loudly
:)). You should also check the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;Got easy_install-2.4?&amp;nbsp; Try and type it in your terminal.&amp;nbsp; No good?
Then do this:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://pypi.python.org/packages/2.4/s/setuptools/setuptools-0.6c11-py2.4.egg
sudo sh setuptools-0.6c11-py2.4.egg
rm -f setuptools-0.6c11-py2.4.egg
sudo easy_install-2.4 -U setuptools
sudo easy_install-2.4 virtualenv
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;If you've got the python-virtualenv Ubuntu package installed.&amp;nbsp; If you
do, have a serious think about uninstalling it and getting the one
for Python2.4 via easy_install-2.4. Your warranty ends here if you
continue with the Ubunutu-installed virtualenv.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;If you need to install system-level packages. Even if you've run this
before on an old Karmic (or older install), do it again as you've
likely lost packages in the upgrade.&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install libtk-img-dev libfreeimage-dev libjpeg62-dev libfreetype6-dev libtk-img-dev tcl8.5-dev tk8.5-dev lynx poppler-utils xpdf wv xlhtml ppthtml
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="make-your-virtualenv-happen"&gt;
&lt;h2&gt;Make your virtualenv happen&lt;/h2&gt;
&lt;p&gt;Now that's sorted, convert an existing buildout folder over to
Virtualenv:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
python bootstrap.py -v1.4.3
easy_install ipython
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
./bin/buildout
&lt;/pre&gt;
&lt;p&gt;And that handles setting up and activating virtualenv, &lt;strong&gt;making sure we
bootstrap with version 1.4.3 of buildout&lt;/strong&gt;, installing useful/necessary
python packages, and reworking everything via buildout. As highlighted
with the &lt;strong&gt;bold&lt;/strong&gt; text, you must make sure you add the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-v1.4.3&lt;/span&gt;&lt;/tt&gt;
option to running bootstrap.py.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So, that wraps things up. You should now have a fully functional
virtualenv, just like you did back in the good old days (or, if you're
new to this game, a fresh new install). Now, if you're a Plonista, you
can fire up your instance and it should start just fine.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="10.04"></category><category term="how-to"></category><category term="install"></category><category term="installation"></category><category term="lucid"></category><category term="plone"></category><category term="python"></category><category term="virtualenv"></category></entry><entry><title>Good Morning World Plone Day!</title><link href="http://davidjb.com/blog/2010/04/good-morning-world-plone-day/" rel="alternate"></link><updated>2010-04-28T00:00:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-04-28:blog/2010/04/good-morning-world-plone-day/</id><summary type="html">&lt;p&gt;Good morning from the land down under and welcome to World Plone Day
2010! It's right on the hour (well, just after now) and 28 April 2010 --
and yes, that's World Plone Day to the uninitiated. To celebrate and to
mark the occasion, I'll be holding a bit of a discussion today about
what Plone is, why it's so useful, and what we, as users, are hanging
out for in Plone 4 and above. But, what fun is that without sweets to
eat?&amp;nbsp; And what's potentially tastier than Plone?&amp;nbsp; Plone cupcakes!&lt;/p&gt;
&lt;p&gt;Thanks to some great work by my lovely partner, she's whipped up some
cupcakes for WPD.&amp;nbsp; I didn't do much save for helping with design and
icing -- woo!&amp;nbsp; Here's the end results:&lt;/p&gt;
&lt;img alt="|filename|images/cupcakes1.jpg" src="http://davidjb.com/static/images/cupcakes1.jpg" style="width: 45%;" /&gt;
&lt;img alt="|filename|images/cupcakes2.jpg" src="http://davidjb.com/static/images/cupcakes2.jpg" style="width: 45%;" /&gt;
&lt;p&gt;Okay, so the CMYK colour might be a little off and I'm thinking I'm not
conforming to all Plone logo usage guidelines but they look good.
Haven't tasted them yet but I'm sure they'll be excellent.&amp;nbsp; I had
thought of a line like &amp;quot;Open Source never tasted so sweet&amp;quot;, but I think
I'll let that go.&lt;/p&gt;
&lt;p&gt;Viva la World Plone Day!&lt;/p&gt;
</summary><category term="date"></category><category term="food"></category><category term="life"></category><category term="plone"></category><category term="sweets"></category><category term="tasty"></category><category term="wpd"></category></entry><entry><title>Plone/Zope: Utilising zope.testrecorder for unit testing</title><link href="http://davidjb.com/blog/2010/03/plonezope-utilising-zope-testrecorder-for-unit-testing/" rel="alternate"></link><updated>2010-03-25T09:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-03-25:blog/2010/03/plonezope-utilising-zope-testrecorder-for-unit-testing/</id><summary type="html">&lt;p&gt;Writing unit tests (especial doctests) for your Plone product is
reasonably time consuming. For us developers, having tested code is
absolutely essential. This is especially true when clients are beating
down your door looking for a fully functional product and you need to
know what you've written works and isn't going to fall over (just yet,
anyway). Web apps are able to be tested using a multitude of frameworks,
and whilst not the most fully featured (eg lacking Javascript support),
Zope's doctest machinery is right there within your Plone product. In
order to write these, enter zope.testrecorder to more-or-less automate
replicating your actions into tests.&lt;/p&gt;
&lt;p&gt;zope.testrecorder is simple to install: just add it to your eggs list
under your buildout's relevant instance section, and also the
corresponding zcml list too. Re-run your buildout and you will now have
the latest version of the package installed.&lt;/p&gt;
&lt;p&gt;There's some good documentation out there about this, such as &lt;a class="reference external" href="http://plone.org/documentation/kb/testing/zope-testrecorder"&gt;Martin
Aspeli's article&lt;/a&gt; on plone.org, but it's slightly dated given latest
updates with the package. Essentially, everything is relevant with the
exception of how to actually access the test recorder now. Enter
&lt;a class="reference external" href="http://pyyou.wordpress.com/2008/04/11/how-to-install-zopetestrecorder-with-buildout/"&gt;PyYou's post&lt;/a&gt; about this same topic. Thanks to that article I now know
you should go to
&lt;strong&gt;http://zopehost:port/++resource++recorder/index.html&lt;/strong&gt; to access the
test recorder, and not try and add an object in the root of Zope (or
elsewhere).&lt;/p&gt;
&lt;p&gt;Aside from that, the recorder works like a charm. You input the address
of what site (it can be anything or anywhere) you want to test and click
the 'Go' button. Everything you do (mostly) gets monitored and recorded.
A few words to the wise though:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;No testing or recording Javascript-based or centric actions.&amp;nbsp; So
don't expect that product you wrote with the Google Maps API to work
so well with recording tests.&amp;nbsp; Or, don't expect the test recorder to
understand correctly that you clicking on the 'Add New...' menu in
Plone isn't actually a real link.&lt;/li&gt;
&lt;li&gt;No ability to just browse with Javascript turned off.&amp;nbsp; Essentially,
as the zope.testrecorder itself needs Javascript to run, you can't
turn it off, thinking you'll record things correctly, or at all.
Maybe there's a way around this issue, but it's likely more
complicated than I care to concern myself with.&lt;/li&gt;
&lt;li&gt;Specialised form widgets are problematic.&amp;nbsp; The Plone visual editor is
one (Javascript, again), but does work if you switch the editor to be
HTML before saving a form.&amp;nbsp; Another example that will require some
fancy work around is z3c.relationfield -- there's no non-Javascript
fall back here (that I can see).&lt;/li&gt;
&lt;li&gt;You'll need to manually intervene with the rendered tests and fix
some things up.&amp;nbsp; For example, testing the default title of a Plone
site doesn't work because there's a hyphen in the title.&amp;nbsp; It's a
special character and thus saved &amp;quot;incorrectly&amp;quot; within the doctests.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Aside from all that, most of the heavy lifting is done for you, so
cheers to the creators of zope.testrecorder for making my life just that
bit easier.&lt;/p&gt;
</summary><category term="buildout"></category><category term="install"></category><category term="plone"></category><category term="product"></category><category term="recorder"></category><category term="test"></category><category term="unit tests"></category><category term="zope"></category></entry><entry><title>GenericSetup and "mismatched" tags in ZCML</title><link href="http://davidjb.com/blog/2010/03/genericsetup-and-mismatched-tags-in-zcml/" rel="alternate"></link><updated>2010-03-12T11:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-03-12:blog/2010/03/genericsetup-and-mismatched-tags-in-zcml/</id><summary type="html">&lt;p&gt;Ever the issue-magnet, I've spent the better part of my morning trying
to debug a mistmatched tag error from within some ZCML (aka XML for the
non-initiated).&amp;nbsp; Essentially, the issue boiled down to the system
telling me that it was certain that I had a mistmatched tag within my
configuration, and presented me with the problematic XML tag (complete
with line numbers).&amp;nbsp; However, life's not always that simple.&lt;/p&gt;
&lt;p&gt;The traceback looked like this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):
&lt;/span&gt;&lt;span class="gr"&gt;zope.configuration.config.ConfigurationExecutionError&lt;/span&gt;: &lt;span class="n"&gt;xml.parsers.expat.ExpatError: mismatched tag: line 6, column 70&lt;/span&gt;
&lt;span class="x"&gt;in:
File &amp;quot;/home/david/buildout/src/aaa.project/aaa/project/profiles.zcml&amp;quot;, line 9.2-15.6&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And specified the exact genericsetup:registerProfile configuration that
was problematic. After much poking and prodding and thinking that there
must be some random character hidden in my configuration file (and
checking other files that call this one), no dice. Even copying and
pasting some new code that I knew worked just simply didn't when I put
it here.&lt;/p&gt;
&lt;p&gt;So, I just happened to actually think about what I'm calling with this
ZCML: a Plone product generic setup profile. And, yes, now it seems so
clear that the issue was in fact in that GS profile. My vim editor had
kindly re-auto-closed a tag that it shouldn't have (because it was
already closed) in my metadata.xml. Fixing that solved the issue and let
my Zope instance start up again.&lt;/p&gt;
</summary><category term="configuration"></category><category term="error"></category><category term="mismatched"></category><category term="plone"></category><category term="tags"></category><category term="xml"></category><category term="zcml"></category><category term="zope"></category></entry><entry><title>(Lack of) Kupu CSS Styles, Plone and Deliverance</title><link href="http://davidjb.com/blog/2010/01/lack-of-kupu-css-styles-plone-and-deliverance/" rel="alternate"></link><updated>2010-01-14T14:13:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2010-01-14:blog/2010/01/lack-of-kupu-css-styles-plone-and-deliverance/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; see &lt;a class="reference external" href="http://www.coactivate.org/projects/deliverance/lists/deliverance-discussion/archive/2010/01/1263439188459/forum_view"&gt;this post&lt;/a&gt; for up-to-date details.&lt;/p&gt;
&lt;p&gt;Essentially, the issue is that Deliverance doesn't theme (and rightly
so) the Kupu editor within Plone and hence any styles applied to normal
pages by Deliverance don't show up.&amp;nbsp; My workaround, as detailed on that
post, is to customise the &amp;quot;emptypageresources&amp;quot; page template and include
a suitable link to the CSS file, like so:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;link&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;site.css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;rel=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;StyleSheet&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;tal:attributes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;href string:${context/&amp;#64;&amp;#64;plone_portal_state/navigation_root_url}/static/theme/site.css;&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;(changing the tal:attributes section accordingly).&amp;nbsp; This should
introduce perfectly correct styles for your editor from your Deliverance
(or other) static theme.&lt;/p&gt;
&lt;p&gt;This feels to be a very common use case, but I can't seem to find any
other suggestions on a workaround/solution. I'd have to think that this
is likely to be a widespread issue, though. It's definitely not
something that should happen if we're actually able to have the WYSIWYG
editor be WYSIWYG (unlike some other CMS products).&lt;/p&gt;
</summary><category term="css"></category><category term="deliverance"></category><category term="editor"></category><category term="kupu"></category><category term="plone"></category><category term="static"></category><category term="style"></category><category term="theme"></category></entry><entry><title>Logged out users can't bring up the Plone popup calendar</title><link href="http://davidjb.com/blog/2009/12/logged-out-users-cant-bring-up-the-plone-popup-calendar/" rel="alternate"></link><updated>2009-12-18T12:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-18:blog/2009/12/logged-out-users-cant-bring-up-the-plone-popup-calendar/</id><summary type="html">&lt;p&gt;It's another one of those 'strange' problems that has cropped up, but by
default in Plone, users who aren't authenticated aren't actually able to
bring up a pop-up calendar on a date field.&lt;/p&gt;
&lt;p&gt;It's amazing that I haven't run into this issue before with something
like PloneFormGen, where you'd think that a simple Date input field
would be pretty common.&amp;nbsp; Although, I guess it's the case that even
though I've used these given forms, I've probably never taken much
notice of the popup calendar icon and just selected a random date from
the drop-down lists.&amp;nbsp; I suppose entering a random number on they
keyboard and hitting tab across the fields 3 times is simpler than going
for the mouse.&amp;nbsp; Who knows.&lt;/p&gt;
&lt;p&gt;Anyway, the issue presents itself with an error in the Javascript on the
page, with something like 'plone.jscalendar not defined', if my memory
serves me correctly.&amp;nbsp; I believe that Firebug/Firefox didn't show up an
error for me (because I was logged in!) so make sure you test this on
your site when you're logged out, if you've got such fields.&amp;nbsp; Testing in
IE revealed the problem since my IE versions in my VM can't actually
enter details into form fields, thus preventing me &lt;em&gt;from&lt;/em&gt; actually
logging in.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;The solution was the only Google result at the time, and that was at:
&lt;a class="reference external" href="http://plone.org/products/ploneformgen/issues/232"&gt;http://plone.org/products/ploneformgen/issues/232&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Essentially, head into the portal_css and portal_javascripts areas in
the ZMI and look search on the page for &amp;quot;calendar&amp;quot;.&amp;nbsp; You should find
that the 'condition' on these resources isn't right (eg only logged in
users or &amp;quot;not: portal/portal_membership/isAnonymousUser&amp;quot; is set or
isn't correct at all).&amp;nbsp; Correct it accordingly to be blank (easiest
way!) and save.&amp;nbsp; You may need to enable/reload/disable the debugging
modes for the CSS and JS to see the change immediately.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="authenticated"></category><category term="calendar"></category><category term="css"></category><category term="javascript"></category><category term="members"></category><category term="plone"></category><category term="popup"></category><category term="problem"></category><category term="testing"></category><category term="users"></category></entry><entry><title>David tries Plone 4.0a2 (Part 2)</title><link href="http://davidjb.com/blog/2009/12/david-tries-plone-4-0a2-part-2/" rel="alternate"></link><updated>2009-12-08T16:21:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-08:blog/2009/12/david-tries-plone-4-0a2-part-2/</id><summary type="html">&lt;p&gt;Rightio!&amp;nbsp; So we've got Plone 4.0a2 installed and up and running.&amp;nbsp; Boy,
she looks sweet:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The new Plone site setup is flawlessly simple.&amp;nbsp; No more ZMI for those
of us that don't want to use it.&amp;nbsp; It'll always still be useful, but
having Plone throw up a simple, no no-nonsense front-end installer is
just what it needed.&amp;nbsp; Other PHP based CMSes always had it too easy
;-)&lt;/li&gt;
&lt;li&gt;Editing view:&amp;nbsp; clearer tabs at the top (no idea how many clients miss
those, me included to start!) and resizable editing fields.&amp;nbsp; Great.
TinyMCE as the editor -- just what the doctor ordered as Kupu just
wasn't quite up to task.&amp;nbsp; (Note that I'm using Wordpress with
TinyMCE, so I could be a little biased).&amp;nbsp; Still needs work with the
Image insert page, but anyway, in good time.&lt;ul&gt;
&lt;li&gt;Also, it seems like the &amp;quot;auto-link text from Plone content title&amp;quot;
feature is gone.&amp;nbsp; I've opened a ticket, hopefully it'll get fixed:
&lt;a class="reference external" href="https://dev.plone.org/plone/ticket/9908"&gt;https://dev.plone.org/plone/ticket/9908&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Good to see the Resource Types for TinyMCE are simpler than Kupu.
Wow it was it a mission to add a new type of Folder-ish content
and not de-select the rest of everything in the process in its
multi-select box widget.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pop-up overlays inside Plone: very cool.&amp;nbsp; Saves an entire page reload
(I would hope so...) so a thumbs up from me!&lt;/li&gt;
&lt;li&gt;Better search options and collapsed options on the form.&amp;nbsp; I saw the
latter as an add-on from ages ago and thought it'd be a good thing to
have.&amp;nbsp; Nice to see it (or similar) included by default.&amp;nbsp; Those search
options were daunting.&lt;/li&gt;
&lt;li&gt;Email addresses as logins!&amp;nbsp; Another feature that users keep asking
about that's included.&lt;/li&gt;
&lt;li&gt;User rego fields -- something very promising as I've been
looking/hoping to move to a less-fixed way of managing user profile
attributes in Plone.&amp;nbsp; Goodo.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That's about a wrap from me.&amp;nbsp; Looking good so far; a lot of smaller
issues are getting sorted.&amp;nbsp; Cheers to all those developers for all the
hard work so far.&amp;nbsp; If I knew more, I'd be helping out more than I am
now.&lt;/p&gt;
</summary><category term="alpha"></category><category term="demo"></category><category term="new"></category><category term="plone"></category><category term="sunburst"></category><category term="test"></category><category term="theme"></category><category term="ubuntu"></category></entry><entry><title>David tries Plone 4.0a2 (Part 1)</title><link href="http://davidjb.com/blog/2009/12/david-tries-plone-4-alpha-2-part-1/" rel="alternate"></link><updated>2009-12-08T15:48:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-12-08:blog/2009/12/david-tries-plone-4-alpha-2-part-1/</id><summary type="html">&lt;p&gt;Plone 4 is approaching!&amp;nbsp; Excellent!&amp;nbsp; Lots of new features to play around
with and plenty more things to have to fix with the upgrade.&amp;nbsp; I've been
keeping tabs on the change log of updates and it's looking really good.
Lots of little, but significant, changes are afoot.&amp;nbsp; Now, how about
actually installing the Alpha 2 version of Plone 4 to see it for real?
Let's do it!&lt;/p&gt;
&lt;p&gt;My steps are not going to work on your computer.&amp;nbsp; I don't think you'll
be able to follow my words/commands exactly, but here goes anyway about
my experience so far.&amp;nbsp; The buildout might/might not work on Windows/Mac;
I'm on Linux and that's that FYI.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;I grabbed the buildout from
&lt;a class="reference external" href="https://svn.plone.org/svn/plone/buildouts/plone-coredev/branches/"&gt;https://svn.plone.org/svn/plone/buildouts/plone-coredev/branches/&lt;/a&gt;
and beat it over the head with a stick.&amp;nbsp; I downloaded the Plone 4.0a2
versions.cfg from &lt;a class="reference external" href="http://dist.plone.org/release/4.0a2/versions.cfg"&gt;http://dist.plone.org/release/4.0a2/versions.cfg&lt;/a&gt;
over the top of the one provided and made the buildout.cfg provided
only extend off versions.cfg.&amp;nbsp; You'll also need to strip back the
'parts' section of the buildout (eg no 'test' sections since I don't
really need to know things aren't 100% right yet ;-) )&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Set up your virtualenv in your given folder, making sure you use
&lt;strong&gt;Python 2.6&lt;/strong&gt;.&amp;nbsp; It's not marked in huge text and bold for you as
much as it is for me.&amp;nbsp; If you see this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;While:
Installing.
Getting section instance1.
Initializing section instance1.
Loading zc.buildout recipe entry plone.recipe.zope2instance &amp;gt;=2.0:default.
An internal error occured due to a bug in either zc.buildout or in a
recipe being used:
)[1 if IS_WIN else 0]
^
SyntaxError: invalid syntax&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;then you need to stop using Python 2.4 and start using 2.6, okay?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Make sure you've got the Python 2.6 development libraries installed
on your machine.&amp;nbsp; Expect pain from Zope 2.12.1 (etc) if you don't.
If you see this:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;include/ExtensionClass/ExtensionClass.h:83:20: error: Python.h: No such file or directory
....[lots of nasty errors]...
error: Setup script exited with error: command 'gcc' failed with exit status 1
An error occured when trying to install Zope2 2.12.1.Look above this message for any errors thatwere output by easy_install.
While:
Installing.
Getting section instance.
Initializing section instance.
Installing recipe plone.recipe.zope2instance.
Getting distribution for 'Zope2==2.12.1'.
Error: Couldn't install: Zope2 2.12.1&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;then go and run this, then run Buildout again:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python-dev
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Sort your PIL out.&amp;nbsp; See here: &lt;a class="reference external" href="http://davidjb.com/blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty"&gt;this post&lt;/a&gt; for how to handle it.&amp;nbsp; I'm
sure there are other, possibly easier ways, but the two
'easy_install' lines in that post work.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Run your buildout and hope there's no other problems I haven't
covered.&amp;nbsp; If you get stuck, go say hi to Google and I'll see you back
here after class.&amp;nbsp; Other than that, wait a very long amount of time
whilst the buildout completes, with or without fingers crossed.&amp;nbsp; Your
choice.&amp;nbsp; My buildout's going well so far, though.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And we're done buildout-ing!&amp;nbsp; Success!&lt;/p&gt;
&lt;p&gt;See my &lt;a class="reference external" href="http://davidjb.com/blog/2009/12/david-tries-plone-4-0a2-part-2"&gt;next post&lt;/a&gt; for my thoughts of this new version so far.&lt;/p&gt;
</summary><category term="alpha"></category><category term="buildout"></category><category term="install"></category><category term="plone"></category><category term="plone 4"></category><category term="testing"></category><category term="zope"></category></entry><entry><title>Deliverance, Plone, and tags</title><link href="http://davidjb.com/blog/2009/11/deliverance-plone-and-tags/" rel="alternate"></link><updated>2009-11-27T15:17:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-11-27:blog/2009/11/deliverance-plone-and-tags/</id><summary type="html">&lt;p&gt;It's been a little bit of time since my last post, and who can blame me
with my site having been down for almost 2 full days over the last
week!&amp;nbsp; I'm not paying that much for the webspace, thankfully, but if I
was, I'd be seeing red over it.&amp;nbsp; Apparently some patch for MySQL broke
everything; imagine how it looked to see my site with a '500 internal
error' plastered all over it and not being able to access my cPanel.
Ugh.&lt;/p&gt;
&lt;p&gt;Anyway, everything's back again, assuming that you can see this.&amp;nbsp; Okay?
Great!&lt;/p&gt;
&lt;p&gt;Today's conundrum presented itself very, very strangely.&amp;nbsp; People
couldn't change their password in Plone (which effectively breaks
registration if a user has to select a password).&amp;nbsp; The Plone site we
have was being themed by Deliverance. A colleague and I were taking a
look at this earlier in the week and from everything that we could see,
the request traffic and variables were being sent onto Plone correctly
from Deliverance. That said, the issue persisted.&lt;/p&gt;
&lt;p&gt;The issue ended up being a missing &amp;lt;base&amp;gt; tag in the page's HTML &amp;lt;head&amp;gt;
tag. Since this &amp;lt;base&amp;gt; tag controls relative links on any given page, I
guess that the resulting request/etc for password selection must have
been affected.&amp;nbsp; I've seen some pretty whacked out things happen without
that base tag, including bad relative links (the obvious problem),
missing menus on content (another issue relating to an old blog post)
etc.&lt;/p&gt;
&lt;p&gt;Essentially, Deliverance doesn't bring the &amp;lt;base&amp;gt; tag across by default,
as it doesn't know any better. That said, putting these new elements:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;replace&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;theme=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;append&lt;/span&gt; &lt;span class="na"&gt;content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/html/head/base&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;theme=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;children:/html/head&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;in the deliverance.xml configuration solved the problem.&amp;nbsp; Depending on
your theme, you might want just one of the lines as it says &amp;quot;replace my
&amp;lt;base&amp;gt; tag in theme with the one from the page&amp;quot; and falls back to
&amp;quot;append the base tag into the theme&amp;quot;.&amp;nbsp; Thanks the tag being moved with
the first command, the 2nd doesn't happen if the base tag is already
gone from the content.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;phew&lt;/em&gt; That was confusing; hopefully it helps someone out!&lt;/p&gt;
</summary><category term="deliverance"></category><category term="element"></category><category term="plone"></category><category term="problem"></category><category term="theme"></category><category term="themeing"></category><category term="xml"></category></entry><entry><title>Missing content menus in Plone</title><link href="http://davidjb.com/blog/2009/09/missing-content-menus-in-plone/" rel="alternate"></link><updated>2009-09-30T12:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-30:blog/2009/09/missing-content-menus-in-plone/</id><summary type="html">&lt;p&gt;Another dose of insanity please!&amp;nbsp; Coming right up, sir.&lt;/p&gt;
&lt;p&gt;Today's second discussion comes from an issue I was having recently with
a new Plone site that I was hosting behind Apache and Deliverance.&amp;nbsp; No
Varnish here yet, because I'd rather the site worked first before I try
and cache the life out of it.&lt;/p&gt;
&lt;p&gt;Now, the specific problem I was having was that the content menus in
Plone (eg Add New, Display, State, Actions and for me, Sub-types)
weren't displaying.&amp;nbsp; I thought it a Deliverance issue - maybe I was
dropping those content items accidentally or not including the
JavaScript needed to display them.&amp;nbsp; Uh, nope on both accounts.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;After a detailed search of everything I could have been doing wrong, I
can across my Apache rewrite rules.&amp;nbsp; Amazingly enough, I'd left off the
&lt;strong&gt;/_vh_mysite&lt;/strong&gt; at the end, so the URLs weren't being written
correctly.&amp;nbsp; Whilst the site was loading (mostly) fine, because I'd
inserted the URL to point to the site correctly, I'd forgotten that the
VHM needs the _vh_mysite part.&lt;/p&gt;
&lt;p&gt;Adding it in fixed the problem in a second, along with a throat-clearing
shift-refresh.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="apache"></category><category term="hosting"></category><category term="menus"></category><category term="plone"></category><category term="rewrite"></category><category term="rules"></category><category term="urls"></category><category term="VHM"></category><category term="virtual hosting"></category></entry><entry><title>Migrating a Plone site off to another database (Zeo)</title><link href="http://davidjb.com/blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/" rel="alternate"></link><updated>2009-09-30T12:25:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-30:blog/2009/09/migrating-a-plone-site-off-to-another-database-zeo/</id><summary type="html">&lt;p&gt;Another of the interesting things in my professional life has been
migrating a Plone site from one database (where it lived as a dev site,
along with many others) onto a nice, clean database of its own.&amp;nbsp; Now,
yes, I'm aware that the export/import feature of Zope &lt;strong&gt;isn't&lt;/strong&gt; supposed to
be used for migrating content or sites.&amp;nbsp; I am also aware, however,
through personal experience, that things have always been fine because
I'm using the same eggs and essentially the same installations
everywhere, thanks to buildout.&lt;/p&gt;
&lt;p&gt;So, the process goes as follows, with the above-mentioned points
considered already:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Head to the root of your ZMI and export your given Plone site&amp;nbsp; as
ZEXP&lt;/li&gt;
&lt;li&gt;Shut down your instance (or do what you will with your old site and
installation)&lt;/li&gt;
&lt;li&gt;Copy the ZEXP file into the 'import' folder of your new Zope instance&lt;/li&gt;
&lt;li&gt;Start your new instance, with your new empty database&lt;/li&gt;
&lt;li&gt;Log in to the root of the ZMI&lt;/li&gt;
&lt;li&gt;Add a new Plone site and call it anything you want (eg 'foo').&amp;nbsp; I'll
explain why shortly.&lt;/li&gt;
&lt;li&gt;Delete your 'foo' Plone site.&lt;/li&gt;
&lt;li&gt;Import your existing Plone site and be happy because it's now arrived
safe and sound.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="note"&gt;
&lt;h2&gt;Note&lt;/h2&gt;
&lt;p&gt;The reason I highlight adding a new Plone site a point 6 is because if
originally, you were like me and imported your site first to a bare Zope
install, you'll get errors &lt;strong&gt;everywhere&lt;/strong&gt; in your site.&amp;nbsp; They'll look
like &amp;quot;AttributeError: getGroups&amp;quot; or possibly something more obscure (if
possible!) and everything will fall over and die.&lt;/p&gt;
&lt;p&gt;Now, by creating a new Plone site first 'massages' the root of Zope, and
then your site should be fine.&amp;nbsp; Among other things, adding a site
changes the acl_users of the ZMI (seeing an abnormal acl_users is what
led me to the solution).&amp;nbsp; At a guess, given its type, this acl_users
change probably has something to do with the error above.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="database"></category><category term="export"></category><category term="import"></category><category term="migration"></category><category term="plone"></category><category term="site"></category><category term="zeo"></category><category term="zodb"></category></entry><entry><title>PloneFormGen (Plone) &amp; Google Calendar Integration</title><link href="http://davidjb.com/blog/2009/09/ploneformgen-plone-google-calendar-integration/" rel="alternate"></link><updated>2009-09-22T10:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-09-22:blog/2009/09/ploneformgen-plone-google-calendar-integration/</id><summary type="html">&lt;p&gt;It's a little bit of a different mash-up, but it's still nonetheless
useful to have, given types of booking forms and so forth that could
utilise it.&amp;nbsp; The easiest way I found (to avoid security issues with
Python scripts in Plone) was to create an external method and just
import it within a PFG Custom Adapter.&lt;/p&gt;
&lt;div class="section" id="parts"&gt;
&lt;h2&gt;Parts&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;My &lt;a class="reference external" href="http://davidjb.com/static/files/GoogleCalendar.py"&gt;GoogleCalendar.py&lt;/a&gt; external method.&amp;nbsp; I've had to add this into a
policy product I have.&amp;nbsp; The function should be generalised enough to
work with any Google account, hosted or not.&amp;nbsp; In short:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;It takes in a variety of arguments (email, password,
calendar_url, start_time, end_time, title, location, content).&lt;ul&gt;
&lt;li&gt;Email/password are your auth details&lt;/li&gt;
&lt;li&gt;calendar_url is where you're putting the event,&lt;/li&gt;
&lt;li&gt;and the rest of the args are related to the event itself.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;It builds the XML-based request to create the event.&amp;nbsp; I tried
going for the gdata API, but it's just over the top for a simple
exercise like this.&lt;/li&gt;
&lt;li&gt;Send the request to Google (twice, as required), and create the
event in the process.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;A custom PFG script adapter like this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;DateTime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DateTime&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;my.theme.Extensions.GoogleCalendar&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;createGoogleCalendarEvent&lt;/span&gt;
&lt;span class="n"&gt;calendar_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'http://www.google.com/...'&lt;/span&gt;
&lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'&amp;lt;span class=&amp;quot;mh-email&amp;quot;&amp;gt;myu&amp;lt;a href=&amp;quot;http://www.google.com/recaptcha/mailhide/d?k=01y8BLyDqFl2lR8hms6kYeaw==&amp;amp;c=WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY=&amp;quot; onclick=&amp;quot;window.open('&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;google&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;recaptcha&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mailhide&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mo"&gt;01&lt;/span&gt;&lt;span class="n"&gt;y8BLyDqFl2lR8hms6kYeaw&lt;/span&gt;&lt;span class="o"&gt;==&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;WDOrJledyL7Tzo9unwfHPwgE0TrIw31nHDxcUFu_QIY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;', '', '&lt;/span&gt;&lt;span class="n"&gt;toolbar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;scrollbars&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;statusbar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;menubar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;resizable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="s"&gt;'); return false;&amp;quot; title=&amp;quot;Reveal this e-mail address&amp;quot;&amp;gt;...&amp;lt;/a&amp;gt;&amp;#64;google.com&amp;lt;/span&amp;gt;'&lt;/span&gt;
&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'shhhhhsecret'&lt;/span&gt;
&lt;span class="n"&gt;startDateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'start-date-time'&lt;/span&gt;&lt;span class="p"&gt;])))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTML4&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;endDateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'end-date-time'&lt;/span&gt;&lt;span class="p"&gt;])))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTML4&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;eventTitle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'purpose'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;eventLocation&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'rooms-to-book'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;eventContent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;'Booked for:  '&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;'booking-name'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;createGoogleCalendarEvent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;calendar_url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;startDateTime&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;endDateTime&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventTitle&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventLocation&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;eventContent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And that should be that.&amp;nbsp; As long as all your URLs, emails, passwords,
and fields in your form are suitable, this should work a treat.&amp;nbsp; Note
that the start-date-time and end-date-time fields are date/time fields
in your Form Folder and converting to HTML4() makes them into Google's
format.&amp;nbsp; Additional info can be added in the eventContent variable, and
that'll turn up in the Description in Google Calendar.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="for-added-spice"&gt;
&lt;h2&gt;For added spice...&lt;/h2&gt;
&lt;p&gt;Just add a web interface to your Google Calendar to your Plone site (eg
in a normal Plone page; watch out for iframe filtering) and let people
book themselves into things.&amp;nbsp; Would be great to see PFG know when a
Google Calendar event was on (and stop people submitting) but it's a bit
much just for now.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="calendar"></category><category term="form"></category><category term="gen"></category><category term="google"></category><category term="mash"></category><category term="pfg"></category><category term="plone"></category><category term="product"></category><category term="python"></category><category term="script"></category></entry><entry><title>Plone: Re-ordering Viewlets</title><link href="http://davidjb.com/blog/2009/08/plone-re-ordering-viewlets/" rel="alternate"></link><updated>2009-08-19T16:34:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-08-19:blog/2009/08/plone-re-ordering-viewlets/</id><summary type="html">&lt;p&gt;Just responded to a post on the Plone Nabble forums (&lt;a class="reference external" href="http://n2.nabble.com/reordering-portal-globalnav--tp3470440p3470440.html"&gt;here&lt;/a&gt;) about how
to re-order viewlets.&amp;nbsp; In particular, this one is little different (but
not terribly so) because the original poster wanted to put the
breadcrumbs above the global sections (global tabs in Plone).&amp;nbsp; Normally,
this is straight forward because you just use a Generic Setup profile
(viewlets.xml) and use an order manager to move your viewlet.&amp;nbsp; This,
however, is a teeny bit more complicated because you've got one viewlet
that's outside of another viewlet manager.&lt;/p&gt;
&lt;p&gt;Without further ado, my post from the forums:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Check out
&lt;a class="reference external" href="http://plone.org/documentation/tutorial/customizing-main-template-viewlets/reordering-and-hiding-viewlets"&gt;http://plone.org/documentation/tutorial/customizing-main-template-viewlets/reordering-and-hiding-viewlets&lt;/a&gt;
for a pretty useful idea of manipulating viewlets.&lt;/p&gt;
&lt;p&gt;As it mentions there, you need a viewlets.xml in your theme
product's generic setup profile. &amp;nbsp;In this case, there's a bit more
complexity because the path_bar isn't registered in the same order
manager. &amp;nbsp;So, in your case, you'll want something like this in your
&lt;strong&gt;viewlets.xml&lt;/strong&gt; (hides the old path bar, and inserts it now before
the global sections [tabs]):&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;hidden&lt;/span&gt; &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.portaltop&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;skinname=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;My Theme&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;viewlet&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/hidden&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;order&lt;/span&gt; &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.portalheader&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;skinname=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;My Theme&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;viewlet&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;insert-before=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.global_sections&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/order&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;and you'll need to have something like this in a &lt;strong&gt;configure.zcml&lt;/strong&gt;
file (eg browser/configure.zcml) in order to get it into the
PortalHeader manager:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;browser&lt;/span&gt; &lt;span class="err"&gt;:viewlet&lt;/span&gt;
    &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.path_bar&amp;quot;&lt;/span&gt;
    &lt;span class="na"&gt;manager=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;plone.app.layout.viewlets.interfaces.IPortalHeader&amp;quot;&lt;/span&gt;
    &lt;span class="na"&gt;permission=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;zope2.View&amp;quot;&lt;/span&gt;
    &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, make these updates to your theme product, reinstall, and it
should be good.&lt;/p&gt;
&lt;p&gt;Also, depending on ordering and what else you have in your theme,
you might just want to re-order plone.path_bar to the top of the
plone.portaltop viewlet. &amp;nbsp;That'll put it before the PortalHeader
manager (as you can see in &amp;#64;&amp;#64;manage-viewlets).&lt;/p&gt;
&lt;/blockquote&gt;
</summary><category term="genericsetup"></category><category term="plone"></category><category term="product"></category><category term="programming"></category><category term="theme"></category></entry><entry><title>Virtualenv, Plone, and Centos 5.x</title><link href="http://davidjb.com/blog/2009/07/virtualenv-plone-and-centos-5/" rel="alternate"></link><updated>2009-07-09T13:25:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-07-09:blog/2009/07/virtualenv-plone-and-centos-5/</id><summary type="html">&lt;p&gt;&lt;strong&gt;EDIT:&lt;/strong&gt; Watch out for python-ldap 2.3.10, the latest version at time
of writing. Seems like there's an issue with it and Centos 5.4. Forcing
python-ldap to be version 2.3.8 works, though. (easy_install
python-ldap==2.3.8)&lt;/p&gt;
&lt;p&gt;Previously, you might have read about setting up a Virtualenv on Ubuntu
Jaunty. Now, that was reasonably painless since python-virtualenv and
python-setuptools is in the Ubuntu repo. Whether it's my Centos servers
and their misguided repos or me just not being able to find such a
related rpm packages, Centos just needs little more love to get it to
the same setup. (&lt;strong&gt;Note:&lt;/strong&gt; actually, there was a setuptools RPM that I
installed, but no idea why it didn't give me easy_install...)&lt;/p&gt;
&lt;p&gt;Here's what we're looking at for this time around.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;Install the dependencies and various development libraries needed for
PIL etc:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
yum install gcc gdbm-devel readline-devel ncurses-devel zlib-devel bzip2-devel sqlite-devel db4-devel openssl-devel tk-devel bluez-libs-devel libjpeg-devel zlib-devel freetype-devel
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Install setuptools and virtualenv:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
wget http://pypi.python.org/packages/2.4/s/setuptools/setuptools-0.6c9-py2.4.egg#md5&lt;span class="o"&gt;=&lt;/span&gt;260a2be2e5388d66bdaee06abec6342a
sh setuptools-0.6c9-py2.4.egg
rm -f setuptools-0.6c9-py2.4.egg
easy_install-2.4 -U setuptools
easy_install-2.4 virtualenv
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Create a virtual environment and activate it:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Easy install the dependencies of Plone. Not sure if they're needed
for Centos, but it did all work nicely after doing this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre class="code literal-block"&gt;
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
easy_install lxml
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Clear as mud? I thought so. Essentially the only difference is actually
getting the right development libraries and then getting setuptools
itself working correctly. As I mentioned, for whatever reason my
python-setuptools rpm doesn't have easy install. Maybe it's because it's
an old version? Who knows. This is an easy enough workaround.&lt;/p&gt;
</summary><category term="centos"></category><category term="easy_install"></category><category term="plone"></category><category term="python"></category><category term="rpm"></category><category term="virtualenv"></category></entry><entry><title>plone.app.blob and Failed Migrations</title><link href="http://davidjb.com/blog/2009/07/plone-app-blob-and-failed-migrations/" rel="alternate"></link><updated>2009-07-03T12:11:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-07-03:blog/2009/07/plone-app-blob-and-failed-migrations/</id><summary type="html">&lt;p&gt;Another fun-and-games style problem I've come across when using
plone.app.blob: sometimes migrations won't work when converting a
standard site's files over to blobs.&lt;/p&gt;
&lt;p&gt;That's a pretty ambiguious description, but essentially, the error you
might see will have a semi-normal traceback to start, and then garbage
(contents of a file, presumably) - which, depending on the file size
might hurt your browser.&amp;nbsp; The last part of the (normal) traceback reads
thus:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;File &amp;quot;/home/buildout/instance/eggs/plone.app.linkintegrity-1.0.11-py2.4.egg/ plone/app/linkintegrity/handlers.py&amp;quot;, line 158, in referencedObjectRemoved raise LinkIntegrityNotificationException, obj LinkIntegrityNotificationException&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Thankfully, this gives us an excellent pointer to a solution: disable
link integrity checking on your site prior to migrating.&lt;/p&gt;
&lt;div class="section" id="the-fix-workaround"&gt;
&lt;h2&gt;The fix/workaround&lt;/h2&gt;
&lt;p&gt;Head to the Plone Control Panel, and click onto Site.&amp;nbsp; Uncheck &lt;em&gt;Enable
link integrity checks&lt;/em&gt;and then run your blob migration.&amp;nbsp; When you're
done, you can return your site to normal.Or not.&amp;nbsp; Your choice.&amp;nbsp; Doens't
seem like there's any harm with turning it back on once everything's
happy; just something to watch out when migrating content.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="blob"></category><category term="fix"></category><category term="links"></category><category term="plone"></category><category term="problem"></category><category term="traceback"></category></entry><entry><title>User-selectable Themes In Plone</title><link href="http://davidjb.com/blog/2009/06/user-selectable-themes-in-plone/" rel="alternate"></link><updated>2009-06-25T13:10:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-06-25:blog/2009/06/user-selectable-themes-in-plone/</id><summary type="html">&lt;p&gt;It's something I came across a while ago, but wasn't exactly something
that stayed in the fore-front of my mind: how to let users choose or
select a theme (arbitrarily) on a Plone site.&amp;nbsp; Normally, I stick to
having one theme per site for continuity but a new theme-test site for
clients is an exception.&lt;/p&gt;
&lt;p&gt;If you were to search Google for the right terms, you'll find out how to
let this happen, but I ended up having to go hunt it down myself.
Hopefully this entry will help people (if I go and include as many terms
as I think I or someone else might look for!).&lt;/p&gt;
&lt;div class="section" id="how"&gt;
&lt;h2&gt;How&lt;/h2&gt;
&lt;p&gt;Head to the ZMI as an administrative user (/manage), and then to
portal_skins.&amp;nbsp; Under the Properties tab, you'll find a Boolean option
called &amp;quot;Allow arbitrary skins to be selected&amp;quot;.&amp;nbsp; You guessed it; turn to
it on and save.&lt;/p&gt;
&lt;p&gt;Your users now have a drop-down menu in their personal preferences for
changing the theme.&amp;nbsp; Install some additional themes and away you go.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; seems like this feature doesn't work well or I'm not using it
right.&amp;nbsp; Changing the theme for one user changes it for everyone..hmm.
Probably the reason the option's hiding in the ZMI!&lt;/p&gt;
&lt;/div&gt;
</summary><category term="plone"></category><category term="skin"></category><category term="theme"></category><category term="zmi"></category></entry><entry><title>Virtualenv, Plone, and Ubuntu 9.04 Jaunty</title><link href="http://davidjb.com/blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty/" rel="alternate"></link><updated>2009-06-12T12:35:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-06-12:blog/2009/06/virtualenv-plone-and-ubuntu-904-jaunty/</id><summary type="html">&lt;p&gt;What a complicated situation it is trying to use all of the
above-mentioned pieces of software together. In all seriousness,
Virtualenv is now appearing to be the best thing since sliced bread for
me to help out with making Plone/Zope usable under Jaunty.&lt;/p&gt;
&lt;p&gt;By default, as everyone should know by now, a whole bunch of old Python
2.4 packages got removed from Jaunty, throwing us Plone developers into
peril.&amp;nbsp; Well, those of us who hadn't discovered the joys of virtualenv
yet, that is.&lt;/p&gt;
&lt;p&gt;Here's how to convert an existing buildout folder over to Virtualenv
without too much hassle:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python-virtualenv
virtualenv -p /usr/bin/python2.4 .
&lt;span class="nb"&gt;source&lt;/span&gt; ./bin/activate
easy_install ipython
easy_install --find-links http://www.pythonware.com/products/pil/ Imaging
easy_install --find-links http://download.zope.org/distribution PILwoTK
easy_install python-ldap
./bin/buildout
&lt;/pre&gt;
&lt;p&gt;And that should handle the issues of, in order of command: installing
virtualenv, setting up our current folder, activating virtualenv,
installing useful/necessary python packages, and reworking everything
via buildout.&lt;/p&gt;
&lt;p&gt;The instance of Plone/Zope can be started up with/without
`&lt;strong&gt;activate&lt;/strong&gt;` being `&lt;strong&gt;source&lt;/strong&gt;`'d, as virtualenv has now
got its own local python interpreter here.&lt;/p&gt;
&lt;p&gt;Cheers to Athena Geek &amp;#64;
&lt;a class="reference external" href="http://athenageek.wordpress.com/2009/05/22/virtualenv-in-plone/"&gt;http://athenageek.wordpress.com/2009/05/22/virtualenv-in-plone/&lt;/a&gt; for the
details to get me started.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EDIT:&lt;/strong&gt; You might need to install some of the following packages to
make all the imaging (and rest of Plone) be happy:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
sudo apt-get install python2.4-dev libtk-img-dev libfreeimage-dev libjpeg62-dev libfreetype6-dev libtk-img-dev tcl8.5-dev tk8.5-dev lynx poppler-utils xpdf wv xlhtml ppthtml
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;EDIT2:&lt;/strong&gt; If you get weird messages about &amp;quot;Undefined symbol:
PyUnicodeUCS2_*&amp;quot; then you should probably wipe your virtualenv clean
and go again. Essentially, dump your lib, include, and content of your
eggs folder, and re-do your virtualenv. If pain persists, see your
Google.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EDIT3:&lt;/strong&gt; This also works on Karmic (9.10)! :)&lt;/p&gt;
</summary><category term="9.04"></category><category term="9.10"></category><category term="jaunty"></category><category term="karmic"></category><category term="linux"></category><category term="plone"></category><category term="python"></category><category term="ubuntu"></category><category term="virtualenv"></category><category term="zope"></category></entry><entry><title>Plone: Issues with products</title><link href="http://davidjb.com/blog/2009/04/plone-issues-with-products/" rel="alternate"></link><updated>2009-04-23T09:15:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-04-23:blog/2009/04/plone-issues-with-products/</id><summary type="html">&lt;p&gt;Oh dear. Products in Plone that don't care to uninstall themselves at
all when removed. One such product that comes to mind is
ZipFileTransport.&lt;/p&gt;
&lt;p&gt;I could go into depth all day about its failure to uninstall, but in
specific, it's this line of code in its setupHandlers.py file that kills
me:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registerUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'zipfiletransport'&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Now, where's the unregisterUtility called? Nowhere, unfortunately. So
when one tries to go and install/uninstall/reinstall/do certain things
on the site, you get a nasty failure message about trying to unpickle a
python object:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;2009-04-23 10:19:19 ERROR Zope.SiteErrorLog http://localhost:8080/eresearch/portal_quickinstaller/uninstallProductsTraceback (innermost last):
Module ZPublisher.Publish, line 125, in publish
Module Zope2.App.startup, line 238, in commit
Module transaction._manager, line 96, in commit
Module transaction._transaction, line 395, in commit
Module transaction._transaction, line 495, in _commitResources
Module ZODB.Connection, line 510, in commit
Module ZODB.Connection, line 555, in _commit
Module ZODB.Connection, line 582, in _store_objects
Module ZODB.serialize, line 407, in serialize
Module ZODB.serialize, line 416, in _dump
PicklingError: Can't pickle: import of module Products.ZipFileTransport.utilities.interfaces failed&lt;/span&gt;
&lt;/pre&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution?&lt;/h2&gt;
&lt;p&gt;Okay, I found the unregisterUtility function in zope.component, and it
can be accessed by something like this (ipython session, of course):
(You'll need at least the ZFT parts below present to import them).&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.app.component.hooks&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;setSite&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zope.component&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.ZipFileTransport.utilities.interfaces&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.ZipFileTransport.utilities.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ZipFileTransportUtility&lt;/span&gt;
&lt;span class="n"&gt;setSite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;portal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getSiteManager&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unregisterUtility&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provided&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;#Even though unregister happened, it probably said it worked but left crap around.&lt;/span&gt;
&lt;span class="c"&gt;#Let's clean it up&lt;/span&gt;

&lt;span class="c"&gt;#This intclass variable might not be right.  It's going to be the key present below,&lt;/span&gt;
&lt;span class="c"&gt;#so you can always find the right InterfaceClass manually and set it accordingly.&lt;/span&gt;
&lt;span class="n"&gt;intclass&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;IZipFileTransportUtility&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;intclass&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;#From here, search for 'Zip' to see if it's gone&lt;/span&gt;
&lt;span class="c"&gt;#Each should return -1.  If not, you've done something wrong!&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_adapters&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_subscribers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;utilities&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__dict__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'Zip'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And thus ends the tyranny of ZipFileTransport.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Edit:&lt;/strong&gt; I should make it clear that to run the above commands you need
to have a handle to your Plone site object, and be pre-set as the
'portal' variable. If you set up ipython like so:
&lt;a class="reference external" href="http://plone.org/documentation/kb/setup-ipython-for-zope"&gt;http://plone.org/documentation/kb/setup-ipython-for-zope&lt;/a&gt; then that takes
care of things automatically and gives you interactive handles to your
portal and Zope app root. If you're not using this, then figure out how
to set 'portal' manually to be your Plone site object (not a string or
name, but the actual object) and run the rest of the lines of code.&lt;/p&gt;
&lt;p&gt;Also, I'm not sure whether you need to commit your changes or not. If
you find the changes don't stick, then try this in your ipython session:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;transaction&lt;/span&gt;
&lt;span class="n"&gt;transaction&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;commit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
</summary><category term="plone"></category><category term="problem"></category><category term="products"></category><category term="zip"></category></entry><entry><title>Plone: Clamping down on categories</title><link href="http://davidjb.com/blog/2009/04/plone-clamping-down-on-categories/" rel="alternate"></link><updated>2009-04-21T09:11:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-04-21:blog/2009/04/plone-clamping-down-on-categories/</id><summary type="html">&lt;p&gt;Probably my last blog entry here because I'll be moving to the AWESOME
WordPress very soon &amp;#64; &lt;a class="reference external" href="http://davidjb.com/blog"&gt;http://davidjb.com/blog&lt;/a&gt; (with a nice new site design,
too)&amp;nbsp; (EDIT: Migrated from my old blog 8-) ) .  (&lt;strong&gt;2013 edit&lt;/strong&gt;: Goodbye
Wordpress, I really hate PHP and its security issues. I'm a Python developer
and I really should be eating my own dogfood).&lt;/p&gt;
&lt;p&gt;Anyway, how to prevent the addition of new categories to the Plone
listing (the inline comments aren't mine, they're copied):&lt;/p&gt;
&lt;blockquote&gt;
It's a bit hidden and probably undocumented but here we go: ZMI -&amp;gt;
portal_metadata -&amp;gt; schema tab (should be the default view of the
tool in ZMI) -&amp;gt; click DCMI in the Metadata Schemas section (why do
so many people not know that the plural form of 'schema' is
'schemata' - but I digress ) -&amp;gt; click 'Subject' within the
'Element' row -&amp;gt; add terms to the vocabulary field - in the upper
part if this should apply to all portal types (don't forget to press
'Update') or in the lower part to define a portal type specific
policy.&lt;/blockquote&gt;
&lt;p&gt;Something that wasn't mentioned was the 'Enforce vocabulary?' box. If
you go and tick that, and save the changes, then any additional
categories that someone adds are only localised to that one content item
- they're not entered into the overall listing. Doesn't stop someone who
misses a category from entering a new one locally, but it's a good
start.&lt;/p&gt;
</summary><category term="categories"></category><category term="enforce"></category><category term="plone"></category></entry><entry><title>Plone: Plone4Artists Video - Can't Edit Videos</title><link href="http://davidjb.com/blog/2009/02/plone-plone4artists-video-cant-edit-videos/" rel="alternate"></link><updated>2009-02-25T09:01:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-02-25:blog/2009/02/plone-plone4artists-video-cant-edit-videos/</id><summary type="html">&lt;p&gt;Wow..I just keep hitting these problems. The latest issue is chronicled
here: &lt;a class="reference external" href="http://dev.plone4artists.org/pm/p/plone4artists/ticket/160"&gt;http://dev.plone4artists.org/pm/p/plone4artists/ticket/160&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;which essentially boils down to this problem when you try and edit a
video subtyped File from p4a.plonevideo (or p4a.video or whatever it's
called now):&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Traceback (innermost last):
* Module ZPublisher.Publish, line 119, in publish
* Module ZPublisher.mapply, line 88, in mapply
* Module ZPublisher.Publish, line 42, in call_object
* Module zope.formlib.form, line 769, in __call__
* Module p4a.video.browser.video, line 362, in update
* Module Products.Five.formlib.formbase, line 55, in update
* Module zope.formlib.form, line 732, in update
* Module p4a.video.browser.video, line 367, in setUpWidgets
* Module zope.formlib.form, line 393, in setUpEditWidgets
* Module zope.formlib.form, line 323, in _createWidget
* Module zope.component._api, line 103, in getMultiAdapter
ComponentLookupError: ((&amp;lt;p4a .fileimage.file._field.FileField object at 0x15ce2610&amp;gt;, &amp;lt;httprequest , URL=[snip].mp4/atct_edit&amp;gt;), &amp;lt;interfaceclass zope.app.form.interfaces.IInputWidget&amp;gt;, u'')&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;And so, after much painful searching and confusion, it's just simply an
issue of including &lt;tt class="docutils literal"&gt;p4a.fileimage&lt;/tt&gt; in the ZCML section of your
instance in your buildout.&lt;/p&gt;
&lt;p&gt;Wow..back to work (finally).&lt;/p&gt;
</summary><category term="p4a"></category><category term="plone"></category><category term="plone4artists"></category><category term="problem"></category><category term="subtyped"></category><category term="video"></category></entry><entry><title>Plone: Google Calendar Integration</title><link href="http://davidjb.com/blog/2009/02/plone-google-calendar-integration/" rel="alternate"></link><updated>2009-02-19T08:55:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-02-19:blog/2009/02/plone-google-calendar-integration/</id><summary type="html">&lt;p&gt;Wouldn't it be great if you could somehow add your Event content item
within the Plone CMS onto your Google Calendar with just a click? (it'd
be better with fewer, but 1 click is pretty good - give me a break!)&lt;/p&gt;
&lt;p&gt;Try this placed inside the &lt;tt class="docutils literal"&gt;event_view&lt;/tt&gt; page template (customise it in
the ZMI) after the vCal and iCal links:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;a&lt;/span&gt; &lt;span class="na"&gt;href=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;tal:attributes=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;href python:'http://www.google.com/calendar/event?action=TEMPLATE'
+'&amp;amp;text='+here.title
+'&amp;amp;dates='+here.start().toZone('UTC').ISO8601().replace('-','').replace(':','').split('+')[0]+'Z/'
+here.end().toZone('UTC').ISO8601().replace('-','').replace(':','').split('+')[0]+'Z'
+'&amp;amp;location='+here.location
+'&amp;amp;details='+here.getRawDescription()+'&amp;lt;br /&amp;gt;'+here.getRawText()
+'&amp;amp;trp=true'
+'&amp;amp;sprop=website:'+here.event_url()
+'&amp;amp;sprop=name:'+here.contact_name();&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;title=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Add this event to Google Calendar&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;target=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;_blank&amp;quot;&lt;/span&gt;
&lt;span class="na"&gt;style=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;background-image: none; padding: 0px;&amp;quot;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;img&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://www.google.com/calendar/images/ext/gc_button1.gif&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;alt=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Add to Google Calendar&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;50&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;13&amp;quot;&lt;/span&gt;  &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, it's clear as mud, right? It does some magic and completes a link
for you to use to add your given event and it's details into Google
Calendar from Plone.&lt;/p&gt;
&lt;p&gt;For those of you really paying attention, the date conversion is nasty
(why doesn't Google accept an immediately accessible format?) and this
&lt;em&gt;won't&lt;/em&gt; work unless all fields are filled out. I'm still working on a
field-friendly solution.&lt;/p&gt;
&lt;p&gt;Either way, I didn't find anything on the web about doing this, so here
it is. Use as you will.&lt;/p&gt;
</summary><category term="add to"></category><category term="calendar"></category><category term="event"></category><category term="google"></category><category term="integration"></category><category term="plone"></category></entry><entry><title>Plone: URL Encoding In A Script</title><link href="http://davidjb.com/blog/2009/01/plone-url-encoding-in-a-script/" rel="alternate"></link><updated>2009-01-30T08:46:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-30:blog/2009/01/plone-url-encoding-in-a-script/</id><summary type="html">&lt;p&gt;So, for today's problem, how can we get a URL (specifically the GET
request arguments) suitably encoded? Easy, if we're talking about a
Python script that lives on the file system and can be used within
Zope/Plone that way. But what about some sort of Python script that has
to exist on the Plone site (specifically, creating a PloneFormGen (PFG)
Custom Adapter)?&lt;/p&gt;
&lt;p&gt;First thing I jumped to is urllib and urlecode: but no luck because
you're unauthorised to import the library in your script. Boo!&lt;/p&gt;
&lt;p&gt;After much poking, and Googling for something that I thought should be
simple, I found this:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;Products.PythonScripts.standard&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;url_quote_plus&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Does exactly what it says and what it should, and no security issues.
There's also &lt;tt class="docutils literal"&gt;url_quote&lt;/tt&gt; which produces &lt;tt class="docutils literal"&gt;%20&lt;/tt&gt; instead of &lt;tt class="docutils literal"&gt;+&lt;/tt&gt;.&lt;/p&gt;
</summary><category term="adapter"></category><category term="form"></category><category term="plone"></category><category term="ploneformgen"></category><category term="python"></category><category term="quote"></category><category term="url"></category></entry><entry><title>Plone: Correcting Page Template Errors Easily</title><link href="http://davidjb.com/blog/2009/01/plone-correcting-page-template-errors-easily/" rel="alternate"></link><updated>2009-01-22T08:43:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-22:blog/2009/01/plone-correcting-page-template-errors-easily/</id><summary type="html">&lt;p&gt;Here's how to correct pesky problems in your code/XHTML since the line
number and column references are slightly useless in the ZMI.&lt;/p&gt;
&lt;p&gt;Paste contents from a page or page template from the ZMI into a program
like gedit and then the line and column reference numbers will be
correct (once you remove the comment about the error from the top of the
page).&lt;/p&gt;
&lt;p&gt;Editing in the ZMI is a bit painful, but we persevere.&lt;/p&gt;
</summary><category term="code"></category><category term="editing"></category><category term="page"></category><category term="plone"></category><category term="python"></category><category term="template"></category><category term="zmi"></category></entry><entry><title>Plone: Varnish Configuration (Cache Hits, Purge Fails)</title><link href="http://davidjb.com/blog/2009/01/plone-varnish-configuration-cache-hits-purge-fails/" rel="alternate"></link><updated>2009-01-21T08:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-21:blog/2009/01/plone-varnish-configuration-cache-hits-purge-fails/</id><summary type="html">&lt;p&gt;What a painful, painful day. It's taken about the entire day, but I've
finally figured out why our Varnish configuration around here for
Plone/Zope hasn't been accepting PURGE requests. Thus, without accepting
purge requests correctly, any content that gets changed in Plone doesn't
get updated in the cache until it times out (or we restart it). Ouch -
especially because it affects all sites under virtual hosting, and a lot
of these sites have publicly visible content that needs to be available
immediately.&lt;/p&gt;
&lt;p&gt;So, the problem manifested itself as thus:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Cache hits happen&lt;/li&gt;
&lt;li&gt;Performance was good on the Plone sites&lt;/li&gt;
&lt;li&gt;PURGE requests sent to Varnish would produce 404's&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So, after checking (many times) the object path for the PURGE was right,
Varnish would return a MISS and produce a 404 (DEBUG &amp;quot;VCL_error(404,
Not in cache)&amp;quot; as the Varnish message).&lt;/p&gt;
&lt;p&gt;Much searching/etc later, I found that using:&lt;/p&gt;
&lt;pre class="code bash literal-block"&gt;
curl -X PURGE http://localhost:8000/object/path
&lt;/pre&gt;
&lt;p&gt;straight on the machine running Varnish would work and give a &lt;em&gt;200 Purged
response&lt;/em&gt;. But, running the same command (replacing localhost with a FQDN) from
the Zope machine produced the 404. So, essentially, Varnish knows where to look
for the first command but not for the second.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h2&gt;Solution&lt;/h2&gt;
&lt;p&gt;Where you set the backend for your Plone/Zope in the Varnish
configuration, add set req.http.host accordingly:&lt;/p&gt;
&lt;pre class="code cpp literal-block"&gt;
&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;elseif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;^/VirtualHostBase/https?/my.plone.site.com:(80\|443)/plone/VirtualHostRoot&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;backend&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;zope1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;my.plone.site.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;...&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;In short, the URL is processed from Apache (in my situation) to result
in the &lt;em&gt;req.url&lt;/em&gt;, and then Varnish needs to know what host anything
being cached relates to. Without it, hello 404 heaven.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="cache"></category><category term="plone"></category><category term="problem"></category><category term="purge"></category><category term="varnish"></category></entry><entry><title>Plone: Re-ordering Folder Contents</title><link href="http://davidjb.com/blog/2009/01/plone-re-ordering-folder-contents/" rel="alternate"></link><updated>2009-01-19T16:42:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-19:blog/2009/01/plone-re-ordering-folder-contents/</id><summary type="html">&lt;p&gt;Ahhh, a new work week.&lt;/p&gt;
&lt;p&gt;The first perplexing puzzle for the week was a seemingly silly idea (it
still is) in Plone where it allows you to view the contents of a given
folder in batches of 20. Now, combine this concept (which is good) with
a concept of being able to re-order items within the folder (which is
good too), you end up with not being able to move items between
'batches'.&lt;/p&gt;
&lt;p&gt;Troublesome. There's nothing obvious that you can do aside from
disabling your browser's JavaScript and using the manual buttons. Nope:
not feasible.&lt;/p&gt;
&lt;p&gt;Try making your folder view &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/folder_contents?show_all=true&lt;/span&gt;&lt;/tt&gt;. Batching
is disabled temporarily for the change to be made.&lt;/p&gt;
&lt;p&gt;Apparently that's a legitimate fix for a significant problem. Not
terribly elegant, but I'm struggling to think of a better solution.&lt;/p&gt;
</summary><category term="batch"></category><category term="folder contents"></category><category term="forms"></category><category term="help"></category><category term="javascript"></category><category term="plone"></category></entry><entry><title>Plone How-To: XHTML Compliant Flash Insertion</title><link href="http://davidjb.com/blog/2009/01/plone-how-to-xhtml-compliant-flash-insertion/" rel="alternate"></link><updated>2009-01-13T16:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-13:blog/2009/01/plone-how-to-xhtml-compliant-flash-insertion/</id><summary type="html">&lt;p&gt;Wow, it seems easy doesn't it. Just add an object tag, params, and embed
and we're done, right? Well, sure, if we didn't want to adhere to W3C
standards.&lt;/p&gt;
&lt;p&gt;To do the right thing, we need something like this:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;object&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;application/x-shockwave-flash&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;data=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie.swf&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;param&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;movie.swf&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;img&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;alt.jpg&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;100&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;alt=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/object&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Not much to it there, and this is available everywhere on the web. It
validates okay, and that's what we need.&lt;/p&gt;
&lt;p&gt;However, if you follow normal procedure for sticking this in Plone
(disable filtering of the relevant &lt;strong&gt;object&lt;/strong&gt; and &lt;strong&gt;param&lt;/strong&gt; tags in HTML
Filtering (Plone Control Panel), then make a Page with this code),
you'll see it won't work in IE.&lt;/p&gt;
&lt;p&gt;Much hair-tearing and searching led me to find that the rendered Page is
missing the &lt;strong&gt;param&lt;/strong&gt; tag in the source XHTML. Huh?!?, you say - I just
disabled the filtering. Why's it not there?!.&lt;/p&gt;
&lt;p&gt;Sure, you did. What noone told you is that you need to go into the ZMI
-&amp;gt; portal_transforms -&amp;gt; safe_html and tell Plone that the &lt;strong&gt;param&lt;/strong&gt;
tag is an &lt;em&gt;empty tag&lt;/em&gt; (like &amp;lt;img /&amp;gt;). In the list of &lt;strong&gt;valid_tags&lt;/strong&gt;,
set &lt;strong&gt;param&lt;/strong&gt; to be &lt;em&gt;0&lt;/em&gt;. Save this page.&lt;/p&gt;
&lt;p&gt;Now try it again in IE. Looking at the source in both should show the
&lt;strong&gt;param&lt;/strong&gt; tag now, and your Flash should show up just fine once you
convince IE to refresh.&lt;/p&gt;
</summary><category term="filtering"></category><category term="flash"></category><category term="parameters"></category><category term="plone"></category><category term="xhtml"></category></entry><entry><title>Plone: PloneFormGen Customisations</title><link href="http://davidjb.com/blog/2009/01/plone-ploneformgen-customisations/" rel="alternate"></link><updated>2009-01-12T16:39:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-12:blog/2009/01/plone-ploneformgen-customisations/</id><summary type="html">&lt;p&gt;Another fun problem for me to address today: upgrading to the latest
version of Plone (3.1.7 at time of writing) caused my custom
PloneFormGen (otherwise known as PFG) view to break in a nasty way:&lt;/p&gt;
&lt;pre class="code pytb literal-block"&gt;
&lt;span class="x"&gt;Module None, line 13, in fgvalidate_base
- &amp;lt;fscontrollervalidator at /site/fgvalidate_base used for /site/registration-form&amp;gt;
- Line 13
Module Products.PloneFormGen.content.form, line 519, in fgvalidate
Module plone.protect.authenticator, line 60, in check
Forbidden: Form authenticator is invalid.&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Obviously there's some new validation code for forms in Plone 3.1+.
Thanks to a very simple (and useful!) blog entry:
&lt;a class="reference external" href="http://www.die-welt.net/index.php/blog/239/Upgading_forms_in_Plone_3"&gt;http://www.die-welt.net/index.php/blog/239/Upgading_forms_in_Plone_3&lt;/a&gt;
, the solution is to add:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;input&lt;/span&gt; &lt;span class="na"&gt;tal:replace=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;structure context/&amp;#64;&amp;#64;authenticator/authenticator&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;somewhere in the form.&lt;/p&gt;
</summary><category term="authenticator"></category><category term="changes"></category><category term="forms"></category><category term="plone"></category></entry><entry><title>Rewrite Rules Made Easy</title><link href="http://davidjb.com/blog/2009/01/rewrite-rules-made-easy/" rel="alternate"></link><updated>2009-01-08T16:38:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-08:blog/2009/01/rewrite-rules-made-easy/</id><summary type="html">&lt;p&gt;I've pretty much got a nice handle on Rewrite rules for Apache. Once
you've seen a few of them, it's straight forward enough to replicate for
new Plone sites and so forth.&lt;/p&gt;
&lt;p&gt;However, to make things even easier on my brain I've found this:
&lt;a class="reference external" href="http://betabug.ch/zope/witch"&gt;http://betabug.ch/zope/witch&lt;/a&gt; , the Rewrite Rule Witch. Seems like the
rules it produces are what I'd expect, which makes me ponder why, if I
know they're right, would I bother.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reason:&lt;/strong&gt; easy confirmation and less chance of typos.&lt;/p&gt;
</summary><category term="apache"></category><category term="rewrite"></category><category term="rules"></category></entry><entry><title>Plone: Python Eggs And Development</title><link href="http://davidjb.com/blog/2009/01/plone-python-eggs-and-development/" rel="alternate"></link><updated>2009-01-02T15:04:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2009-01-02:blog/2009/01/plone-python-eggs-and-development/</id><summary type="html">&lt;p&gt;Welcome to the new year! It's the start of another journey around the
sun and the beginning of work for me. Whilst I'm the only one actually
working around here today, I thought I'd take the chance and update with
some useful info:&lt;/p&gt;
&lt;div class="section" id="troublesome-python-eggs"&gt;
&lt;h2&gt;Troublesome Python eggs&lt;/h2&gt;
&lt;p&gt;Now, much to my amazement, when you're creating/compiling/whatever
Python eggs for Plone you need to actually specify the files you want
included in the build. I suppose it's fair enough, but thought it might
have actually done it for me. No such luck!&lt;/p&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;SOURCES.txt&lt;/tt&gt; file in the egg-info folder needs to be updated
accordingly. A command like &lt;tt class="docutils literal"&gt;find pwd` &lt;span class="pre"&gt;-name&lt;/span&gt; &lt;span class="pre"&gt;&amp;quot;*.*&amp;quot;&lt;/span&gt;&lt;/tt&gt; will do the trick
and list out the files in the directory (assuming you start from the
root of the egg). If theres extra stuff in the folder, you'll probably
need to weed out the extraneous files (.pyc, git, svn, etc) before
building the egg with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
david&amp;#64;computer: python2.4 setup.py build
david&amp;#64;computer: python2.4 setup.py sdist bdist\_egg
&lt;/pre&gt;
&lt;p&gt;which gets our lovely setuptools to build (scramble?) the egg and place
the source and egg into the &lt;tt class="docutils literal"&gt;dist&lt;/tt&gt; folder. Providing the SOURCES.txt
file was correct, then you'll have the right files included. If you
don't, you'll be in for trouble when you try and include the egg under
ZCML etc because the files just don't come along for the ride.&lt;/p&gt;
&lt;p&gt;Serve with sides of bacon and toast, place into your favourite PyPi
(cheese shop) and include with your buildout config.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;Further reading&lt;/h2&gt;
&lt;p&gt;If you're really bored, check out
&lt;a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools"&gt;http://peak.telecommunity.com/DevCenter/setuptools&lt;/a&gt; for some good
material on what Setuptools can do for you.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="egg"></category><category term="linux"></category><category term="python"></category><category term="setuptools"></category></entry><entry><title>Plone: Buildout Won't Install Products.OpenXml</title><link href="http://davidjb.com/blog/2008/12/plone-buildout-wont-install-products-openxml/" rel="alternate"></link><updated>2008-12-22T14:59:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-12-22:blog/2008/12/plone-buildout-wont-install-products-openxml/</id><summary type="html">&lt;p&gt;&lt;strong&gt;UPDATE:&lt;/strong&gt; Installation of Products.OpenXml appears to work happily
with buildout when I'm using z3c.recipe.staticlxml to build lxml
separately from having to easy_install or install system-wide packages.&lt;/p&gt;
&lt;p&gt;So it's almost Christmas time and I'm still slaving away working. It's
all about commitment.&lt;/p&gt;
&lt;p&gt;Today in my life I've been trying to install the OpenXml product for
Plone (using buildout, of course):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
david&amp;#64;computer:~/buildout/instance$ ./bin/buildout
Uninstalling zopepy.
Uninstalling instance.
Updating plone.
Updating zope2.
Updating productdistros.
Installing instance.
Getting distribution for 'Products.OpenXml'.
Got Products.OpenXml 1.0.1.
Getting distribution for 'openxmllib'.
Got openxmllib 1.0.3.
Getting distribution for 'lxml&amp;gt;=1.3.0,&amp;amp;amp;lt;2.0.0dev'.
Building lxml version 1.3.6
ERROR: /bin/sh: xslt-config: not found
** make sure the development packages of libxml2 and libxslt are installed
**ERROR: /bin/sh: xslt-config: not found
** make sure the development packages of libxml2 and libxslt are installed
**ERROR: /bin/sh: xslt-config: not found
&lt;/pre&gt;
&lt;p&gt;And then 50,000 errors follow, making this message hard to find. Either
way, the end result was that lxml wasn't able to install.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Solution:&lt;/strong&gt; install libxslt and its dev counterpart plus the relevant
Python bindings on your system. In Ubuntu 8.10, that's libxslt1.1,
libxslt1-dev, and python-libxslt1.&lt;/p&gt;
&lt;p&gt;All good now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; Turns out Centos 5 (Red Hat) is has different package names.
Try &lt;tt class="docutils literal"&gt;yum install libxslt &lt;span class="pre"&gt;libxslt-devel&lt;/span&gt; &lt;span class="pre"&gt;libxslt-python&lt;/span&gt;&lt;/tt&gt; as root for
Centos.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Future response:&lt;/strong&gt; Just use &lt;a class="reference external" href="https://pypi.python.org/pypi/z3c.recipe.staticlxml"&gt;z3c.recipe.staticlxml&lt;/a&gt; and be done with it all.
No need for system level packages and it all just works.&lt;/p&gt;
</summary><category term="buildout"></category><category term="libxml"></category><category term="openxml"></category><category term="plone"></category><category term="problem"></category><category term="products"></category><category term="xml"></category></entry><entry><title>Plone: Ploneboard Conversation Editing</title><link href="http://davidjb.com/blog/2008/11/plone-ploneboard-conversation-editing/" rel="alternate"></link><updated>2008-11-27T11:40:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-27:blog/2008/11/plone-ploneboard-conversation-editing/</id><summary type="html">&lt;p&gt;I'm back with even more Plone goodness. Turns out Ploneboard has a
problem/issue (well, HAD an issue until I went and edited the code on
the SVN repository for the Collective of Plone. Read: will not have in
the next major release) with redirecting the user after they go and edit
a post. So essentially the user ends up getting to a page that says
'Insufficient privileges', which is was extremely odd considering I do
everything as an admin.&lt;/p&gt;
&lt;p&gt;The fix goes a little something like this:&lt;/p&gt;
&lt;p&gt;In ploneboard_scripts/comment_redirect_to_conversation change it to
be:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="c"&gt;# XXX if we ever do batching, we need extra logic here.&lt;/span&gt;
&lt;span class="n"&gt;redirect_target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getConversation&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;anchor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;REQUEST&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'RESPONSE'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;redirect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;#&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;'&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;redirect_target&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;anchor&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Redirecting to &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;redirect_target&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;printed&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Originally, the user was attempted to be sent to some other view that
they couldn't access. Now, they just get sent to the conversation. No
tricks, just the conversation.&lt;/p&gt;
&lt;p&gt;More Plone on the way!&lt;/p&gt;
</summary><category term="conversation"></category><category term="editing"></category><category term="plone"></category><category term="ploneboard"></category><category term="python"></category><category term="redirection"></category><category term="script"></category></entry><entry><title>Plone: Page Template Redirects</title><link href="http://davidjb.com/blog/2008/11/plone-page-template-redirects/" rel="alternate"></link><updated>2008-11-25T11:38:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-25:blog/2008/11/plone-page-template-redirects/</id><summary type="html">&lt;p&gt;Was wondering how to get a Plone page template to go to a page before the template actually loads. Now, actually getting Plone to not go to this template would be FAR better, but since we cant actually modify the functionality of the Favourites content items in the content listings (not easily), I instead modify its default view.&lt;/p&gt;
&lt;p&gt;Using this:&lt;/p&gt;
&lt;pre class="code html literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;metal:js&lt;/span&gt; &lt;span class="na"&gt;fill-slot=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;javascript_head_slot&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;script &lt;/span&gt;&lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/javascript&amp;quot;&lt;/span&gt;
        &lt;span class="na"&gt;tal:content=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;python:'location.href=\''+portal.absolute_url()+'/'+here.remoteUrl+'\';;'&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/metal:js&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;We see that the page reloads to the relevant location as soon as the
head JavaScript is done loading.&lt;/p&gt;
&lt;p&gt;Easy, quick, useful, hack-y. More to come for Plone.&lt;/p&gt;
</summary><category term="edit"></category><category term="hack"></category><category term="javascript"></category><category term="plone"></category><category term="redirect"></category><category term="template"></category></entry><entry><title>Plone: Relative 'Recent Changes' Portlets</title><link href="http://davidjb.com/blog/2008/11/plone-relative-recent-changes-portlets/" rel="alternate"></link><updated>2008-11-20T11:33:00+10:00</updated><author><name>davidjb</name></author><id>tag:davidjb.com,2008-11-20:blog/2008/11/plone-relative-recent-changes-portlets/</id><summary type="html">&lt;p&gt;The problem I've been faced with today on our Plone systems is that I
need to created a 'Recent Changes' portlet that's relative to where the
user is on the site.&lt;/p&gt;
&lt;p&gt;Now, the standard portlet doesn't do anything for me, so that's pretty
useless. I had a look at the standard code for the portlet too and it's
not really feasible to try and mess with:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;tal:recentlist&lt;/span&gt; &lt;span class="na"&gt;define=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;view here/&amp;#64;&amp;#64;recent_view; results here/results;&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;However, using a (nasty?) workaround, if we put the classic Recent
Changes portlet into play, we can change that above code in the ZMI to
something like:&lt;/p&gt;
&lt;pre class="code xml literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;tal:recentlist&lt;/span&gt; &lt;span class="na"&gt;define=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;view here/&amp;#64;&amp;#64;recent_view;
                        theseResults python:container.portal_catalog(path='/'.join(context.getPhysicalPath()),sort_on='modified',sort_order='reverse');
                        results python:theseResults[:5];&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;So, we handle the problem by asking the portal catalog this time, and
only wanting stuff that's under our current physical path. By using the
&lt;em&gt;path&lt;/em&gt; parameter for the catalog, this works its magic for us. The
sub-selection of the array handles cutting back the results.&lt;/p&gt;
&lt;p&gt;I noticed that the portlet also has links in its header and footer to
'/recently_modified'. This would, typically, just give us the
everything on the portal, but by making a new page template with a
slightly different name, copying the code in from 'recently_modified',
modifying its &lt;em&gt;results&lt;/em&gt; as above, and pointing the portlet's links at
this new page template under our current page:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;absolute_url&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;'/relative_recently_modified'&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;we end up with a nice, relative, recent changes full listing.&lt;/p&gt;
&lt;p&gt;It's a brutal hack, but you could apply the same idea to an actual
product and make a real Plone 3 portlet out of this.&lt;/p&gt;
</summary><category term="features"></category><category term="plone"></category><category term="portlets"></category><category term="product"></category><category term="python"></category></entry></feed>